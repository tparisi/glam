var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(a){return void 0!==a};goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]));goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;
goog.provide=function(a){if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};
goog.module=function(a){if(!goog.isString(a)||!a)throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};
goog.module.getInternal_=function(a){if(!COMPILED)return goog.isProvided_(a)?a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");for(var f=goog.dependencies_,g=0;e=b[g];g++)f.nameToPath[e]=a,f.pathIsModule[a]=!!d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};
goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};goog.require=function(a){if(!COMPILED){if(goog.isProvided_(a))return goog.isInModuleLoader_()?goog.module.getInternal_(a):null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,goog.writeScripts_(),null}a="goog.require could not find: "+a;goog.logToConsole_(a);throw Error(a);}};goog.basePath="";goog.nullFunction=function(){};
goog.identityFunction=function(a,b){return a};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=-1==d?c.length:
d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=goog.global.document&&goog.global.document.all&&!goog.global.atob,goog.importModule_=function(a){goog.importScript_("",'goog.retrieveAndExecModule_("'+a+'");')&&(goog.dependencies_.written[a]=!0)},goog.queuedModules_=[],goog.retrieveAndExecModule_=function(a){for(var b;-1!=(b=a.indexOf("/./"));)a=
a.substr(0,b)+a.substr(b+2);for(;-1!=(b=a.indexOf("/../"));){var c=a.lastIndexOf("/",b-1);a=a.substr(0,c)+a.substr(b+3)}b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var d=null,c=new goog.global.XMLHttpRequest;c.onload=function(){d=this.responseText};c.open("get",a,!1);c.send();d=c.responseText;if(null!=d)c=goog.wrapModule_(a,d),goog.IS_OLD_IE_?goog.queuedModules_.push(c):b(a,c),goog.dependencies_.written[a]=!0;else throw Error("load of "+a+"failed");},goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&
goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(0<a){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;c<a;c++)goog.globalEval(b[c])}},goog.loadModule=function(a){try{goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1};var b;if(goog.isFunction(a))b=
a.call(goog.global,{});else if(goog.isString(a))b=goog.loadModuleFromSource_.call(goog.global,a);else throw Error("Invalid module definition");var c=goog.moduleLoaderState_.moduleName;if(!goog.isString(c)||!c)throw Error('Invalid module name "'+c+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(c,b):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(b);goog.loadedModules_[c]=b;if(goog.moduleLoaderState_.declareTestMethods)for(var d in b)if(0===d.indexOf("test",0)||"tearDown"==
d||"setUp"==d||"setUpPage"==d||"tearDownPage"==d)goog.global[d]=b[d]}finally{goog.moduleLoaderState_=null}},goog.loadModuleFromSource_=function(a){eval(a);return{}},goog.writeScriptTag_=function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if("complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}var d=goog.IS_OLD_IE_;void 0===b?d?(d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",c.write('<script type="text/javascript" src="'+
a+'"'+d+">\x3c/script>")):c.write('<script type="text/javascript" src="'+a+'">\x3c/script>'):c.write('<script type="text/javascript">'+b+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(a,b){"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var f in d.requires[e])if(!goog.isProvided_(f))if(f in
d.nameToPath)a(d.nameToPath[f]);else throw Error("Undefined nameToPath for "+f);e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);for(var f=0;f<b.length;f++)e=b[f],goog.dependencies_.written[e]=!0;var g=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(f=0;f<b.length;f++)if(e=b[f])d.pathIsModule[e]?goog.importModule_(goog.basePath+e):goog.importScript_(goog.basePath+e);else throw goog.moduleLoaderState_=g,Error("Undefined script input");
goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return d in b?b[d]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){var g=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,g)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,
e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return a;var c=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===c&&Object.seal(b);return b};return c}return a};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var glam={Service:function(){}};glam.Service.prototype.initialize=function(a){};glam.Service.prototype.terminate=function(){};glam.Service.prototype.update=function(){};glam.Keyboard=function(){glam.Keyboard.instance=this};glam.Keyboard.prototype.onKeyDown=function(a){};glam.Keyboard.prototype.onKeyUp=function(a){};glam.Keyboard.prototype.onKeyPress=function(a){};glam.Keyboard.instance=null;glam.Keyboard.KEY_LEFT=37;glam.Keyboard.KEY_UP=38;glam.Keyboard.KEY_RIGHT=39;glam.Keyboard.KEY_DOWN=40;glam.Mouse=function(){this.state={x:glam.Mouse.NO_POSITION,y:glam.Mouse.NO_POSITION,buttons:{left:!1,middle:!1,right:!1},scroll:0};glam.Mouse.instance=this};glam.Mouse.prototype.onMouseMove=function(a){this.state.x=a.elementX;this.state.y=a.elementY};glam.Mouse.prototype.onMouseDown=function(a){this.state.x=a.elementX;this.state.y=a.elementY;this.state.buttons.left=!0};glam.Mouse.prototype.onMouseUp=function(a){this.state.x=a.elementX;this.state.y=a.elementY;this.state.buttons.left=!1};
glam.Mouse.prototype.onMouseClick=function(a){this.state.x=a.elementX;this.state.y=a.elementY;this.state.buttons.left=!1};glam.Mouse.prototype.onMouseDoubleClick=function(a){this.state.x=a.elementX;this.state.y=a.elementY;this.state.buttons.left=!1};glam.Mouse.prototype.onMouseScroll=function(a,b){this.state.scroll=0};glam.Mouse.prototype.getState=function(){return this.state};glam.Mouse.instance=null;glam.Mouse.NO_POSITION=Number.MIN_VALUE;glam.Input=function(){this.mouse=new glam.Mouse;this.keyboard=new glam.Keyboard;this.gamepad=new glam.Gamepad;glam.Input.instance=this};goog.inherits(glam.Input,glam.Service);glam.Input.prototype.update=function(){this.gamepad&&this.gamepad.update&&this.gamepad.update()};glam.Input.instance=null;glam.Time=function(){if(glam.Time.instance)throw Error("Graphics singleton already exists");};glam.Time.prototype.initialize=function(a){this.currentTime=Date.now();glam.Time.instance=this};glam.Time.prototype.update=function(){this.currentTime=Date.now()};glam.Time.instance=null;glam.EventService=function(){};goog.inherits(glam.EventService,glam.Service);glam.EventService.prototype.initialize=function(a){};glam.EventService.prototype.terminate=function(){};glam.EventService.prototype.update=function(){do glam.EventService.eventsPending=!1,glam.Application.instance.updateObjects();while(glam.EventService.eventsPending)};glam.EventDispatcher=function(){this.eventTypes={};this.timestamps={};this.connections={}};glam.EventDispatcher.prototype.addEventListener=function(a,b){var c=this.eventTypes[a];if(c){if(-1!=c.indexOf(b))return}else c=[],this.eventTypes[a]=c,this.timestamps[a]=0;c.push(b)};glam.EventDispatcher.prototype.removeEventListener=function(a,b){if(b){var c=this.eventTypes[a];if(c){var d=c.indexOf(b);-1!=d&&c.splice(d,1)}}else delete this.eventTypes[a],delete this.timestamps[a]};
glam.EventDispatcher.prototype.dispatchEvent=function(a){var b=this.eventTypes[a];if(b){var c=glam.Time.instance.currentTime;if(this.timestamps[a]<c)for(this.timestamps[a]=c,glam.EventService.eventsPending=!0,[].shift.call(arguments),c=0;c<b.length;c++)b[c].apply(this,arguments)}};glam.EventDispatcher.prototype.hasEventListener=function(a,b){var c=this.eventTypes[type];return c?-1!=c.indexOf(listener):!1};
glam.EventDispatcher.prototype.connect=function(a,b,c){var d=this.connections[a];d||(d=[],this.connections[a]=d);var e=this,f=function(){return function(){e.handleConnection(null,b,c,arguments)}}(),g={listener:f,sourceProp:null,target:b,targetProp:c};d.push(g);g=this.addEventListener(a,f)};glam.EventDispatcher.prototype.handleConnection=function(a,b,c,d){var e=b[c];"function"==typeof e?e.apply(b,d):"object"==typeof e?e.copy&&"function"==typeof e.copy&&e.copy(a?d[0][a]:d[0]):b[c]=a?d[0][a]:d[0]};glam.Component=function(a){glam.EventDispatcher.call(this);this._object=null;this._realized=!1};goog.inherits(glam.Component,glam.EventDispatcher);glam.Component.prototype.getObject=function(){return this._object};glam.Component.prototype.setObject=function(a){this._object=a};glam.Component.prototype.realize=function(){this._realized=!0};glam.Component.prototype.update=function(){};glam.Behavior=function(a){a=a||{};this.startTime=0;this.running=!1;this.loop=void 0!==a.loop?a.loop:!1;this.autoStart=void 0!==a.autoStart?a.autoStart:!1;glam.Component.call(this,a)};goog.inherits(glam.Behavior,glam.Component);glam.Behavior.prototype._componentCategory="behaviors";glam.Behavior.prototype.realize=function(){glam.Component.prototype.realize.call(this);this.autoStart&&this.start()};glam.Behavior.prototype.start=function(){this.startTime=glam.Time.instance.currentTime;this.running=!0};
glam.Behavior.prototype.stop=function(){this.startTime=0;this.running=!1};glam.Behavior.prototype.toggle=function(){this.running?this.stop():this.start()};glam.Behavior.prototype.update=function(){this.running&&this.evaluate((glam.Time.instance.currentTime-this.startTime)/1E3)};glam.Behavior.prototype.evaluate=function(a){glam.Behavior.WARN_ON_ABSTRACT&&glam.System.warn("Abstract Behavior.evaluate called")};glam.Behavior.WARN_ON_ABSTRACT=!0;glam.BounceBehavior=function(a){a=a||{};this.duration=void 0!==a.duration?a.duration:1;this.bounceVector=void 0!==a.bounceVector?a.bounceVector:new THREE.Vector3(0,1,0);this.tweenDown=this.tweenUp=null;glam.Behavior.call(this,a)};goog.inherits(glam.BounceBehavior,glam.Behavior);
glam.BounceBehavior.prototype.start=function(){this.running||(this.bouncePosition=new THREE.Vector3,this.bounceEndPosition=this.bounceVector.clone(),this.prevBouncePosition=new THREE.Vector3,this.bounceDelta=new THREE.Vector3,this.tweenUp=(new TWEEN.Tween(this.bouncePosition)).to(this.bounceEndPosition,1E3*(this.duration/2)).easing(TWEEN.Easing.Quadratic.InOut).repeat(0).start(),glam.Behavior.prototype.start.call(this))};
glam.BounceBehavior.prototype.evaluate=function(a){this.bounceDelta.copy(this.bouncePosition).sub(this.prevBouncePosition);this.prevBouncePosition.copy(this.bouncePosition);this._object.transform.position.add(this.bounceDelta);a>=this.duration/2&&(this.tweenUp&&(this.tweenUp.stop(),this.tweenUp=null),this.tweenDown||(this.bouncePosition=this._object.transform.position.clone(),this.bounceEndPosition=this.bouncePosition.clone().sub(this.bounceVector),this.prevBouncePosition=this.bouncePosition.clone(),
this.bounceDelta=new THREE.Vector3,this.tweenDown=(new TWEEN.Tween(this.bouncePosition)).to(this.bounceEndPosition,1E3*(this.duration/2)).easing(TWEEN.Easing.Quadratic.InOut).repeat(0).start()));a>=this.duration&&(this.tweenDown.stop(),this.tweenDown=null,this.stop(),this.loop&&this.start())};glam.KeyFrameAnimator=function(a){glam.Component.call(this,a);a=a||{};this.interpdata=a.interps||[];this.animationData=a.animations;this.running=!1;this.direction=glam.KeyFrameAnimator.FORWARD_DIRECTION;this.duration=a.duration?a.duration:glam.KeyFrameAnimator.default_duration;this.loop=a.loop?a.loop:!1;this.easing=a.easing};goog.inherits(glam.KeyFrameAnimator,glam.Component);
glam.KeyFrameAnimator.prototype.realize=function(){glam.Component.prototype.realize.call(this);this.interpdata&&this.createInterpolators(this.interpdata);if(this.animationData){this.animations=[];var a,b=this.animationData.length;for(a=0;a<b;a++){var c=this.animationData[a];c instanceof THREE.glTFAnimation||(THREE.AnimationHandler.add(c),c=new THREE.KeyFrameAnimation(c.node,c.name));this.animations.push(c)}}};
glam.KeyFrameAnimator.prototype.createInterpolators=function(a){this.interps=[];var b,c=a.length;for(b=0;b<c;b++){var d=a[b],d=new glam.Interpolator({keys:d.keys,values:d.values,target:d.target});d.realize();this.interps.push(d)}};
glam.KeyFrameAnimator.prototype.start=function(){if(!this.running&&(this.lastTime=this.startTime=Date.now(),this.running=!0,this.animations)){var a,b=this.animations.length;for(a=0;a<b;a++)this.animations[a].loop=this.loop,this.animations[a]instanceof THREE.glTFAnimation&&(this.animations[a].direction=this.direction==glam.KeyFrameAnimator.FORWARD_DIRECTION?THREE.glTFAnimation.FORWARD_DIRECTION:THREE.glTFAnimation.REVERSE_DIRECTION),this.animations[a].play(this.loop,0),this.endTime=this.startTime+
this.animations[a].endTime/this.animations[a].timeScale,isNaN(this.endTime)&&(this.endTime=this.startTime+1E3*this.animations[a].duration)}};glam.KeyFrameAnimator.prototype.stop=function(){this.running=!1;this.dispatchEvent("complete");if(this.animations){var a,b=this.animations.length;for(a=0;a<b;a++)this.animations[a].stop()}};
glam.KeyFrameAnimator.prototype.update=function(){if(this.running)if(this.animations)this.updateAnimations();else{var a=Date.now(),b=Math.floor((a-this.startTime)/this.duration),a=(a-this.startTime)%this.duration/this.duration;this.easing&&(a=this.easing(a));if(1<=b&&!this.loop){this.running=!1;this.dispatchEvent("complete");for(var c=this.interps.length,b=0;b<c;b++)this.interps[b].interp(1)}else for(c=this.interps.length,b=0;b<c;b++)this.interps[b].interp(a)}};
glam.KeyFrameAnimator.prototype.updateAnimations=function(){var a=Date.now(),b=a-this.lastTime,c=!1,d,e=this.animations.length;for(d=0;d<e;d++)this.animations[d].update(b),!this.loop&&a>=this.endTime&&(c=!0);this.lastTime=a;c&&this.stop()};glam.KeyFrameAnimator.default_duration=1E3;glam.KeyFrameAnimator.FORWARD_DIRECTION=0;glam.KeyFrameAnimator.REVERSE_DIRECTION=1;glam.CameraElement={};glam.CameraElement.DEFAULT_FOV=45;glam.CameraElement.DEFAULT_NEAR=1;glam.CameraElement.DEFAULT_FAR=1E4;
glam.CameraElement.create=function(a,b,c){var d=a.getAttribute("fov")||glam.CameraElement.DEFAULT_FOV,e=a.getAttribute("near")||glam.CameraElement.DEFAULT_NEAR,f=a.getAttribute("far")||glam.CameraElement.DEFAULT_FAR,g=a.getAttribute("aspect");b&&(b.fov&&(d=b.fov),b.near&&(e=b.near),b.far&&(f=b.far),b.aspect&&(g=b.aspect));d=parseFloat(d);e=parseFloat(e);f=parseFloat(f);b={fov:d,near:e,far:f};g&&(g=parseFloat(g),b.aspect=g);g=new glam.Object;b=new glam.PerspectiveCamera(b);g.addComponent(b);c.addCamera(b,
a.id);return g};glam.SceneComponent=function(a){a=a||{};glam.Component.call(this,a);Object.defineProperties(this,{position:{get:function(){return this.object.position}},rotation:{get:function(){return this.object.rotation}},scale:{get:function(){return this.object.scale}},quaternion:{get:function(){return this.object.quaternion}},up:{get:function(){return this.object.up},set:function(a){this.object.up=a}},useQuaternion:{get:function(){return this.object.useQuaternion},set:function(a){this.object.useQuaternion=a}},
visible:{get:function(){return this.object.visible},set:function(a){this.object.visible=a}},lookAt:{value:function(a){this.object.lookAt(a)}},translateOnAxis:{value:function(a,c){this.object.translateOnAxis(a,c)}},translateX:{value:function(a){this.object.translateX(a)}},translateY:{value:function(a){this.object.translateY(a)}},translateZ:{value:function(a){this.object.translateZ(a)}}});this.layer=a.layer};goog.inherits(glam.SceneComponent,glam.Component);
glam.SceneComponent.prototype.realize=function(){this.object&&!this.object.data&&this.addToScene();glam.Component.prototype.realize.call(this)};glam.SceneComponent.prototype.update=function(){glam.Component.prototype.update.call(this)};
glam.SceneComponent.prototype.addToScene=function(){var a=this.layer?this.layer.scene:glam.Graphics.instance.scene;this._object&&this._object.transform.object!=this.object&&(a=this._object.transform?this._object.transform.object:a)&&(a!=this.object.parent&&a.add(this.object),this.object.data=this)};
glam.SceneComponent.prototype.removeFromScene=function(){var a=this.layer?this.layer.scene:glam.Graphics.instance.scene;this._object&&(a=this._object.transform?this._object.transform.object:a)&&(this.object.data=null,a.remove(this.object));this._realized=!1};glam.Light=function(a){a=a||{};glam.SceneComponent.call(this,a);Object.defineProperties(this,{color:{get:function(){return this.object.color}},intensity:{get:function(){return this.object.intensity},set:function(a){this.object.intensity=a}}})};goog.inherits(glam.Light,glam.SceneComponent);glam.Light.prototype._componentProperty="light";glam.Light.prototype._componentPropertyType="Light";glam.Light.prototype.realize=function(){glam.SceneComponent.prototype.realize.call(this)};
glam.Light.DEFAULT_COLOR=16777215;glam.Light.DEFAULT_INTENSITY=1;glam.Light.DEFAULT_RANGE=1E4;glam.SpotLight=function(a){a=a||{};this.scaledDir=new THREE.Vector3;this.positionVec=new THREE.Vector3;this.castShadows=void 0!==a.castShadows?a.castShadows:glam.SpotLight.DEFAULT_CAST_SHADOWS;glam.Light.call(this,a);a.object?(this.object=a.object,this.direction=a.object.position.clone().normalize().negate(),this.targetPos=a.object.target.position.clone(),this.shadowDarkness=a.object.shadowDarkness):(this.direction=a.direction||new THREE.Vector3(0,0,-1),this.targetPos=new THREE.Vector3,this.shadowDarkness=
void 0!==a.shadowDarkness?a.shadowDarkness:glam.SpotLight.DEFAULT_SHADOW_DARKNESS,this.object=new THREE.SpotLight(a.color,a.intensity,void 0!==a.distance?a.distance:glam.SpotLight.DEFAULT_DISTANCE,void 0!==a.angle?a.angle:glam.SpotLight.DEFAULT_ANGLE,void 0!==a.exponent?a.exponent:glam.SpotLight.DEFAULT_EXPONENT));Object.defineProperties(this,{angle:{get:function(){return this.object.angle},set:function(a){this.object.angle=a}},distance:{get:function(){return this.object.distance},set:function(a){this.object.distance=
a}},exponent:{get:function(){return this.object.exponent},set:function(a){this.object.exponent=a}}})};goog.inherits(glam.SpotLight,glam.Light);glam.SpotLight.prototype.realize=function(){glam.Light.prototype.realize.call(this)};
glam.SpotLight.prototype.update=function(){this.object&&(this.positionVec.set(0,0,0),this.positionVec.applyMatrix4(this.object.parent.matrixWorld),this.position.copy(this.positionVec),this.scaledDir.copy(this.direction),this.scaledDir.multiplyScalar(glam.Light.DEFAULT_RANGE),this.targetPos.copy(this.position),this.targetPos.add(this.scaledDir),this.updateShadows());glam.Light.prototype.update.call(this)};
glam.SpotLight.prototype.updateShadows=function(){this.castShadows&&(this.object.castShadow=!0,this.object.shadowCameraNear=1,this.object.shadowCameraFar=glam.Light.DEFAULT_RANGE,this.object.shadowCameraFov=90,this.object.shadowBias=1E-4,this.object.shadowDarkness=this.shadowDarkness,this.object.shadowMapWidth=1024,this.object.shadowMapHeight=1024,glam.Graphics.instance.enableShadows(!0))};glam.SpotLight.DEFAULT_DISTANCE=0;glam.SpotLight.DEFAULT_ANGLE=Math.PI/2;glam.SpotLight.DEFAULT_EXPONENT=10;
glam.SpotLight.DEFAULT_CAST_SHADOWS=!1;glam.SpotLight.DEFAULT_SHADOW_DARKNESS=0.3;glam.Transform=function(a){a=a||{};glam.SceneComponent.call(this,a);this.object=a.object?a.object:new THREE.Object3D};goog.inherits(glam.Transform,glam.SceneComponent);glam.Transform.prototype._componentProperty="transform";glam.Transform.prototype._componentPropertyType="Transform";
glam.Transform.prototype.addToScene=function(){var a=this.layer?this.layer.scene:glam.Graphics.instance.scene;this._object&&(a=this._object._parent&&this._object._parent.transform?this._object._parent.transform.object:a)&&(a.add(this.object),this.object.data=this)};
glam.Transform.prototype.removeFromScene=function(){var a=this.layer?this.layer.scene:glam.Graphics.instance.scene;this._object&&(a=this._object._parent&&this._object._parent.transform?this._object._parent.transform.object:a)&&(this.object.data=null,a.remove(this.object))};glam.Graphics=function(){if(glam.Graphics.instance)throw Error("Graphics singleton already exists");glam.Graphics.instance=this};glam.Graphics.instance=null;glam.GraphicsThreeJS=function(){glam.Graphics.call(this)};goog.inherits(glam.GraphicsThreeJS,glam.Graphics);glam.GraphicsThreeJS.prototype.initialize=function(a){a=a||{};this.initOptions(a);this.initPageElements(a);this.initScene();this.initRenderer(a);this.initMouse();this.initKeyboard();this.addDomHandlers()};glam.GraphicsThreeJS.prototype.focus=function(){this.renderer&&this.renderer.domElement&&this.renderer.domElement.focus()};
glam.GraphicsThreeJS.prototype.initOptions=function(a){this.displayStats=a&&a.displayStats?a.displayStats:glam.GraphicsThreeJS.default_display_stats};
glam.GraphicsThreeJS.prototype.initPageElements=function(a){a.container?this.container=a.container:(this.container=document.createElement("div"),document.body.appendChild(this.container));this.saved_cursor=this.container.style.cursor;this.displayStats&&(window.Stats?(a=new Stats,a.domElement.style.position="absolute",a.domElement.style.top="0px",a.domElement.style.left="0px",a.domElement.style.height="40px",this.container.appendChild(a.domElement),this.stats=a):glam.System.warn("No Stats module found. Make sure to include stats.min.js"))};
glam.GraphicsThreeJS.prototype.initScene=function(){var a=new THREE.Scene,b=new THREE.PerspectiveCamera(45,this.container.offsetWidth/this.container.offsetHeight,1,1E4);b.position.copy(glam.Camera.DEFAULT_POSITION);a.add(b);this.scene=a;this.camera=b;this.backgroundLayer={};a=new THREE.Scene;b=new THREE.PerspectiveCamera(45,this.container.offsetWidth/this.container.offsetHeight,0.01,1E4);b.position.set(0,0,10);a.add(b);this.backgroundLayer.scene=a;this.backgroundLayer.camera=b};
glam.GraphicsThreeJS.prototype.initRenderer=function(a){var b=new THREE.WebGLRenderer({antialias:void 0!==a.antialias?a.antialias:!0,alpha:void 0!==a.alpha?a.alpha:!0});b.sortObjects=!1;b.setSize(this.container.offsetWidth,this.container.offsetHeight);a&&a.backgroundColor&&(b.domElement.style.backgroundColor=a.backgroundColor,b.domElement.setAttribute("z-index",-1));this.container.appendChild(b.domElement);var c=new THREE.Projector;this.renderer=b;this.projector=c;this.lastFrameTime=0;a.riftRender?
this.riftCam=new THREE.VREffect(this.renderer,function(a){a&&console.log("Error creating VR renderer: ",a)}):a.cardboard&&(this.cardboard=new THREE.StereoEffect(this.renderer),this.cardboard.setSize(this.container.offsetWidth,this.container.offsetHeight));this.composer=null};
glam.GraphicsThreeJS.prototype.initMouse=function(){var a=this.renderer.domElement,b=this;a.addEventListener("mousemove",function(a){b.onDocumentMouseMove(a)},!1);a.addEventListener("mousedown",function(a){b.onDocumentMouseDown(a)},!1);a.addEventListener("mouseup",function(a){b.onDocumentMouseUp(a)},!1);a.addEventListener("click",function(a){b.onDocumentMouseClick(a)},!1);a.addEventListener("dblclick",function(a){b.onDocumentMouseDoubleClick(a)},!1);a.addEventListener("mousewheel",function(a){b.onDocumentMouseScroll(a)},
!1);a.addEventListener("DOMMouseScroll",function(a){b.onDocumentMouseScroll(a)},!1);a.addEventListener("touchstart",function(a){b.onDocumentTouchStart(a)},!1);a.addEventListener("touchmove",function(a){b.onDocumentTouchMove(a)},!1);a.addEventListener("touchend",function(a){b.onDocumentTouchEnd(a)},!1)};
glam.GraphicsThreeJS.prototype.initKeyboard=function(){var a=this.renderer.domElement,b=this;a.addEventListener("keydown",function(a){b.onKeyDown(a)},!1);a.addEventListener("keyup",function(a){b.onKeyUp(a)},!1);a.addEventListener("keypress",function(a){b.onKeyPress(a)},!1);a.setAttribute("tabindex",1)};
glam.GraphicsThreeJS.prototype.addDomHandlers=function(){var a=this;window.addEventListener("resize",function(b){a.onWindowResize(b)},!1);setTimeout(function(b){a.onWindowResize(b)},10);document.addEventListener(this.renderer.domElement.mozRequestFullScreen?"mozfullscreenchange":"webkitfullscreenchange",function(b){a.onFullScreenChanged(b)},!1)};
glam.GraphicsThreeJS.prototype.objectFromMouse=function(a){a=new THREE.Vector3(2*(a.elementX/this.container.offsetWidth)-1,2*-(a.elementY/this.container.offsetHeight)+1,0.5);a.unproject(this.camera);var b=new THREE.Vector3,b=b.applyMatrix4(this.camera.matrixWorld);a=(new THREE.Raycaster(b,a.sub(b).normalize())).intersectObjects(this.scene.children,!0);if(0<a.length){for(b=0;b<a.length&&(!a[b].object.visible||a[b].object.ignorePick);)b++;var c=a[b];return b>=a.length?{object:null,point:null,normal:null}:
this.findObjectFromIntersected(c.object,c.point,c.face)}return{object:null,point:null,normal:null}};
glam.GraphicsThreeJS.prototype.objectFromRay=function(a,b,c,d,e){b=new THREE.Raycaster(b,c,d,e);c=null;c=a?a.transform.object.children:this.scene.children;a=b.intersectObjects(c,!0);if(0<a.length){for(b=0;b<a.length&&(!a[b].object.visible||a[b].object.ignoreCollision);)b++;c=a[b];return b>=a.length?{object:null,point:null,normal:null}:this.findObjectFromIntersected(c.object,c.point,c.face)}return{object:null,point:null,normal:null}};
glam.GraphicsThreeJS.prototype.findObjectFromIntersected=function(a,b,c){if(a.data){var d=b.clone(),e=new THREE.Matrix4;e.getInverse(a.matrixWorld);b.applyMatrix4(e);return{object:a.data,point:b,hitPointWorld:d,face:c,normal:c?c.normal:null}}return a.parent?this.findObjectFromIntersected(a.parent,b,c):{object:null,point:null,face:null,normal:null}};
glam.GraphicsThreeJS.prototype.nodeFromMouse=function(a){a=new THREE.Vector3(2*(a.elementX/this.container.offsetWidth)-1,2*-(a.elementY/this.container.offsetHeight)+1,0.5);a.unproject(this.camera);var b=new THREE.Vector3,b=b.applyMatrix4(this.camera.matrixWorld);a=(new THREE.Raycaster(b,a.sub(b).normalize())).intersectObjects(this.scene.children,!0);if(0<a.length){for(b=0;!a[b].object.visible;)b++;return(a=a[b])?{node:a.object,point:a.point,normal:a.face.normal}:null}return null};
glam.GraphicsThreeJS.prototype.getObjectIntersection=function(a,b,c){a=new THREE.Vector3(2*(a/this.renderer.domElement.offsetWidth)-1,2*-(b/this.renderer.domElement.offsetHeight)+1,0.5);a.unproject(this.camera);b=new THREE.Vector3;b=b.applyMatrix4(this.camera.matrixWorld);c=(new THREE.Raycaster(b,a.sub(b).normalize())).intersectObject(c,!0);return c.length?(c=c[0],a=new THREE.Matrix4,a.getInverse(c.object.matrixWorld),c.point.applyMatrix4(a),c):null};
glam.GraphicsThreeJS.prototype.calcElementOffset=function(a){a.left=this.renderer.domElement.offsetLeft;a.top=this.renderer.domElement.offsetTop;for(var b=this.renderer.domElement.offsetParent;b;)a.left+=b.offsetLeft,a.top+=b.offsetTop,b=b.offsetParent};
glam.GraphicsThreeJS.prototype.onDocumentMouseMove=function(a){a.preventDefault();var b={};this.calcElementOffset(b);a={type:a.type,pageX:a.pageX,pageY:a.pageY,elementX:a.pageX-b.left,elementY:a.pageY-b.top,button:a.button,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey};glam.Mouse.instance.onMouseMove(a);glam.PickManager&&glam.PickManager.handleMouseMove(a);glam.Application.handleMouseMove(a)};
glam.GraphicsThreeJS.prototype.onDocumentMouseDown=function(a){a.preventDefault();var b={};this.calcElementOffset(b);a={type:a.type,pageX:a.pageX,pageY:a.pageY,elementX:a.pageX-b.left,elementY:a.pageY-b.top,button:a.button,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey};glam.Mouse.instance.onMouseDown(a);glam.PickManager&&glam.PickManager.handleMouseDown(a);glam.Application.handleMouseDown(a)};
glam.GraphicsThreeJS.prototype.onDocumentMouseUp=function(a){a.preventDefault();var b={};this.calcElementOffset(b);a={type:a.type,pageX:a.pageX,pageY:a.pageY,elementX:a.pageX-b.left,elementY:a.pageY-b.top,button:a.button,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey};glam.Mouse.instance.onMouseUp(a);glam.PickManager&&glam.PickManager.handleMouseUp(a);glam.Application.handleMouseUp(a)};
glam.GraphicsThreeJS.prototype.onDocumentMouseClick=function(a){a.preventDefault();var b={};this.calcElementOffset(b);a={type:a.type,pageX:a.pageX,pageY:a.pageY,elementX:a.pageX-b.left,elementY:a.pageY-b.top,button:a.button,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey};glam.Mouse.instance.onMouseClick(a);glam.PickManager&&glam.PickManager.handleMouseClick(a);glam.Application.handleMouseClick(a)};
glam.GraphicsThreeJS.prototype.onDocumentMouseDoubleClick=function(a){a.preventDefault();var b={};this.calcElementOffset(b);var c=a.pageX-b.left,d=a.pageY-b.top,c=a.pageX-b.left,d=a.pageY-b.top;a={type:a.type,pageX:a.pageX,pageY:a.pageY,elementX:c,elementY:d,button:a.button,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey};glam.Mouse.instance.onMouseDoubleClick(a);glam.PickManager&&glam.PickManager.handleMouseDoubleClick(a);glam.Application.handleMouseDoubleClick(a)};
glam.GraphicsThreeJS.prototype.onDocumentMouseScroll=function(a){a.preventDefault();var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail);a={type:"mousescroll",delta:b};glam.Mouse.instance.onMouseScroll(a);glam.PickManager&&glam.PickManager.handleMouseScroll(a);glam.Application.handleMouseScroll(a)};
glam.GraphicsThreeJS.prototype.translateTouch=function(a,b){return{screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,elementX:a.pageX-b.left,elementY:a.pageY-b.top}};
glam.GraphicsThreeJS.prototype.onDocumentTouchStart=function(a){a.preventDefault();var b={};this.calcElementOffset(b);var c=[],d,e=a.touches.length;for(d=0;d<e;d++)c.push(this.translateTouch(a.touches[d],b));a={type:a.type,touches:c};glam.PickManager&&glam.PickManager.handleTouchStart(a);glam.Application.handleTouchStart(a)};
glam.GraphicsThreeJS.prototype.onDocumentTouchMove=function(a){a.preventDefault();var b={};this.calcElementOffset(b);var c=[],d,e=a.touches.length;for(d=0;d<e;d++)c.push(this.translateTouch(a.touches[d],b));var f=[],e=a.changedTouches.length;for(d=0;d<e;d++)f.push(this.translateTouch(a.changedTouches[d],b));a={type:a.type,touches:c,changedTouches:f};glam.PickManager&&glam.PickManager.handleTouchMove(a);glam.Application.handleTouchMove(a)};
glam.GraphicsThreeJS.prototype.onDocumentTouchEnd=function(a){a.preventDefault();var b={};this.calcElementOffset(b);var c=[],d,e=a.touches.length;for(d=0;d<e;d++)c.push(this.translateTouch(a.touches[d],b));var f=[],e=a.changedTouches.length;for(d=0;d<e;d++)f.push(this.translateTouch(a.changedTouches[d],b));a={type:a.type,touches:c,changedTouches:f};glam.PickManager&&glam.PickManager.handleTouchEnd(a);glam.Application.handleTouchEnd(a)};
glam.GraphicsThreeJS.prototype.onKeyDown=function(a){a.preventDefault();glam.Keyboard.instance.onKeyDown(a);glam.Application.handleKeyDown(a)};glam.GraphicsThreeJS.prototype.onKeyUp=function(a){a.preventDefault();glam.Keyboard.instance.onKeyUp(a);glam.Application.handleKeyUp(a)};glam.GraphicsThreeJS.prototype.onKeyPress=function(a){a.preventDefault();glam.Keyboard.instance.onKeyPress(a);glam.Application.handleKeyPress(a)};
glam.GraphicsThreeJS.prototype.onWindowResize=function(a){a=this.container.offsetWidth;var b=this.container.offsetHeight;this.riftCam&&(a=window.innerWidth,b=window.innerHeight);this.cardboard&&this.cardboard.setSize(a,b);this.renderer.setSize(a,b);this.composer&&this.composer.setSize(a,b);glam.CameraManager&&glam.CameraManager.handleWindowResize(this.container.offsetWidth,this.container.offsetHeight)||(this.camera.aspect=this.container.offsetWidth/this.container.offsetHeight,this.camera.updateProjectionMatrix())};
glam.GraphicsThreeJS.prototype.onFullScreenChanged=function(a){this.fullscreen=document.mozFullscreenElement||document.webkitFullscreenElement?!0:!1};glam.GraphicsThreeJS.prototype.setCursor=function(a){a||(a=this.saved_cursor);this.container.style.cursor=a};
glam.GraphicsThreeJS.prototype.update=function(){var a=Date.now(),b=(a-this.lastFrameTime)/1E3;this.frameRate=1/b;this.lastFrameTime=a;this.composer?this.renderEffects(b):this.cardboard?this.renderStereo():this.riftCam&&this.riftCam._vrHMD?this.renderVR():this.render();this.stats&&this.stats.update()};
glam.GraphicsThreeJS.prototype.render=function(){this.renderer.setClearColor(0,0);this.renderer.autoClearColor=!0;this.renderer.render(this.backgroundLayer.scene,this.backgroundLayer.camera);this.renderer.setClearColor(0,1);this.renderer.autoClearColor=!1;this.renderer.render(this.scene,this.camera)};glam.GraphicsThreeJS.prototype.renderVR=function(){this.riftCam.render([this.backgroundLayer.scene,this.scene],[this.backgroundLayer.camera,this.camera])};
glam.GraphicsThreeJS.prototype.renderEffects=function(a){this.composer.render(a)};glam.GraphicsThreeJS.prototype.renderStereo=function(){this.cardboard.render([this.backgroundLayer.scene,this.scene],[this.backgroundLayer.camera,this.camera])};glam.GraphicsThreeJS.prototype.enableShadows=function(a){this.renderer.shadowMapEnabled=a;this.renderer.shadowMapSoft=a;this.renderer.shadowMapCullFrontFaces=!1};
glam.GraphicsThreeJS.prototype.setFullScreen=function(a){this.riftCam?(this.fullscreen=a,this.riftCam.setFullScreen(a)):this.cardboard&&(a?this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen())};glam.GraphicsThreeJS.prototype.setCamera=function(a){this.camera=a;this.composer&&this.composer.setCamera(a)};
glam.GraphicsThreeJS.prototype.addEffect=function(a){this.composer||(this.composer=new glam.Composer);this.effects||(this.effects=[]);if(a.isShaderEffect)for(var b=0;b<this.effects.length;b++);this.effects.push(a);this.composer.addEffect(a)};glam.GraphicsThreeJS.default_display_stats=!1;glam.TweenService=function(){};goog.inherits(glam.TweenService,glam.Service);glam.TweenService.prototype.initialize=function(a){};glam.TweenService.prototype.terminate=function(){};glam.TweenService.prototype.update=function(){window.TWEEN&&TWEEN.update()};glam.Services={};glam.Services._serviceMap={time:{object:glam.Time},input:{object:glam.Input},tween:{object:glam.TweenService},events:{object:glam.EventService},graphics:{object:glam.GraphicsThreeJS}};
glam.Services.create=function(a){var b=glam.Services._serviceMap[a];if(b){if(glam.Services[a])throw Error("Cannot create two "+a+" service instances");if(b.object)return b=new b.object,glam.Services[a]=b;throw Error("No object type supplied for creating service "+a+"; cannot create");}throw Error("Unknown service: "+a+"; cannot create");};
glam.Services.registerService=function(a,b){if(glam.Services._serviceMap[a])throw Error("Service "+a+"already registered; cannot register twice");glam.Services._serviceMap[a]={object:b}};glam.DOM={documents:{},documentIndex:0,styles:{},viewers:{},animations:{}};glam.DOM.isReady=!1;glam.DOM.ready=function(){glam.DOM.isReady||(glam.DOMParser.parseDocument(),glam.DOM.createViewers(),glam.DOM.isReady=!0)};glam.DOM.createViewers=function(){for(var a in glam.DOM.documents){var b=new glam.DOMViewer(glam.DOM.documents[a]);glam.DOM.viewers[a]=b;b.go()}};glam.DOM.addStyle=function(a,b){glam.DOM.styles[a]=b};glam.DOM.getStyle=function(a){return glam.DOM.styles[a]};
glam.DOM.addAnimation=function(a,b){glam.DOM.animations[a]=b};glam.DOM.getAnimation=function(a){return glam.DOM.animations[a]};window.addEventListener("load",function(){glam.DOM.ready()},!1);glam.Picker=function(a){a=a||{};glam.Component.call(this,a);this.overCursor=a.overCursor;this.enabled=void 0!==a.enabled?a.enabled:!0};goog.inherits(glam.Picker,glam.Component);glam.Picker.prototype._componentCategory="pickers";glam.Picker.prototype.realize=function(){glam.Component.prototype.realize.call(this);this.lastHitPoint=new THREE.Vector3;this.lastHitNormal=new THREE.Vector3;this.lastHitFace=new THREE.Face3};glam.Picker.prototype.update=function(){};
glam.Picker.prototype.toModelSpace=function(a){var b=new THREE.Matrix4;b.getInverse(this._object.transform.object.matrixWorld);a.applyMatrix4(b)};glam.Picker.prototype.onMouseOver=function(a){this.dispatchEvent("mouseover",a)};glam.Picker.prototype.onMouseOut=function(a){this.dispatchEvent("mouseout",a)};
glam.Picker.prototype.onMouseMove=function(a){var b=glam.PickManager.objectFromMouse(a);if(this._object==glam.PickManager.clickedObject||this._object==b)a.point&&this.lastHitPoint.copy(a.point),a.normal&&this.lastHitNormal.copy(a.normal),a.face&&(this.lastHitFace=a.face),a.point&&this.dispatchEvent("mousemove",a)};
glam.Picker.prototype.onMouseDown=function(a){this.lastHitPoint.copy(a.point);a.normal&&this.lastHitNormal.copy(a.normal);a.face&&(this.lastHitFace=a.face);this.dispatchEvent("mousedown",a)};glam.Picker.prototype.onMouseUp=function(a){glam.PickManager.objectFromMouse(a)!=this._object&&(a.point=this.lastHitPoint,a.normal=this.lastHitNormal,a.face=this.lastHitNormal,this.dispatchEvent("mouseout",a));this.dispatchEvent("mouseup",a)};
glam.Picker.prototype.onMouseClick=function(a){this.lastHitPoint.copy(a.point);a.normal&&this.lastHitNormal.copy(a.normal);a.face&&(this.lastHitFace=a.face);this.dispatchEvent("click",a)};glam.Picker.prototype.onMouseDoubleClick=function(a){this.lastHitPoint.copy(a.point);a.normal&&this.lastHitNormal.copy(a.normal);a.face&&(this.lastHitFace=a.face);this.dispatchEvent("dblclick",a)};glam.Picker.prototype.onMouseScroll=function(a){this.dispatchEvent("mousescroll",a)};
glam.Picker.prototype.onTouchMove=function(a){this.dispatchEvent("touchmove",a)};glam.Picker.prototype.onTouchStart=function(a){this.dispatchEvent("touchstart",a)};glam.Picker.prototype.onTouchEnd=function(a){this.dispatchEvent("touchend",a)};glam.SurfaceDragger=function(a){a=a||{};glam.Picker.call(this,a);this.reference=a.reference;this.dragPlane=new THREE.Plane};goog.inherits(glam.SurfaceDragger,glam.Picker);glam.SurfaceDragger.prototype.realize=function(){glam.Picker.prototype.realize.call(this)};glam.SurfaceDragger.prototype.update=function(){};
glam.SurfaceDragger.prototype.onMouseDown=function(a){glam.Picker.prototype.onMouseDown.call(this,a);var b=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,this.reference.visuals[0].object);b&&(b=b.point.clone(),this.dragOffset=a.point.clone().sub(this._object.transform.position),this.dispatchEvent("dragstart",{type:"dragstart",offset:b}))};glam.SurfaceDragger.prototype.onMouseUp=function(a){glam.Picker.prototype.onMouseUp.call(this,a);this.dispatchEvent("dragend",{type:"dragend"})};
glam.SurfaceDragger.prototype.onMouseMove=function(a){glam.Picker.prototype.onMouseMove.call(this,a);var b=this.reference.visuals[0],c=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,b.object);if(c){var d=c.point.clone();a=c.face.normal.clone();var e=b.geometry.vertices,b=e[c.face.a],f=e[c.face.b],c=e[c.face.c];this.dragPlane=(new THREE.Plane).setFromCoplanarPoints(b,f,c);d=d.clone();c=d.clone().add(a);b=(new THREE.Vector3(0,a.z,-a.y)).normalize();b.lengthSq()||b.set(0,a.x,a.y).normalize();
(0>a.x||0>a.z)&&b.negate();this.dispatchEvent("drag",{type:"drag",offset:d,normal:a,up:b,lookAt:c})}};glam.DOMRenderer={};glam.Visual=function(a){a=a||{};glam.SceneComponent.call(this,a);a.object?(this.object=a.object,this.geometry=this.object.geometry,this.material=this.object.material):(this.geometry=a.geometry,this.material=a.material)};goog.inherits(glam.Visual,glam.SceneComponent);glam.Visual.prototype._componentCategory="visuals";
glam.Visual.prototype.realize=function(){glam.SceneComponent.prototype.realize.call(this);!this.object&&(this.geometry&&this.material)&&(this.object=new THREE.Mesh(this.geometry,this.material),this.object.ignorePick=!1,this.addToScene())};glam.Decoration=function(a){a=a||{};glam.Visual.call(this,a)};goog.inherits(glam.Decoration,glam.Visual);glam.Decoration.prototype._componentCategory="decorations";glam.Decoration.prototype.realize=function(){glam.Visual.prototype.realize.call(this);this.object.ignorePick=!0};glam.Interpolator=function(a){glam.EventDispatcher.call(a);a=a||{};this.keys=a.keys||[];this.values=a.values||[];this.target=a.target?a.target:null;this.running=!1};goog.inherits(glam.Interpolator,glam.EventDispatcher);glam.Interpolator.prototype.realize=function(){this.keys&&this.values&&this.setValue(this.keys,this.values)};glam.Interpolator.prototype.setValue=function(a,b){this.keys=[];this.values=[];a&&(a.length&&b&&b.length)&&(this.copyKeys(a,this.keys),this.copyValues(b,this.values))};
glam.Interpolator.prototype.copyKeys=function(a,b){for(var c=0,d=a.length,c=0;c<d;c++)b[c]=a[c]};glam.Interpolator.prototype.copyValues=function(a,b){for(var c=0,d=a.length,c=0;c<d;c++){var e={};this.copyValue(a[c],e);b[c]=e}};glam.Interpolator.prototype.copyValue=function(a,b){for(var c in a)null!==a[c]&&(b[c]=a[c])};
glam.Interpolator.prototype.interp=function(a){var b,c,d=this.keys.length;a==this.keys[0]?b=this.values[0]:a>=this.keys[d-1]&&(b=this.values[d-1]);for(c=0;c<d-1;c++){var e=this.keys[c],f=this.keys[c+1];a>=e&&a<=f&&(b=this.tween(this.values[c],this.values[c+1],(a-e)/(f-e)))}this.target?this.copyValue(b,this.target):this.publish("value",b)};glam.Interpolator.prototype.tween=function(a,b,c){var d={},e;for(e in a)null!==a[e]&&(d[e]=a[e]+(b[e]-a[e])*c);return d};glam.ArcElement={};glam.ArcElement.DEFAULT_RADIUS=2;glam.ArcElement.DEFAULT_RADIUS_SEGMENTS=32;glam.ArcElement.DEFAULT_START_ANGLE="0deg";glam.ArcElement.DEFAULT_END_ANGLE="360deg";glam.ArcElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.ArcElement)};
glam.ArcElement.getAttributes=function(a,b,c){var d=a.getAttribute("radius")||glam.ArcElement.DEFAULT_RADIUS,e=a.getAttribute("radiusSegments")||glam.ArcElement.DEFAULT_RADIUS_SEGMENTS,f=a.getAttribute("startAngle")||glam.ArcElement.DEFAULT_START_ANGLE;a=a.getAttribute("endAngle")||glam.ArcElement.DEFAULT_END_ANGLE;b&&(b.radius&&(d=b.radius),b.radiusSegments&&(e=b.radiusSegments),b.startAngle&&(f=b.startAngle),b.endAngle&&(a=b.endAngle));d=parseFloat(d);e=parseInt(e);f=glam.DOMTransform.parseRotation(f);
a=glam.DOMTransform.parseRotation(a);c.radius=d;c.radiusSegments=e;c.startAngle=f;c.endAngle=a};glam.ArcElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.CircleGeometry(c.radius,c.radiusSegments,c.startAngle,c.endAngle),material:b})};glam.Prefabs={};glam.Script=function(a){a=a||{};glam.Component.call(this,a)};goog.inherits(glam.Script,glam.Component);glam.Script.prototype._componentCategory="scripts";glam.Script.prototype.realize=function(){glam.Component.prototype.realize.call(this)};glam.Script.prototype.update=function(){glam.Script.WARN_ON_ABSTRACT&&glam.System.warn("Abstract Script.evaluate called")};glam.Script.WARN_ON_ABSTRACT=!0;glam.Prefabs.FirstPersonController=function(a){a=a||{};var b=new glam.Object(a),c=new glam.FirstPersonControllerScript(a);b.addComponent(c);a=new glam.DirectionalLight({intensity:a.headlight?1:0});b.addComponent(a);return b};
glam.FirstPersonControllerScript=function(a){glam.Script.call(this,a);this._enabled=void 0!==a.enabled?a.enabled:!0;this._move=void 0!==a.move?a.move:!0;this._look=void 0!==a.look?a.look:!0;this._turn=void 0!==a.turn?a.turn:!0;this._tilt=void 0!==a.tilt?a.tilt:!0;this._mouseLook=void 0!==a.mouseLook?a.mouseLook:!1;this.testCollisions=void 0!==a.testCollisions?a.testCollisions:!1;this.collisionDistance=10;this.moveSpeed=13;this.tiltSpeed=this.turnSpeed=5;this.lookSpeed=1;this.savedCameraPos=new THREE.Vector3;
this.movementVector=new THREE.Vector3;Object.defineProperties(this,{camera:{get:function(){return this._camera},set:function(a){this.setCamera(a)}},enabled:{get:function(){return this._enabled},set:function(a){this.setEnabled(a)}},move:{get:function(){return this._move},set:function(a){this.setMove(a)}},look:{get:function(){return this._look},set:function(a){this.setLook(a)}},mouseLook:{get:function(){return this._mouseLook},set:function(a){this.setMouseLook(a)}},headlightOn:{get:function(){return this._headlightOn},
set:function(a){this.setHeadlightOn(a)}}})};goog.inherits(glam.FirstPersonControllerScript,glam.Script);glam.FirstPersonControllerScript.prototype.realize=function(){this.headlight=this._object.getComponent(glam.DirectionalLight);this.headlight.intensity=this._headlightOn?1:0};
glam.FirstPersonControllerScript.prototype.createControls=function(a){a=new glam.FirstPersonControls(a.object,glam.Graphics.instance.container);a.mouseLook=this._mouseLook;a.movementSpeed=this._move?this.moveSpeed:0;a.lookSpeed=this._look?this.lookSpeed:0;a.turnSpeed=this._turn?this.turnSpeed:0;a.tiltSpeed=this._tilt?this.tiltSpeed:0;this.clock=new THREE.Clock;return a};
glam.FirstPersonControllerScript.prototype.update=function(){this.saveCamera();this.controls.update(this.clock.getDelta());var a=this.testCollisions?this.testCollision():null;a&&a.object&&(this.restoreCamera(),this.dispatchEvent("collide",a));this.testTerrain()&&this.restoreCamera();this._headlightOn&&this.headlight.direction.copy(this._camera.position).negate()};glam.FirstPersonControllerScript.prototype.setEnabled=function(a){this._enabled=a;this.controls.enabled=a};
glam.FirstPersonControllerScript.prototype.setMove=function(a){this._move=a;this.controls.movementSpeed=a?this.moveSpeed:0};glam.FirstPersonControllerScript.prototype.setLook=function(a){this._look=a;this.controls.lookSpeed=a?1:0};glam.FirstPersonControllerScript.prototype.setMouseLook=function(a){this._mouseLook=a;this.controls.mouseLook=a};
glam.FirstPersonControllerScript.prototype.setCamera=function(a){this._camera=a;this.controls=this.createControls(a);this.controls.movementSpeed=this.moveSpeed;this.controls.lookSpeed=this._look?0.1:0};glam.FirstPersonControllerScript.prototype.saveCamera=function(){this.savedCameraPos.copy(this._camera.position)};glam.FirstPersonControllerScript.prototype.restoreCamera=function(){this._camera.position.copy(this.savedCameraPos)};
glam.FirstPersonControllerScript.prototype.testCollision=function(){this.movementVector.copy(this._camera.position).sub(this.savedCameraPos);if(this.movementVector.length()){var a=glam.Graphics.instance.objectFromRay(null,this.savedCameraPos,this.movementVector,1,2);a&&a.object&&this.savedCameraPos.distanceTo(a.hitPointWorld);return a}return null};glam.FirstPersonControllerScript.prototype.testTerrain=function(){return!1};
glam.FirstPersonControllerScript.prototype.setHeadlightOn=function(a){this._headlightOn=a;this.headlight&&(this.headlight.intensity=a?1:0)};glam.Transition=function(a){glam.Component.call(this,a);a=a||{};this.running=!1;this.duration=a.duration?a.duration:glam.Transition.default_duration;this.loop=a.loop?a.loop:!1;this.autoStart=a.autoStart||!1;this.easing=a.easing||glam.Transition.default_easing;this.target=a.target;this.to=a.to};goog.inherits(glam.Transition,glam.Component);glam.Transition.prototype.realize=function(){glam.Component.prototype.realize.call(this);this.createTweens();this.autoStart&&this.start()};
glam.Transition.prototype.createTweens=function(){var a=this.loop?Infinity:0,b=this;this.tween=(new TWEEN.Tween(this.target)).to(this.to,this.duration).easing(this.easing).repeat(a).onComplete(function(){b.onTweenComplete()})};glam.Transition.prototype.start=function(){this.running||(this.running=!0,this.tween.start())};glam.Transition.prototype.stop=function(){this.running&&(this.running=!1,this.dispatchEvent("complete"),this.tween.stop())};
glam.Transition.prototype.onTweenComplete=function(){this.running=!1;this.dispatchEvent("complete")};glam.Transition.default_duration=1E3;glam.Transition.default_easing=TWEEN.Easing.Linear.None;glam.Composer=function(a){if(glam.Composer.instance)throw Error("Composer singleton already exists");glam.Composer.instance=this;a=glam.Graphics.instance;a.renderer.autoClear=!1;this.composer=new THREE.EffectComposer(a.riftCam?a.riftCam:a.renderer);var b=new THREE.RenderPass(a.backgroundLayer.scene,a.backgroundLayer.camera);b.clear=!0;this.composer.addPass(b);a=new THREE.RenderPass(a.scene,a.camera);a.clear=!1;this.composer.addPass(a);a=new THREE.ShaderPass(THREE.CopyShader);a.renderToScreen=!0;this.composer.addPass(a)};
glam.Composer.prototype.render=function(a){this.composer.render(a)};glam.Composer.prototype.addEffect=function(a){this.composer.insertPass(a.pass,this.composer.passes.length-1)};glam.Composer.prototype.setCamera=function(a){this.composer.passes[1].camera=a};glam.Composer.prototype.setSize=function(a,b){this.composer.setSize(a,b)};glam.Composer.instance=null;glam.BoxElement={};glam.BoxElement.DEFAULT_WIDTH=2;glam.BoxElement.DEFAULT_HEIGHT=2;glam.BoxElement.DEFAULT_DEPTH=2;glam.BoxElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.BoxElement)};
glam.BoxElement.getAttributes=function(a,b,c){var d=a.getAttribute("width")||glam.BoxElement.DEFAULT_WIDTH,e=a.getAttribute("height")||glam.BoxElement.DEFAULT_HEIGHT;a=a.getAttribute("depth")||glam.BoxElement.DEFAULT_DEPTH;b&&(b.width&&(d=b.width),b.height&&(e=b.height),b.depth&&(a=b.depth));d=parseFloat(d);e=parseFloat(e);a=parseFloat(a);c.width=d;c.height=e;c.depth=a};glam.BoxElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.BoxGeometry(c.width,c.height,c.depth),material:b})};glam.Camera=function(a){a=a||{};glam.SceneComponent.call(this,a);Object.defineProperties(this,{active:{get:function(){return this._active},set:function(a){(this._active=a)&&glam.CameraManager.setActiveCamera(this)}}});this._active=a.active||!1};goog.inherits(glam.Camera,glam.SceneComponent);glam.Camera.prototype._componentProperty="camera";glam.Camera.prototype._componentPropertyType="Camera";
glam.Camera.prototype.realize=function(){glam.SceneComponent.prototype.realize.call(this);this.addToScene();glam.CameraManager.addCamera(this);this._active&&!glam.CameraManager.activeCamera&&glam.CameraManager.setActiveCamera(this)};glam.Camera.prototype.lookAt=function(a){this.object.lookAt(a)};glam.Camera.DEFAULT_POSITION=new THREE.Vector3(0,0,0);glam.Camera.DEFAULT_NEAR=1;glam.Camera.DEFAULT_FAR=1E4;glam.PerspectiveCamera=function(a){a=a||{};if(a.object)this.object=a.object;else{var b=a.fov||45,c=a.near||glam.Camera.DEFAULT_NEAR,d=a.far||glam.Camera.DEFAULT_FAR,e=glam.Graphics.instance.container,e=a.aspect||e.offsetWidth/e.offsetHeight;this.updateProjection=!1;this.object=new THREE.PerspectiveCamera(b,e,c,d)}Object.defineProperties(this,{fov:{get:function(){return this.object.fov},set:function(a){this.object.fov=a;this.updateProjection=!0}},aspect:{get:function(){return this.object.aspect},set:function(a){this.object.aspect=
a;this.updateProjection=!0}},near:{get:function(){return this.object.near},set:function(a){this.object.near=a;this.updateProjection=!0}},far:{get:function(){return this.object.far},set:function(a){this.object.far=a;this.updateProjection=!0}}});glam.Camera.call(this,a)};goog.inherits(glam.PerspectiveCamera,glam.Camera);glam.PerspectiveCamera.prototype.realize=function(){glam.Camera.prototype.realize.call(this)};
glam.PerspectiveCamera.prototype.update=function(){this.updateProjection&&(this.object.updateProjectionMatrix(),this.updateProjection=!1)};glam.PointerLockControls=function(a){var b=this;this.speed=0.05;this.speedMultiplier=1;this.fly=!1;this.jumpPower=0.1;this.gravity=0;a.rotation.set(0,0,0);var c=new THREE.Object3D;c.add(a);var d=new THREE.Object3D;d.position.y=10;d.add(c);var e=!1,f=!1,g=!1,k=!1,h=new THREE.Vector3,m=Math.PI/2;document.addEventListener("mousemove",function(a){if(!1!==b.enabled){var e=a.movementY||a.mozMovementY||a.webkitMovementY||0;d.rotation.y-=0.002*(a.movementX||a.mozMovementX||a.webkitMovementX||0);c.rotation.x-=
0.002*e;c.rotation.x=Math.max(-m,Math.min(m,c.rotation.x))}},!1);document.addEventListener("keydown",function(a){switch(a.keyCode){case 16:this.speedMultiplier=10;break;case 17:this.speedMultiplier=0.5;break;case 38:case 87:e=!0;break;case 37:case 65:g=!0;break;case 40:case 83:f=!0;break;case 39:case 68:k=!0;break;case 67:h.y+=this.jumpPower;break;case 32:h.y-=this.jumpPower}}.bind(this),!1);document.addEventListener("keyup",function(a){switch(a.keyCode){case 16:this.speedMultiplier=1;break;case 17:this.speedMultiplier=
1;break;case 38:case 87:e=!1;break;case 37:case 65:g=!1;break;case 40:case 83:f=!1;break;case 39:case 68:k=!1;break;case 32:h.y=0;break;case 67:h.y=0}}.bind(this),!1);this.enabled=!1;this.getObject=function(){return d};this.getPosition=function(){return(new THREE.Vector3).copy(d.position)};this.getDirection=function(){var a=new THREE.Vector3(0,0,-1),b=new THREE.Euler(0,0,0,"YXZ");return function(){v=new THREE.Vector3;b.set(c.rotation.x,d.rotation.y,0);v.copy(a).applyEuler(b);return v}}();this.update=
function(a){!1!==b.enabled&&(a*=0.1,h.x+=0.08*-h.x*a,h.z+=0.08*-h.z*a,h.y-=this.gravity*a,e&&(h.z-=this.speed*a*this.speedMultiplier),f&&(h.z+=this.speed*a*this.speedMultiplier),g&&(h.x-=this.speed*a*this.speedMultiplier),k&&(h.x+=this.speed*a*this.speedMultiplier),d.translateX(h.x),d.translateY(h.y),d.translateZ(h.z),10>d.position.y&&(h.y=0,d.position.y=10))}};glam.VisualElement={};glam.VisualElement.create=function(a,b,c){var d={};c.getAttributes(a,b,d);var e=new glam.Object;(b=glam.DOMMaterial.create(b,function(b){glam.VisualElement.createVisual(e,c,a,b,d)}))&&glam.VisualElement.createVisual(e,c,a,b,d);return e};glam.VisualElement.createVisual=function(a,b,c,d,e){if(b=b.createVisual(c,d,e))a.addComponent(b),glam.VisualElement.addProperties(c,a)};
glam.VisualElement.addProperties=function(a,b){var c=b.getComponents(glam.Visual)[0];c&&(a.geometry=c.geometry,a.material=c.material)};glam.DOMViewer=function(a){this.document=a;this.documentParent=a.parentElement;this.riftRender=glam.DOM.riftRender||!1;this.cardboardRender=glam.DOM.cardboardRender||!1;this.displayStats=glam.DOM.displayStats||!1};glam.DOMViewer.prototype={};
glam.DOMViewer.prototype.initRenderer=function(){var a=this.document.getElementsByTagName("renderer");a&&(a=a[0])&&(a=a.getAttribute("type").toLowerCase(),"rift"==a?this.riftRender=!0:"cardboard"==a&&(this.cardboardRender=!0));this.app=new glam.Viewer({container:this.documentParent,headlight:!1,riftRender:this.riftRender,cardboard:this.cardboardRender,displayStats:this.displayStats})};
glam.DOMViewer.prototype.initDefaultScene=function(){this.scene=new glam.Object;this.app.sceneRoot.addChild(this.scene);this.app.defaultCamera.position.set(0,0,5)};glam.DOMViewer.prototype.traverseScene=function(){var a=this.document.getElementsByTagName("scene");a?this.traverse(a[0],this.scene):console.warn("Document error! glam requires one 'scene' element")};
glam.DOMViewer.prototype.traverse=function(a,b){var c=a.tagName,d,e,f=a.childNodes;e=f.length;for(d=0;d<e;d++){var g=f[d];(c=g.tagName)&&(c=c.toLowerCase());var k=null;if((c=c?glam.DOMTypes.types[c]:null)&&c.cls&&(k=c.cls.create)&&"function"==typeof k){glam.DOMElement.init(g);var h=glam.DOMElement.getStyle(g);if(k=k.call(this,g,h,this.app))g.glam.object=k,this.addFeatures(g,h,k,c),b.addChild(k),this.traverse(g,k)}}};
glam.DOMViewer.prototype.addNode=function(a){var b=a.tagName;b&&(b=b.toLowerCase());var c=null;if((b=b?glam.DOMTypes.types[b]:null)&&b.cls&&(c=b.cls.create)&&"function"==typeof c){glam.DOMElement.init(a);var d=glam.DOMElement.getStyle(a);if(c=c.call(this,a,d,this.app))a.glam.object=c,this.addFeatures(a,d,c,b),this.scene.addChild(c),this.traverse(a,c)}};glam.DOMViewer.prototype.removeNode=function(a){(a=a.glam.object)&&a._parent.removeChild(a)};
glam.DOMViewer.prototype.addFeatures=function(a,b,c,d){d.transform&&glam.DOMTransform.parse(a,b,c);d.animation&&(glam.AnimationElement.parse(a,b,c),glam.TransitionElement.parse(a,b,c));d.input&&glam.DOMInput.add(a,c);d.visual&&(glam.VisualElement.addProperties(a,c),glam.DOMMaterial.addHandlers(a,b,c))};glam.DOMViewer.prototype.go=function(){this.initRenderer();this.initDefaultScene();this.traverseScene();this.prepareViewsAndControllers();this.app.run()};
glam.DOMViewer.prototype.prepareViewsAndControllers=function(){var a=this.app.cameras;if(a&&a.length){var a=a[0],b=glam.Application.instance.controllerScript;b.camera=a;b.enabled=!0;a.active=!0}};glam.Object=function(a){glam.EventDispatcher.call(this);this._id=glam.Object.nextId++;this._parent=null;this._children=[];this._components=[];this.name="";this._realized=this._realizing=!1;var b=!0;a&&void 0!==a.autoCreateTransform&&(b=a.autoCreateTransform);b&&this.addComponent(new glam.Transform(a))};goog.inherits(glam.Object,glam.EventDispatcher);glam.Object.nextId=0;glam.Object.prototype.getID=function(){return this._id};glam.Object.prototype.setParent=function(a){this._parent=a};
glam.Object.prototype.addChild=function(a){if(!a)throw Error("Cannot add a null child");if(a._parent)throw Error("Child is already attached to an Object");a.setParent(this);this._children.push(a);!this._realizing&&!this._realized||a._realized||a.realize()};glam.Object.prototype.removeChild=function(a){var b=this._children.indexOf(a);-1!=b&&(this._children.splice(b,1),a.removeAllComponents(),a.setParent(null),a._realized=a._realizing=!1)};
glam.Object.prototype.getChild=function(a){return a>=this._children.length?null:this._children[a]};
glam.Object.prototype.addComponent=function(a){if(!a)throw Error("Cannot add a null component");if(a._object)throw Error("Component is already attached to an Object");var b=Object.getPrototypeOf(a);if(b._componentProperty){if(this[b._componentProperty]){glam.System.warn("Object already has a "+b._componentPropertyType+" component");return}this[b._componentProperty]=a}b._componentCategory&&(this[b._componentCategory]||(this[b._componentCategory]=[]),this[b._componentCategory].push(a));this._components.push(a);
a.setObject(this);!this._realizing&&!this._realized||a._realized||a.realize()};glam.Object.prototype.removeComponent=function(a){if(a){var b=this._components.indexOf(a);-1!=b&&(a.removeFromScene&&a.removeFromScene(),this._components.splice(b,1),a.setObject(null));b=Object.getPrototypeOf(a);b._componentProperty&&(this[b._componentProperty]=null);if(b._componentCategory&&this[b._componentCategory]){var c=this[b._componentCategory],b=c.indexOf(a);-1!=b&&c.splice(b,1)}}};
glam.Object.prototype.removeAllComponents=function(){var a,b=this._components.length;for(a=0;a<b;a++){var c=this._components[a];c.removeFromScene&&(c.removeFromScene(),c._realized=c._realizing=!1);c.setObject(null)}};glam.Object.prototype.getComponent=function(a){var b,c=this._components.length;for(b=0;b<c;b++){var d=this._components[b];if(d instanceof a)return d}return null};
glam.Object.prototype.getComponents=function(a){var b,c=this._components.length,d=[];for(b=0;b<c;b++){var e=this._components[b];e instanceof a&&d.push(e)}return d};glam.Object.prototype.realize=function(){this._realizing=!0;this.realizeComponents();this.realizeChildren();this._realized=!0};glam.Object.prototype.realizeComponents=function(){for(var a=this._components.length,b=0;b<a;++b)this._components[b]._realized||(this._components[b].setObject(this),this._components[b].realize())};
glam.Object.prototype.realizeChildren=function(){for(var a=this._children.length,b=0;b<a;++b)this._children[b]._realized||this._children[b].realize()};glam.Object.prototype.update=function(){this.updateComponents();this.updateChildren()};glam.Object.prototype.updateComponents=function(){for(var a=this._components.length,b=0;b<a;++b)this._components[b].update()};glam.Object.prototype.updateChildren=function(){for(var a=this._children.length,b=0;b<a;++b)this._children[b].update()};
glam.Object.prototype.traverse=function(a){a(this);var b,c=this._children.length;for(b=0;b<c;b++)this._children[b].traverse(a)};glam.Object.prototype.findCallback=function(a,b,c){if("string"==typeof b)a.name==b&&c.push(a);else if(b instanceof RegExp)(b=a.name.match(b))&&b.length&&c.push(a);else if(b instanceof Function)if(a instanceof b)c.push(a);else{a=a.getComponents(b);var d=a.length;for(b=0;b<d;b++)c.push(a[b])}};
glam.Object.prototype.findNode=function(a){var b=this,c=[];this.traverse(function(d){b.findCallback(d,a,c)});return c[0]};glam.Object.prototype.findNodes=function(a){var b=this,c=[];this.traverse(function(d){b.findCallback(d,a,c)});return c};glam.Object.prototype.map=function(a,b){var c=this.findNodes(a),d,e=c.length;for(d=0;d<e;d++)b(c[d])};glam.FadeBehavior=function(a){a=a||{};this.duration=void 0!==a.duration?a.duration:1;this.opacity=void 0!==a.opacity?a.opacity:0.5;this.savedOpacities=[];this.savedTransparencies=[];this.tween=null;glam.Behavior.call(this,a)};goog.inherits(glam.FadeBehavior,glam.Behavior);
glam.FadeBehavior.prototype.start=function(){if(!this.running){if(this._realized&&this._object.visuals){var a=this._object.visuals,b,c=a.length;for(b=0;b<c;b++)this.savedOpacities.push(a[b].material.opacity),this.savedTransparencies.push(a[b].material.transparent),a[b].material.transparent=1>this.opacity?!0:!1}this.value={opacity:this.savedOpacities[0]};this.targetValue={opacity:this.opacity};this.tween=(new TWEEN.Tween(this.value)).to(this.targetValue,1E3*this.duration).easing(TWEEN.Easing.Quadratic.InOut).repeat(0).start();
glam.Behavior.prototype.start.call(this)}};glam.FadeBehavior.prototype.evaluate=function(a){a>=this.duration&&(this.stop(),this.loop&&this.start());if(this._object.visuals){a=this._object.visuals;var b,c=a.length;for(b=0;b<c;b++)a[b].material.opacity=this.value.opacity}};glam.FadeBehavior.prototype.stop=function(){this.tween&&this.tween.stop();glam.Behavior.prototype.stop.call(this)};glam.Prefabs.Skybox=function(a){a=a||{};var b=new glam.Object({layer:glam.Graphics.instance.backgroundLayer}),c=THREE.ShaderLib.cube;c.uniforms.tCube.value=null;c=new THREE.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:c.uniforms,side:THREE.BackSide});c=new glam.Visual({geometry:new THREE.BoxGeometry(1E4,1E4,1E4),material:c});b.addComponent(c);a=new glam.SkyboxScript(a);b.addComponent(a);b.realize();return b};
glam.SkyboxScript=function(a){glam.Script.call(this,a);this.maincampos=new THREE.Vector3;this.maincamrot=new THREE.Quaternion;this.maincamscale=new THREE.Vector3;Object.defineProperties(this,{texture:{get:function(){return this.uniforms.tCube.value},set:function(a){this.uniforms.tCube.value=a}}})};goog.inherits(glam.SkyboxScript,glam.Script);
glam.SkyboxScript.prototype.realize=function(){this.uniforms=this._object.getComponent(glam.Visual).material.uniforms;this.camera=glam.Graphics.instance.backgroundLayer.camera;this.camera.far=2E4;this.camera.position.set(0,0,0)};glam.SkyboxScript.prototype.update=function(){var a=glam.Graphics.instance.camera;a.updateMatrixWorld();a.matrixWorld.decompose(this.maincampos,this.maincamrot,this.maincamscale);this.camera.quaternion.copy(this.maincamrot)};glam.LineElement={};glam.LineElement.create=function(a,b){var c=glam.DOMMaterial.create(b,null,"line"),d=new THREE.Geometry;glam.LineElement.parse(a,d,c);var e=new THREE.Line(d,c),f=new glam.Object,e=new glam.Visual({object:e});f.addComponent(e);a.geometry=d;a.material=c;return f};
glam.LineElement.parse=function(a,b,c){var d=a.getElementsByTagName("vertices");d&&(d=d[0],glam.DOMTypes.parseVector3Array(d,b.vertices));d=[];if(a=a.getElementsByTagName("colors"))if(a=a[0]){glam.DOMTypes.parseColor3Array(a,d);var e=d.length;for(a=0;a<e;a++)b.colors.push(d[a].clone());c.vertexColors=THREE.VertexColors}};glam.Application=function(a){glam.EventDispatcher.call(this);glam.Application.instance=this;this.initialize(a)};goog.inherits(glam.Application,glam.EventDispatcher);glam.Application.prototype.initialize=function(a){a=a||{};this.running=!1;this.tabstop=a.tabstop;this._services=[];this._objects=[];this.addService("time");this.addService("input");this.addOptionalServices();this.addService("tween");this.addService("events");this.addService("graphics");this.initServices(a)};
glam.Application.prototype.addService=function(a){a=glam.Services.create(a);this._services.push(a)};glam.Application.prototype.initServices=function(a){var b,c;c=this._services.length;for(b=0;b<c;b++)this._services[b].initialize(a)};glam.Application.prototype.addOptionalServices=function(){};glam.Application.prototype.focus=function(){glam.Graphics.instance.focus()};
glam.Application.prototype.run=function(){this.realizeObjects();glam.Graphics.instance.scene.updateMatrixWorld();this.lastFrameTime=Date.now();this.running=!0;this.runloop()};glam.Application.prototype.runloop=function(){var a=Date.now();a-this.lastFrameTime>=glam.Application.minFrameTime&&(this.updateServices(),this.lastFrameTime=a);var b=this;requestAnimationFrame(function(){b.runloop()})};glam.Application.prototype.updateServices=function(){var a,b;b=this._services.length;for(a=0;a<b;a++)this._services[a].update()};
glam.Application.prototype.updateObjects=function(){var a,b=this._objects.length;for(a=0;a<b;a++)this._objects[a].update()};glam.Application.prototype.addObject=function(a){this._objects.push(a);this.running&&a.realize()};glam.Application.prototype.removeObject=function(a){a=this._objects.indexOf(a);-1!=a&&this._objects.splice(a,1)};glam.Application.prototype.realizeObjects=function(){var a,b=this._objects.length;for(a=0;a<b;a++)this._objects[a].realize()};
glam.Application.prototype.onMouseMove=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseMove)this.mouseDelegate.onMouseMove(a)};glam.Application.prototype.onMouseDown=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseDown)this.mouseDelegate.onMouseDown(a)};glam.Application.prototype.onMouseUp=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseUp)this.mouseDelegate.onMouseUp(a)};glam.Application.prototype.onMouseClick=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseClick)this.mouseDelegate.onMouseClick(a)};
glam.Application.prototype.onMouseDoubleClick=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseDoubleClick)this.mouseDelegate.onMouseDoubleClick(a)};glam.Application.prototype.onMouseScroll=function(a){if(this.mouseDelegate&&this.mouseDelegate.onMouseScroll)this.mouseDelegate.onMouseScroll(a)};glam.Application.prototype.onKeyDown=function(a){if(this.keyboardDelegate&&this.keyboardDelegate.onKeyDown)this.keyboardDelegate.onKeyDown(a)};
glam.Application.prototype.onKeyUp=function(a){if(this.keyboardDelegate&&this.keyboardDelegate.onKeyUp)this.keyboardDelegate.onKeyUp(a)};glam.Application.prototype.onKeyPress=function(a){if(this.keyboardDelegate&&this.keyboardDelegate.onKeyPress)this.keyboardDelegate.onKeyPress(a)};glam.Application.instance=null;glam.Application.curObjectID=0;glam.Application.minFrameTime=1;glam.Application.handleMouseMove=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onMouseMove)glam.Application.instance.onMouseMove(a)};
glam.Application.handleMouseDown=function(a){glam.Application.instance.tabstop&&glam.Application.instance.focus();if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onMouseDown)glam.Application.instance.onMouseDown(a)};glam.Application.handleMouseUp=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onMouseUp)glam.Application.instance.onMouseUp(a)};
glam.Application.handleMouseClick=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onMouseClick)glam.Application.instance.onMouseClick(a)};glam.Application.handleMouseDoubleClick=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onMouseDoubleClick)glam.Application.instance.onMouseDoubleClick(a)};glam.Application.handleMouseScroll=function(a){if((!glam.PickManager||!glam.PickManager.overObject)&&glam.Application.instance.onMouseScroll)glam.Application.instance.onMouseScroll(a)};
glam.Application.handleTouchStart=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onTouchStart)glam.Application.instance.onTouchStart(a)};glam.Application.handleTouchMove=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onTouchMove)glam.Application.instance.onTouchMove(a)};glam.Application.handleTouchEnd=function(a){if((!glam.PickManager||!glam.PickManager.clickedObject)&&glam.Application.instance.onTouchEnd)glam.Application.instance.onTouchEnd(a)};
glam.Application.handleKeyDown=function(a){if(glam.Application.instance.onKeyDown)glam.Application.instance.onKeyDown(a)};glam.Application.handleKeyUp=function(a){if(glam.Application.instance.onKeyUp)glam.Application.instance.onKeyUp(a)};glam.Application.handleKeyPress=function(a){if(glam.Application.instance.onKeyPress)glam.Application.instance.onKeyPress(a)};glam.Application.prototype.onTouchMove=function(a){if(this.touchDelegate&&this.touchDelegate.onTouchMove)this.touchDelegate.onTouchMove(a)};
glam.Application.prototype.onTouchStart=function(a){if(this.touchDelegate&&this.touchDelegate.onTouchStart)this.touchDelegate.onTouchStart(a)};glam.Application.prototype.onTouchEnd=function(a){if(this.touchDelegate&&this.touchDelegate.onTouchEnd)this.touchDelegate.onTouchEnd(a)};glam.ViewPicker=function(a){a=a||{};glam.Component.call(this,a);this.enabled=void 0!==a.enabled?a.enabled:!0;this.position=new THREE.Vector3;this.mouse=new THREE.Vector3(0,0,1);this.unprojectedMouse=new THREE.Vector3;this.raycaster=new THREE.Raycaster;this.projector=new THREE.Projector;this.over=!1};goog.inherits(glam.ViewPicker,glam.Component);glam.ViewPicker.prototype._componentCategory="pickers";glam.ViewPicker.prototype.realize=function(){glam.Component.prototype.realize.call(this)};
glam.ViewPicker.prototype.update=function(){this.unprojectMouse();var a=this.checkForIntersections(this.unprojectedMouse);if(a!=this.over)if(this.over=a)this.onViewOver();else this.onViewOut()};glam.ViewPicker.prototype.unprojectMouse=function(){this.unprojectedMouse.copy(this.mouse);this.unprojectedMouse.unproject(glam.Graphics.instance.camera)};
glam.ViewPicker.prototype.checkForIntersections=function(a){a=a.clone();var b=new THREE.Vector3;b.applyMatrix4(glam.Graphics.instance.camera.matrixWorld);a.sub(b);a.normalize();this.raycaster.set(b,a);this.raycaster.near=glam.Graphics.instance.camera.near;this.raycaster.far=glam.Graphics.instance.camera.far;return 0<this.raycaster.intersectObjects(this._object.transform.object.children).length};glam.ViewPicker.prototype.onViewOver=function(){this.dispatchEvent("viewover",{type:"viewover"})};
glam.ViewPicker.prototype.onViewOut=function(){this.dispatchEvent("viewout",{type:"viewout"})};glam.DOMClassList=function(a){this.docelt=a;Array.call(this)};glam.DOMClassList.prototype=[];glam.DOMClassList.prototype.item=function(a){return this[a]};glam.DOMClassList.prototype.add=function(a){return this.push(a)};glam.DOMClassList.prototype.remove=function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1)};glam.ParticleEmitter=function(a){this.param=a||{};glam.Component.call(this,a);a=this.param.size||glam.ParticleEmitter.DEFAULT_SIZE;var b=this.param.sizeEnd||glam.ParticleEmitter.DEFAULT_SIZE_END,c=this.param.colorStart||glam.ParticleEmitter.DEFAULT_COLOR_START,d=this.param.colorEnd||glam.ParticleEmitter.DEFAULT_COLOR_END,e=this.param.particlesPerSecond||glam.ParticleEmitter.DEFAULT_PARTICLES_PER_SECOND,f=this.param.opacityStart||glam.ParticleEmitter.DEFAULT_OPACITY_START,g=this.param.opacityMiddle||
glam.ParticleEmitter.DEFAULT_OPACITY_MIDDLE,k=this.param.opacityEnd||glam.ParticleEmitter.DEFAULT_OPACITY_END,h=this.param.velocity||glam.ParticleEmitter.DEFAULT_VELOCITY,m=this.param.acceleration||glam.ParticleEmitter.DEFAULT_ACCELERATION,l=this.param.positionSpread||glam.ParticleEmitter.DEFAULT_POSITION_SPREAD,s=this.param.accelerationSpread||glam.ParticleEmitter.DEFAULT_ACCELERATION_SPREAD,p=this.param.blending||glam.ParticleEmitter.DEFAULT_BLENDING;this._active=!1;this.object=new SPE.Emitter({size:a,
sizeEnd:b,colorStart:c,colorEnd:d,particlesPerSecond:e,opacityStart:f,opacityMiddle:g,opacityEnd:k,velocity:h,acceleration:m,positionSpread:l,accelerationSpread:s,blending:p});Object.defineProperties(this,{active:{get:function(){return this._active},set:function(a){this.setActive(a)}}})};goog.inherits(glam.ParticleEmitter,glam.Component);glam.ParticleEmitter.prototype.realize=function(){};glam.ParticleEmitter.prototype.update=function(){};
glam.ParticleEmitter.prototype.setActive=function(a){(this._active=a)?this.object.enable():this.object.disable()};glam.ParticleEmitter.DEFAULT_SIZE=1;glam.ParticleEmitter.DEFAULT_SIZE_END=1;glam.ParticleEmitter.DEFAULT_COLOR_START=new THREE.Color;glam.ParticleEmitter.DEFAULT_COLOR_END=new THREE.Color;glam.ParticleEmitter.DEFAULT_PARTICLES_PER_SECOND=10;glam.ParticleEmitter.DEFAULT_OPACITY_START=0.1;glam.ParticleEmitter.DEFAULT_OPACITY_MIDDLE=0.5;glam.ParticleEmitter.DEFAULT_OPACITY_END=0;
glam.ParticleEmitter.DEFAULT_VELOCITY=new THREE.Vector3(0,10,0);glam.ParticleEmitter.DEFAULT_ACCELERATION=new THREE.Vector3(0,1,0);glam.ParticleEmitter.DEFAULT_POSITION_SPREAD=new THREE.Vector3(0,0,0);glam.ParticleEmitter.DEFAULT_ACCELERATION_SPREAD=new THREE.Vector3(0,1,0);glam.ParticleEmitter.DEFAULT_BLENDING=THREE.NoBlending;glam.ParticleSystem=function(a){a=a||{};var b=new glam.Object,c=a.texture||null,d=a.maxAge||glam.ParticleSystemScript.DEFAULT_MAX_AGE,e=null;if(a.geometry)c=new THREE.PointCloudMaterial({color:void 0!==a.color?a.color:glam.ParticleSystem.DEFAULT_COLOR,size:a.size,map:a.map,transparent:null!==a.map,depthWrite:!1,vertexColors:0<a.geometry.colors.length}),c=new THREE.PointCloud(a.geometry,c),c.sortParticles=!0,a.map&&(c.sortParticles=!0),e=new glam.Visual({object:c});else var f=new SPE.Group({texture:c,
maxAge:d}),e=new glam.Visual({object:f.mesh});b.addComponent(e);a.particleGroup=f;a=new glam.ParticleSystemScript(a);b.addComponent(a);return b};glam.ParticleSystemScript=function(a){glam.Script.call(this,a);this.particleGroup=a.particleGroup;this._active=!0;Object.defineProperties(this,{active:{get:function(){return this._active},set:function(a){this.setActive(a)}}})};goog.inherits(glam.ParticleSystemScript,glam.Script);glam.ParticleSystemScript.prototype.realize=function(){this.initEmitters()};
glam.ParticleSystemScript.prototype.initEmitters=function(){for(var a=this._object.getComponents(glam.ParticleEmitter),b=0,c=a.length,b=0;b<c;b++){var d=a[b];this.particleGroup.addEmitter(d.object);d.active=this._active}this.emitters=a};glam.ParticleSystemScript.prototype.setActive=function(a){var b=this.emitters;if(b){for(var c=0,d=b.length,c=0;c<d;c++)b[c].active=a;this._active=a}};glam.ParticleSystemScript.prototype.update=function(){this.particleGroup&&this.particleGroup.tick()};
glam.ParticleSystem.DEFAULT_COLOR=16777215;glam.ParticleSystemScript.DEFAULT_MAX_AGE=1;glam.ScaleBehavior=function(a){a=a||{};this.duration=void 0!==a.duration?a.duration:1;this.startScale=void 0!==a.startScale?a.startScale.clone():new THREE.Vector3(1,1,1);this.endScale=void 0!==a.endScale?a.endScale.clone():new THREE.Vector3(2,2,2);this.tween=null;glam.Behavior.call(this,a)};goog.inherits(glam.ScaleBehavior,glam.Behavior);
glam.ScaleBehavior.prototype.start=function(){this.running||(this.scale=this.startScale.clone(),this.originalScale=this._object.transform.scale.clone(),this.tween=(new TWEEN.Tween(this.scale)).to(this.endScale,1E3*this.duration).easing(TWEEN.Easing.Quadratic.InOut).repeat(0).start(),glam.Behavior.prototype.start.call(this))};
glam.ScaleBehavior.prototype.evaluate=function(a){a>=this.duration&&(this.stop(),this.loop?this.start():this.dispatchEvent("complete"));this._object.transform.scale.set(this.originalScale.x*this.scale.x,this.originalScale.y*this.scale.y,this.originalScale.z*this.scale.z)};glam.ScaleBehavior.prototype.stop=function(){this.tween&&this.tween.stop();glam.Behavior.prototype.stop.call(this)};glam.AnimationService=function(){};goog.inherits(glam.AnimationService,glam.Service);glam.AnimationService.prototype.initialize=function(a){};glam.AnimationService.prototype.terminate=function(){};glam.AnimationService.prototype.update=function(){window.TWEEN&&THREE.glTFAnimator.update()};glam.DOMMaterial={};
glam.DOMMaterial.create=function(a,b,c){var d=null;if(a)if(d=glam.DOMMaterial.parseStyle(a),a.shader)switch(a.shader.toLowerCase()){case "phong":case "blinn":d=new THREE.MeshPhongMaterial(d);break;case "lambert":d=new THREE.MeshLambertMaterial(d);break;case "line":d=new THREE.LineBasicMaterial(d);break;default:d=new THREE.MeshBasicMaterial(d)}else d=a["vertex-shader"]&&a["fragment-shader"]&&a["shader-uniforms"]?glam.DOMMaterial.createShaderMaterial(a,d,b):"line"==c?void 0!==d.dashSize||void 0!==d.gapSize?
new THREE.LineDashedMaterial(d):new THREE.LineBasicMaterial(d):new THREE.MeshBasicMaterial(d);else d=new THREE.MeshBasicMaterial;return d};
glam.DOMMaterial.parseStyle=function(a){var b=glam.DOMMaterial.parseTextures(a),c;a.reflectivity&&(c=parseFloat(a.reflectivity));var d;a.refractionRatio&&(d=parseFloat(a.refractionRatio));var e,f,g,k,h="";if(h=a.color)e=(new THREE.Color).setStyle(h).getHex();if(h=a["diffuse-color"])f=(new THREE.Color).setStyle(h).getHex();if(h=a["specular-color"])g=(new THREE.Color).setStyle(h).getHex();if(h=a["ambient-color"])k=(new THREE.Color).setStyle(h).getHex();var m;a.opacity&&(m=parseFloat(a.opacity));h=THREE.FrontSide;
if(a["backface-visibility"])switch(a["backface-visibility"].toLowerCase()){case "visible":h=THREE.DoubleSide;break;case "hidden":h=THREE.FrontSide}var l;a.hasOwnProperty("render-mode")&&(l="wireframe"==a["render-mode"]);var s;a["line-width"]&&(s=parseInt(a["line-width"]));var p;a["dash-size"]&&(p=parseInt(a["dash-size"]));var u;a["gap-size"]&&(u=parseInt(a["gap-size"]));a={};b.image&&(a.map=THREE.ImageUtils.loadTexture(b.image));b.envMap&&(a.envMap=b.envMap);b.normalMap&&(a.normalMap=THREE.ImageUtils.loadTexture(b.normalMap));
b.bumpMap&&(a.bumpMap=THREE.ImageUtils.loadTexture(b.bumpMap));b.specularMap&&(a.specularMap=THREE.ImageUtils.loadTexture(b.specularMap));void 0!==e&&(a.color=e);void 0!==f&&(a.color=f);void 0!==g&&(a.specular=g);void 0!==k&&(a.ambient=k);void 0!==m&&(a.opacity=m,a.transparent=1>m);void 0!==l&&(a.wireframe=l);void 0!==s&&(a.linewidth=s);void 0!==p&&(a.dashSize=p);void 0!==u&&(a.gapSize=u);void 0!==c&&(a.reflectivity=c);void 0!==d&&(a.refractionRatio=d);a.side=h;return a};
glam.DOMMaterial.parseTextures=function(a){var b={},c=a.image;if(c)if(c=c.trim(),"url"==c.substr(0,3))b.image=glam.DOMMaterial.parseUrl(a.image);else return glam.DOMMaterial.parseTexturesImage(c,b),b;a["normal-image"]&&(b.normalMap=glam.DOMMaterial.parseUrl(a["normal-image"]));a["bump-image"]&&(b.bumpMap=glam.DOMMaterial.parseUrl(a["bump-image"]));a["specular-image"]&&(b.specularMap=glam.DOMMaterial.parseUrl(a["specular-image"]));b.envMap=glam.DOMMaterial.tryParseEnvMap(a);return b};
glam.DOMMaterial.parseTexturesImage=function(a,b){var c=a.match(/\S+/g),d={},e,f=c.length;for(e=0;e<f;e+=2){var g=c[e],k=c[e+1];switch(g){case "diffuse":b.image=glam.DOMMaterial.parseUrl(k);break;case "normal":b.normalMap=glam.DOMMaterial.parseUrl(k);break;case "bump":b.bumpMap=glam.DOMMaterial.parseUrl(k);break;case "specular":b.specularMap=glam.DOMMaterial.parseUrl(k);break;case "sphere":d["sphere-image"]=k;break;default:-1!=g.indexOf("cube")&&(g=g.substr(4,g.length-4),d["cube-image"+g]=k)}}b.envMap=
glam.DOMMaterial.tryParseEnvMap(d)};glam.DOMMaterial.parseUrl=function(a){return a=/\(([^)]+)\)/.exec(a)[1]};
glam.DOMMaterial.tryParseEnvMap=function(a){var b=[];a["cube-image-right"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-right"]));a["cube-image-left"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-left"]));a["cube-image-top"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-top"]));a["cube-image-bottom"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-bottom"]));a["cube-image-front"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-front"]));a["cube-image-back"]&&b.push(glam.DOMMaterial.parseUrl(a["cube-image-back"]));
return 6==b.length?THREE.ImageUtils.loadTextureCube(b,THREE.Texture.DEFAULT_MAPPING,function(a){}):a["sphere-image"]?(a=glam.DOMMaterial.parseUrl(a["sphere-image"]),THREE.ImageUtils.loadTexture(a,THREE.SphericalRefractionMapping,function(a){})):null};
glam.DOMMaterial.createShaderMaterial=function(a,b,c){function d(){var a=new THREE.ShaderMaterial({vertexShader:m,fragmentShader:l,uniforms:g});glam.DOMMaterial.saveShaderMaterial(k,h,a);glam.DOMMaterial.callShaderMaterialCallbacks(k,h)}var e=a["vertex-shader"],f=a["fragment-shader"],g=glam.DOMMaterial.parseUniforms(a["shader-uniforms"],b),k=glam.DOMMaterial.parseUrl(e),h=glam.DOMMaterial.parseUrl(f);if(!k||!h){var m=document.getElementById(e).textContent,l=document.getElementById(f).textContent;
return m&&l?new THREE.ShaderMaterial({vertexShader:m,fragmentShader:l,uniforms:g}):null}if(a=glam.DOMMaterial.getShaderMaterial(k,h))return a;glam.DOMMaterial.addShaderMaterialCallback(k,h,c);glam.DOMMaterial.getShaderMaterialLoading(k,h)||(glam.DOMMaterial.setShaderMaterialLoading(k,h),l=m="",glam.System.ajax({type:"GET",url:k,dataType:"text",success:function(a){m=a;l&&d()}}),glam.System.ajax({type:"GET",url:h,dataType:"text",success:function(a){l=a;m&&d()}}))};
glam.DOMMaterial.parseUniforms=function(a,b){var c={},d=a.split(" "),e,f=d.length/3;for(e=0;e<f;e++){var g=d[3*e],k=d[3*e+1],h=d[3*e+2];"f"==k&&(h=parseFloat(h));if("c"==k){var m=new THREE.Color;m.setStyle(h);h=m}else"t"==k&&(h=h.toLowerCase(),"cube"==h?h=b.envMap:(h=glam.DOMMaterial.parseUrl(h),h=THREE.ImageUtils.loadTexture(h),h.wrapS=h.wrapT=THREE.Repeat));c[g]={type:k,value:h}}return c};glam.DOMMaterial.shaderMaterials={};
glam.DOMMaterial.saveShaderMaterial=function(a,b,c){a=glam.DOMMaterial.shaderMaterials[a+b];a.material=c;a.loading=!1};glam.DOMMaterial.addShaderMaterialCallback=function(a,b,c){a+=b;glam.DOMMaterial.shaderMaterials[a]||(glam.DOMMaterial.shaderMaterials[a]={material:null,loading:!1,callbacks:[]});glam.DOMMaterial.shaderMaterials[a].callbacks.push(c)};glam.DOMMaterial.callShaderMaterialCallbacks=function(a,b){var c=glam.DOMMaterial.shaderMaterials[a+b];if(c&&c.material)for(var d in c.callbacks)c.callbacks[d](c.material)};
glam.DOMMaterial.getShaderMaterial=function(a,b){var c=glam.DOMMaterial.shaderMaterials[a+b];return c?c.material:null};glam.DOMMaterial.setShaderMaterialLoading=function(a,b){var c=glam.DOMMaterial.shaderMaterials[a+b];c&&(c.loading=!0)};glam.DOMMaterial.getShaderMaterialLoading=function(a,b){var c=glam.DOMMaterial.shaderMaterials[a+b];return c&&c.loading};
glam.DOMMaterial.addHandlers=function(a,b,c){a.glam.setAttributeHandlers.push(function(b,e){glam.DOMMaterial.onSetAttribute(c,a,b,e)});b.setPropertyHandlers.push(function(b,e){glam.DOMMaterial.onSetProperty(c,a,b,e)})};glam.DOMMaterial.onSetAttribute=function(a,b,c,d){a=a.visuals[0].material;switch(c){case "color":case "diffuse-color":case "diffuseColor":a.color.setStyle(d)}};glam.DOMMaterial.onSetProperty=function(a,b,c,d){a=a.visuals[0].material;switch(c){case "color":case "diffuse-color":case "diffuseColor":a.color.setStyle(d)}};glam.MeshElement={};glam.MeshElement.VERTEX_NORMALS=!1;glam.MeshElement.VERTEX_COLORS=!1;glam.MeshElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.MeshElement)};
glam.MeshElement.getAttributes=function(a,b,c){var d=a.getAttribute("vertexNormals"),d=null!==d?!0:glam.MeshElement.VERTEX_NORMALS;a=a.getAttribute("vertexColors");a=null!==a?!0:glam.MeshElement.VERTEX_COLORS;b&&(b.vertexNormals&&(d=b.vertexNormals),b.vertexColors&&(a=b.vertexColors));c.vertexNormals=d;c.vertexColors=a};glam.MeshElement.createVisual=function(a,b,c){var d=new THREE.Geometry;glam.MeshElement.parse(a,d,b,c);a=new THREE.Mesh(d,b);return new glam.Visual({object:a})};
glam.MeshElement.parse=function(a,b,c,d){var e=a.getElementsByTagName("vertices");e&&(e=e[0])&&glam.DOMTypes.parseVector3Array(e,b.vertices);(e=a.getElementsByTagName("uvs"))&&(e=e[0])&&glam.DOMTypes.parseUVArray(e,b.faceVertexUvs[0]);(e=a.getElementsByTagName("faces"))&&(e=e[0])&&glam.DOMTypes.parseFaceArray(e,b.faces);var f=[];if(e=a.getElementsByTagName("normals"))if(e=e[0])if(glam.DOMTypes.parseVector3Array(e,f),d.vertexNormals)for(var g=b.faces.length,e=0;e<g;e++){var k=b.faces[e];if(k){var h=
f[k.a].normalize().clone();k.vertexNormals[0]=h;h=f[k.b].normalize().clone();k.vertexNormals[1]=h;h=f[k.c].normalize().clone();k.vertexNormals[2]=h}}else for(g=b.faces.length,e=0;e<g;e++)if(k=b.faces[e])h=f[e].normalize(),k.normal.copy(h);f=[];if(a=a.getElementsByTagName("colors"))if(a=a[0]){glam.DOMTypes.parseColor3Array(a,f);if(d.vertexColors){g=b.faces.length;for(e=0;e<g;e++)if(k=b.faces[e])(d=f[k.a])&&(k.vertexColors[0]=d.clone()),(d=f[k.b])&&(k.vertexColors[1]=d.clone()),(d=f[k.c])&&(k.vertexColors[2]=
d.clone());c.vertexColors=THREE.VertexColors}else{g=b.faces.length;for(e=0;e<g;e++)(k=b.faces[e])&&(d=f[e])&&k.color.copy(d);c.vertexColors=THREE.FaceColors}b.colorsNeedUpdate=!0;b.buffersNeedUpdate=!0}};glam.Gamepad=function(){glam.EventDispatcher.call(this);this.controllers={};this.values={};glam.Gamepad.instance=this};goog.inherits(glam.Gamepad,glam.EventDispatcher);glam.Gamepad.prototype.update=function(){this.scanGamepads();var a={changedButtons:[]},b={changedAxes:[]},c;for(c in this.controllers){var d=this.controllers[c];this.testValues(d,a,b);this.saveValues(d)}a.changedButtons.length&&this.dispatchEvent("buttonsChanged",a);b.changedAxes.length&&this.dispatchEvent("axesChanged",b)};
glam.Gamepad.prototype.testValues=function(a,b,c){var d=this.values[a.index];if(d){for(var e=0;e<a.buttons.length;e++){var f=a.buttons[e],g=1==f;"object"==typeof f&&(g=f.pressed);g!=d.buttons[e]&&b.changedButtons.push({gamepad:a.index,button:e,pressed:g})}for(e=0;e<a.axes.length;e++)f=a.axes[e],f!=d.axes[e]&&c.changedAxes.push({gamepad:a.index,axis:e,value:f})}};
glam.Gamepad.prototype.saveValues=function(a){var b=this.values[a.index];if(b){for(var c=0;c<a.buttons.length;c++){var d=a.buttons[c],e=1==d;"object"==typeof d&&(e=d.pressed);b.buttons[c]=e}for(c=0;c<a.axes.length;c++)d=a.axes[c],b.axes[c]=d}};glam.Gamepad.prototype.addGamepad=function(a){this.controllers[a.index]=a;this.values[a.index]={buttons:[],axes:[]};this.saveValues(a);console.log("Gamepad added! ",a.id)};
glam.Gamepad.prototype.scanGamepads=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],b=0;b<a.length;b++)a[b]&&(a[b].index in this.controllers?this.controllers[a[b].index]=a[b]:this.addGamepad(a[b]))};glam.Gamepad.instance=null;glam.Gamepad.BUTTON_A=glam.Gamepad.BUTTON_CROSS=0;glam.Gamepad.BUTTON_B=glam.Gamepad.BUTTON_CIRCLE=1;glam.Gamepad.BUTTON_X=glam.Gamepad.BUTTON_SQUARE=2;
glam.Gamepad.BUTTON_Y=glam.Gamepad.BUTTON_TRIANGLE=3;glam.Gamepad.SHOULDER_LEFT=4;glam.Gamepad.SHOULDER_RIGHT=5;glam.Gamepad.TRIGGER_LEFT=6;glam.Gamepad.TRIGGER_RIGHT=7;glam.Gamepad.SELECT=glam.Gamepad.BACK=8;glam.Gamepad.START=9;glam.Gamepad.STICK_LEFT=10;glam.Gamepad.STICK_RIGHT=11;glam.Gamepad.DPAD_UP=12;glam.Gamepad.DPAD_DOWN=13;glam.Gamepad.DPAD_LEFT=14;glam.Gamepad.DPAD_RIGHT=15;glam.Gamepad.HOME=glam.Gamepad.MENU=16;glam.Gamepad.AXIS_LEFT_H=0;glam.Gamepad.AXIS_LEFT_V=1;
glam.Gamepad.AXIS_RIGHT_H=2;glam.Gamepad.AXIS_RIGHT_V=3;glam.DOMDocument={scenes:{},styles:[],animations:{},addScene:function(a,b){glam.DOMDocument.scenes[a.id]={parentElement:a.parentElement,scene:b}},addStyle:function(a){glam.DOMDocument.styles.push(a)},addAnimation:function(a,b){glam.DOMDocument.animations[a]=b},parseDocument:function(){var a=new DOMParser,b,c,d=document.getElementsByTagName("script");c=d.length;for(b=0;b<c;b++)if("text/glam"==d[b].type){var e=a.parseFromString(d[b].textContent,"text/xml");glam.DOMDocument.addScene(d[b],e)}a=document.head.getElementsByTagName("style");
c=a.length;for(b=0;b<c;b++)glam.CSSParser.parsecss(a[b].childNodes[0].data,function(a){glam.DOMDocument.addStyle(a)})}};glam.CSSParser={};
(function(a){function b(a){a=g[a].replace(/^{|}parser/g,"");a=c(a);var b={};a.split(";").forEach(function(a){a=a.split(":");2>a.length||(b[d(a[0])]=d(a.slice(1).join(":")))});return b}function c(a,b){var c,d;a=a.replace(m,"parser1").replace(l,function(a,b){if(!b)return"";var c="%s`"+ ++p+"`s%";g[p]=b.replace(/^\\/,"");return c});for(var e=b?h:k;c=e.exec(a);)d="%b`"+ ++p+"`b%",g[p]=c[0],a=a.replace(e,d);return a}function d(a){var b;if(void 0===a)return a;for(;b=s.exec(a);)a=a.replace(s,g[b[1]]);return a.trim()}
function e(b,c){var e=b.split(/\s+/),f=e.shift();if("media"==f)f=d(e.pop()).slice(1,-1),a.parsecss.mediumApplies(e.join(" "))&&a.parsecss(f,c);else if("import"==f)f=d(e.shift()),a.parsecss.mediumApplies(e.join(" "))&&(f=f.replace(/^url\(|\)parser/gi,"").replace(/^["']|["']parser/g,""),a.get(f,function(b){a.parsecss(b,c)}));else if("-webkit-keyframes"==f||"-moz-keyframes"==f||"keyframes"==f){var g=e.shift(),f=d(e.join(" ")),f=f.substr(1,f.length-2);a.parsecss(f,function(a){var b={};b[g]=a;c(b)})}}
a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};a.findandfilter=function(a){a=this.filter(a).add(this.find(a));a.prevObject=a.prevObject.prevObject;return a};a.parsecss=function(f,g){var h={};f=c(f).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(a,b){e(b.trim(),g);return""});f.split("`b%").forEach(function(c){c=c.split("%b`");2>c.length||(c[0]=d(c[0]),h[c[0]]=a.extend(h[c[0]]||{},b(c[1])))});g(h)};a.parsecss.mediumApplies=window.media&&window.media.query||function(b){if(!b)return!0;
if(b in f)return f[b];var c=a('<style media="'+b+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return f[b]=[1==a("body").css("z-index"),c.remove()][0]};a.parsecss.isValidSelector=function(b){b=a("<style>"+b+"{}</style>").appendTo("head")[0];return[b.styleSheet?!/UNKNOWN/i.test(b.styleSheet.cssText):!!b.sheet.cssRules.length,a(b).remove()][0]};a.parsecss.parseArguments=function(a){if(!a)return[];var b=[];a=c(a,!0).split(/\s+/);for(var e=0;e<a.length;++e){var f=d(a[e]);try{b.push(eval("("+
f+")"))}catch(g){b.push(f)}}return b};a.parsecss.styleAttributes=function(b,e){var f="",g,h={};b=b.replace(u,"").replace(w,"parser1");c(b).replace(y,function(a,b,c){b=b.toLowerCase();h[b]?++h[b]:h[b]=1;if(g=/\bstyle\s*=\s*(%s`\d+`s%)/i.exec(c))a=(a=/\bid\s*=\s*(\S+)/i.exec(c))?"#"+d(a[1]).replace(/^['"]|['"]parser/g,""):b+":eq("+(h[b]-1)+")",f+=[a,"{",d(g[1]).replace(/^['"]|['"]parser/g,""),"}"].join("")});a.parsecss(f,e)};var f={},g={},k=/{[^{}]*}/,h=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,
m=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,l=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,s=/%\w`(\d+)`\w%/,p=0,u=/\x3c!--([^-]|-[^-])*--\x3e/g,w=/(>)[^<]*/g,y=/<(\w+)([^>]*)>/g})(glam.CSSParser);glam.AnimationElement={};glam.AnimationElement.DEFAULT_DURATION="1s";glam.AnimationElement.DEFAULT_ITERATION_COUNT="1";glam.AnimationElement.DEFAULT_TIMING_FUNCTION="linear";glam.AnimationElement.DEFAULT_FRAME_TIME="0%";glam.AnimationElement.DEFAULT_FRAME_PROPERTY="transform";
glam.AnimationElement.create=function(a){var b=a.id,c=a.getAttribute("duration")||glam.AnimationElement.DEFAULT_DURATION,d=a.getAttribute("iteration-count")||glam.AnimationElement.DEFAULT_ITERATION_COUNT,e=a.getAttribute("timing-function")||glam.AnimationElement.DEFAULT_TIMING_FUNCTION,c=glam.AnimationElement.parseTime(c),e=glam.AnimationElement.parseTimingFunction(e),d="infinite"==d.toLowerCase()?!0:!1,f=a.childNodes,g=f.length,k=[];for(a=0;a<g;a++){var h=f[a],m=h.tagName;m&&(m=m.toLowerCase());
"keyframe"==m&&(h=glam.AnimationElement.parseFrame(h),k.push(h))}c=glam.AnimationElement.build(c,d,e,k);glam.DOM.addAnimation(b,c);glam.AnimationElement.callParseCallbacks(b,c)};
glam.AnimationElement.parseFrame=function(a){var b=a.getAttribute("time")||glam.AnimationElement.DEFAULT_FRAME_TIME,b=glam.AnimationElement.parseFrameTime(b),c=a.getAttribute("property")||glam.AnimationElement.DEFAULT_FRAME_PROPERTY;a=a.getAttribute("value")||"";if("transform"==c)return c={},glam.DOMTransform.parseTransform(a,c),{time:b,value:c,type:"transform"};if("material"==c)return a=glam.AnimationElement.parseMaterial(a),a=glam.DOMMaterial.parseStyle(a),{time:b,value:a,type:"material"}};
glam.AnimationElement.createFromStyle=function(a,b,c){var d,e,f;if(a=b["animation-name"]||b["-webkit-animation-name"]||b["-moz-animation-name"])d=b["animation-duration"]||b["-webkit-animation-duration"]||b["-moz-animation-duration"],e=b["animation-timing-function"]||b["-webkit-animation-timing-function"]||b["-moz-animation-timing-function"],f=b["animation-iteration-count"]||b["-webkit-animation-iteration-count"]||b["-moz-animation-iteration-count"];else if(b=b.animation||b["-webkit-animation"]||b["-moz-animation"])f=
b.split("\\s+"),a=f[0],d=f[1],e=f[2],f=f[4];d=d||glam.AnimationElement.DEFAULT_DURATION;d=glam.AnimationElement.parseTime(d);e=e||glam.AnimationElement.DEFAULT_TIMING_FUNCTION;e=glam.AnimationElement.parseTimingFunction(e);f=f||glam.AnimationElement.DEFAULT_ITERATION_COUNT;f="infinite"==f.toLowerCase()?!0:!1;if(a){a=glam.DOM.getStyle(a);b=[];for(var g in a){var k;k="from"==g?0:"to"==g?1:glam.AnimationElement.parseFrameTime(g);var h,m=a[g],l;for(l in m){var s=m[l],p;if("transform"==l||"-webkit-transform"==
l||"-moz-transform"==l)p="transform",h={},glam.DOMTransform.parseTransform(s,h);else if("opacity"==l||"color"==l)p="material",h=glam.DOMMaterial.parseStyle(m);b.push({time:k,value:h,type:p})}}d=glam.AnimationElement.build(d,f,e,b);glam.AnimationElement.addAnimationToObject(d,c)}};
glam.AnimationElement.build=function(a,b,c,d){var e=[],f=[],g=[],k=[],h=[],m=[],l=[],s=[],p=[],u=[],w,y=d.length;for(w=0;w<y;w++){var t=d[w],n=t.value;if("transform"==t.type){if("x"in n||"y"in n||"z"in n){e.push(t.time);var q={};"x"in n&&(q.x=n.x);"y"in n&&(q.y=n.y);"z"in n&&(q.z=n.z);f.push(q)}if("rx"in n||"ry"in n||"rz"in n)g.push(t.time),q={},"rx"in n&&(q.x=n.rx),"ry"in n&&(q.y=n.ry),"rz"in n&&(q.z=n.rz),k.push(q);if("sx"in n||"sy"in n||"sz"in n)h.push(t.time),q={},"sx"in n&&(q.x=n.sx),"sy"in n&&
(q.y=n.sy),"sz"in n&&(q.z=n.sz),m.push(q)}else"material"==t.type&&("opacity"in n&&(l.push(t.time),s.push({opacity:parseFloat(n.opacity)})),"color"in n&&(p.push(t.time),t=new THREE.Color(n.color),u.push({r:t.r,g:t.g,b:t.b})))}return{duration:a,loop:b,easing:c,poskeys:e,posvalues:f,rotkeys:g,rotvalues:k,sclkeys:h,sclvalues:m,opakeys:l,opavalues:s,colorkeys:p,colorvalues:u}};
glam.AnimationElement.parseTime=function(a){var b=a.indexOf("ms");if(-1!=b)return parseFloat(a.split("ms")[0]);b=a.indexOf("s");if(-1!=b)return 1E3*parseFloat(a.split("s")[0])};glam.AnimationElement.parseFrameTime=function(a){return-1!=a.indexOf("%")?parseFloat(a.split("%")[0])/100:parseFloat(a)};glam.AnimationElement.parseTimingFunction=function(a){a=a.toLowerCase();switch(a){case "linear":return TWEEN.Easing.Linear.None;default:return TWEEN.Easing.Quadratic.InOut}};
glam.AnimationElement.parseMaterial=function(a){var b={};a=a.split(";");var c,d=a.length;for(c=0;c<d;c++){var e=a[c];e&&(e=e.split(":"),b[e[0]]=e[1])}return b};glam.AnimationElement.parse=function(a,b,c){var d=a.getAttribute("animation");d?(a=glam.DOM.getAnimation(d))?glam.AnimationElement.addAnimationToObject(a,c):glam.AnimationElement.addParseCallback(d,function(a){glam.AnimationElement.addAnimationToObject(a,c)}):glam.AnimationElement.createFromStyle(a,b,c)};
glam.AnimationElement.addAnimationToObject=function(a,b){var c=[];a.poskeys.length&&c.push({keys:a.poskeys,values:a.posvalues,target:b.transform.position});a.rotkeys.length&&c.push({keys:a.rotkeys,values:a.rotvalues,target:b.transform.rotation});a.sclkeys.length&&c.push({keys:a.sclkeys,values:a.sclvalues,target:b.transform.scale});a.opakeys.length&&c.push({keys:a.opakeys,values:a.opavalues,target:b.visuals[0].material});a.colorkeys.length&&c.push({keys:a.colorkeys,values:a.colorvalues,target:b.visuals[0].material.color});
c.length&&(c=new glam.KeyFrameAnimator({interps:c,duration:a.duration,loop:a.loop,easing:a.easing}),b.addComponent(c),c.start())};glam.AnimationElement.parseCallbacks={};glam.AnimationElement.addParseCallback=function(a,b){var c=glam.AnimationElement.parseCallbacks[a];c||(c={callbacks:[]},glam.AnimationElement.parseCallbacks[a]=c);c.callbacks.push(b)};
glam.AnimationElement.callParseCallbacks=function(a,b){var c=glam.AnimationElement.parseCallbacks[a];if(c){var c=c.callbacks,d,e=c.length;for(d=0;d<e;d++)(0,c[d])(b)}};glam.TransitionElement={};glam.TransitionElement.DEFAULT_DURATION=glam.AnimationElement.DEFAULT_DURATION;glam.TransitionElement.DEFAULT_TIMING_FUNCTION=glam.AnimationElement.DEFAULT_TIMING_FUNCTION;
glam.TransitionElement.parse=function(a,b,c){a=(b.transition||"").split(",");c=a.length;for(b=0;b<c;b++){var d=a[b];if(d){d=d.split(" ");""==d[0]&&d.shift();var e=d[2]||glam.TransitionElement.DEFAULT_TIMING_FUNCTION,f=d[3]||"";glam.AnimationElement.parseTime(d[1]);glam.AnimationElement.parseTimingFunction(e);glam.AnimationElement.parseTime(f)}}};glam.GroupElement={};glam.GroupElement.create=function(a,b){return new glam.Object};glam.HighlightBehavior=function(a){a=a||{};this.highlightColor=void 0!==a.highlightColor?a.highlightColor:16777215;this.savedColors=[];glam.Behavior.call(this,a)};goog.inherits(glam.HighlightBehavior,glam.Behavior);glam.HighlightBehavior.prototype.start=function(){glam.Behavior.prototype.start.call(this);if(this._realized&&this._object.visuals){var a=this._object.visuals,b,c=a.length;for(b=0;b<c;b++)this.savedColors.push(a[b].material.color.getHex()),a[b].material.color.setHex(this.highlightColor)}};
glam.HighlightBehavior.prototype.evaluate=function(a){};glam.HighlightBehavior.prototype.stop=function(){glam.Behavior.prototype.stop.call(this);if(this._realized&&this._object.visuals){var a=this._object.visuals,b,c=a.length;for(b=0;b<c;b++)a[b].material.color.setHex(this.savedColors[b])}};glam.HighlightBehavior.prototype.on=glam.HighlightBehavior.prototype.start;glam.HighlightBehavior.prototype.off=glam.HighlightBehavior.prototype.stop;glam.MoveBehavior=function(a){a=a||{};this.duration=void 0!==a.duration?a.duration:1;this.moveVector=void 0!==a.moveVector?a.moveVector:new THREE.Vector3(0,1,0);this.tween=null;glam.Behavior.call(this,a)};goog.inherits(glam.MoveBehavior,glam.Behavior);
glam.MoveBehavior.prototype.start=function(){this.running||(this.movePosition=new THREE.Vector3,this.moveEndPosition=this.moveVector.clone(),this.prevMovePosition=new THREE.Vector3,this.moveDelta=new THREE.Vector3,this.tween=(new TWEEN.Tween(this.movePosition)).to(this.moveEndPosition,1E3*this.duration).easing(TWEEN.Easing.Quadratic.InOut).repeat(0).start(),glam.Behavior.prototype.start.call(this))};
glam.MoveBehavior.prototype.evaluate=function(a){a>=this.duration&&(this.stop(),this.loop?this.start():this.dispatchEvent("complete"));this.moveDelta.copy(this.movePosition).sub(this.prevMovePosition);this.prevMovePosition.copy(this.movePosition);this._object.transform.position.add(this.moveDelta)};glam.MoveBehavior.prototype.stop=function(){this.tween&&this.tween.stop();glam.Behavior.prototype.stop.call(this)};glam.CircleElement={};glam.CircleElement.DEFAULT_RADIUS=2;glam.CircleElement.DEFAULT_RADIUS_SEGMENTS=32;glam.CircleElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.CircleElement)};
glam.CircleElement.getAttributes=function(a,b,c){var d=a.getAttribute("radius")||glam.CircleElement.DEFAULT_RADIUS;a=a.getAttribute("radiusSegments")||glam.CircleElement.DEFAULT_RADIUS_SEGMENTS;b&&(b.radius&&(d=b.radius),b.radiusSegments&&(a=b.radiusSegments));d=parseFloat(d);a=parseInt(a);c.radius=d;c.radiusSegments=a};glam.CircleElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.CircleGeometry(c.radius,c.radiusSegments),material:b})};glam.RectElement={};glam.RectElement.DEFAULT_WIDTH=2;glam.RectElement.DEFAULT_HEIGHT=2;glam.RectElement.DEFAULT_WIDTH_SEGMENTS=1;glam.RectElement.DEFAULT_HEIGHT_SEGMENTS=1;glam.RectElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.RectElement)};
glam.RectElement.getAttributes=function(a,b,c){var d=a.getAttribute("width")||glam.RectElement.DEFAULT_WIDTH,e=a.getAttribute("height")||glam.RectElement.DEFAULT_HEIGHT,f=a.getAttribute("width")||glam.RectElement.DEFAULT_WIDTH_SEGMENTS;a=a.getAttribute("height")||glam.RectElement.DEFAULT_HEIGHT_SEGMENTS;b&&(b.width&&(d=b.width),b.height&&(e=b.height),b.widthSegments&&(f=b.widthSegments),b.heightSegments&&(a=b.heightSegments));d=parseFloat(d);e=parseFloat(e);f=parseInt(f);a=parseInt(a);c.width=d;c.height=
e;c.widthSegments=f;c.heightSegments=a};glam.RectElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.PlaneGeometry(c.width,c.height,c.widthSegments,c.heightSegments),material:b})};glam.LightElement={};glam.LightElement.DEFAULT_TYPE="directional";glam.LightElement.DEFAULT_COLOR="#ffffff";glam.LightElement.DEFAULT_ANGLE="90deg";glam.LightElement.DEFAULT_DISTANCE=0;glam.LightElement.DEFAULT_EXPONENT=glam.SpotLight.DEFAULT_EXPONENT;
glam.LightElement.create=function(a,b,c){c=a.getAttribute("type")||glam.LightElement.DEFAULT_TYPE;var d=a.getAttribute("color")||glam.LightElement.DEFAULT_COLOR,e=a.getAttribute("angle")||glam.LightElement.DEFAULT_ANGLE,f=a.getAttribute("distance")||glam.LightElement.DEFAULT_DISTANCE,g=a.getAttribute("exponent")||glam.LightElement.DEFAULT_EXPONENT,k=new THREE.Vector3(0,0,-1),h=parseFloat(a.getAttribute("dx"))||0,m=parseFloat(a.getAttribute("dy"))||0;a=parseFloat(a.getAttribute("dz"))||0;(h||m||a)&&
k.set(h,m,a);k.normalize();b&&(b.type&&(c=b.type),b.color&&(d=b.color),b.angle&&(e=b.angle),b.distance&&(f=b.distance));d=(new THREE.Color).setStyle(d).getHex();e=glam.DOMTransform.parseRotation(e);f=parseFloat(f);g=parseFloat(g);b={color:d,angle:e,direction:k,distance:f,exponent:g};a=new glam.Object;d=null;switch(c.toLowerCase()){case "directional":d=new glam.DirectionalLight(b);break;case "point":d=new glam.PointLight(b);break;case "spot":d=new glam.SpotLight(b);break;case "ambient":d=new glam.AmbientLight(b)}return d?
(a.addComponent(d),a):null};glam.DirectionalLight=function(a){a=a||{};this.scaledDir=new THREE.Vector3;this.castShadows=void 0!==a.castShadows?a.castShadows:glam.DirectionalLight.DEFAULT_CAST_SHADOWS;glam.Light.call(this,a);a.object?(this.object=a.object,this.direction=a.object.position.clone().normalize().negate(),this.targetPos=a.object.target.position.clone(),this.shadowDarkness=a.object.shadowDarkness):(this.direction=a.direction||new THREE.Vector3(0,0,-1),this.object=new THREE.DirectionalLight(a.color,a.intensity,0),this.targetPos=
new THREE.Vector3,this.shadowDarkness=void 0!==a.shadowDarkness?a.shadowDarkness:glam.DirectionalLight.DEFAULT_SHADOW_DARKNESS)};goog.inherits(glam.DirectionalLight,glam.Light);glam.DirectionalLight.prototype.realize=function(){glam.Light.prototype.realize.call(this)};
glam.DirectionalLight.prototype.update=function(){this.position.copy(this.direction).normalize().negate();this.position.applyMatrix4(this.object.parent.matrixWorld);this.scaledDir.copy(this.direction);this.scaledDir.multiplyScalar(glam.Light.DEFAULT_RANGE);this.targetPos.copy(this.position);this.targetPos.add(this.scaledDir);this.object.target.position.copy(this.targetPos);this.updateShadows();glam.Light.prototype.update.call(this)};
glam.DirectionalLight.prototype.updateShadows=function(){this.castShadows&&(this.object.castShadow=!0,this.object.shadowCameraNear=1,this.object.shadowCameraFar=glam.Light.DEFAULT_RANGE,this.object.shadowCameraFov=90,this.object.shadowBias=1E-4,this.object.shadowDarkness=this.shadowDarkness,this.object.shadowMapWidth=1024,this.object.shadowMapHeight=1024,glam.Graphics.instance.enableShadows(!0))};glam.DirectionalLight.DEFAULT_CAST_SHADOWS=!1;glam.DirectionalLight.DEFAULT_SHADOW_DARKNESS=0.3;glam.DeviceOrientationControlsCB=function(a){this.object=a;this.object.rotation.reorder("YXZ");this.freeze=!0;this.movementSpeed=1;this.rollSpeed=0.005;this.autoAlign=!0;this.autoForward=!1;this.orient=this.gamma=this.beta=this.alpha=0;this.alignQuaternion=new THREE.Quaternion;this.orientationQuaternion=new THREE.Quaternion;var b=new THREE.Quaternion,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Matrix4,f=new THREE.Euler(0,0,0,"YXZ"),g=new THREE.Quaternion,k=new THREE.Vector3(0,0,1),h=new THREE.Vector3(0,
1,0),m=new THREE.Vector3(0,0,0),l=new THREE.Euler,s=new THREE.Quaternion,p=new THREE.Quaternion(-Math.sqrt(0.5),0,0,Math.sqrt(0.5));this.deviceOrientation={};this.screenOrientation=window.orientation||0;this.onDeviceOrientationChangeEvent=function(a){this.deviceOrientation=a}.bind(this);var u=function(){switch(window.screen.orientation||window.screen.mozOrientation){case "landscape-primary":return 90;case "landscape-secondary":return-90;case "portrait-secondary":return 180;case "portrait-primary":return 0}return window.orientation||
0};this.onScreenOrientationChangeEvent=function(){this.screenOrientation=u()}.bind(this);this.update=function(a){return function(){if(!this.freeze){var a=u();a!==this.screenOrientation&&(this.screenOrientation=a,this.autoAlign=!0);this.alpha=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.alpha):0;this.beta=this.deviceOrientation.beta?THREE.Math.degToRad(this.deviceOrientation.beta):0;this.gamma=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.gamma):
0;this.orient=this.screenOrientation?THREE.Math.degToRad(this.screenOrientation):0;l.set(this.beta,this.alpha,-this.gamma,"YXZ");b.setFromEuler(l);c.slerp(b,0.5);this.autoAlign?this.orientationQuaternion.copy(b):this.orientationQuaternion.copy(c);this.orientationQuaternion.multiply(p);this.orientationQuaternion.multiply(s.setFromAxisAngle(k,-this.orient));this.object.quaternion.copy(this.alignQuaternion);this.object.quaternion.multiply(this.orientationQuaternion);this.autoForward&&(d.set(0,0,-1).applyQuaternion(this.object.quaternion,
"ZXY").setLength(this.movementSpeed/50),this.object.position.add(d));this.autoAlign&&0!==this.alpha&&(this.autoAlign=!1,this.align())}}}();this.align=function(){d.set(0,0,1).applyQuaternion(g.copy(this.orientationQuaternion).inverse(),"ZXY");f.setFromQuaternion(g.setFromRotationMatrix(e.lookAt(d,m,h)));f.set(0,f.y,0);this.alignQuaternion.setFromEuler(f)};this.connect=function(){this.onScreenOrientationChangeEvent();window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1);
this.freeze=!1;return this};this.disconnect=function(){this.freeze=!0;window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1)}};glam.ConeElement={};glam.ConeElement.DEFAULT_RADIUS=2;glam.ConeElement.DEFAULT_HEIGHT=2;glam.ConeElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.ConeElement)};glam.ConeElement.getAttributes=function(a,b,c){var d=a.getAttribute("radius")||glam.ConeElement.DEFAULT_RADIUS;a=a.getAttribute("height")||glam.ConeElement.DEFAULT_HEIGHT;b&&(b.radius&&(d=b.radius),b.height&&(a=b.height));d=parseFloat(d);a=parseFloat(a);c.radius=d;c.height=a};
glam.ConeElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.CylinderGeometry(0,c.radius,c.height,32),material:b})};glam.Prefabs.PointerLockController=function(a){a=a||{};var b=new glam.Object(a),c=new glam.PointerLockControllerScript(a);b.addComponent(c);a=new glam.DirectionalLight({intensity:a.headlight?1:0});b.addComponent(a);return b};
glam.PointerLockControllerScript=function(a){glam.Script.call(this,a);this._enabled=void 0!==a.enabled?a.enabled:!0;this._move=void 0!==a.move?a.move:!0;this._look=void 0!==a.look?a.look:!0;this._turn=void 0!==a.turn?a.turn:!0;this._tilt=void 0!==a.tilt?a.tilt:!0;this._mouseLook=void 0!==a.mouseLook?a.mouseLook:!1;this.collisionDistance=10;this.moveSpeed=13;this.tiltSpeed=this.turnSpeed=5;this.lookSpeed=1;this.savedCameraPos=new THREE.Vector3;this.movementVector=new THREE.Vector3;Object.defineProperties(this,
{camera:{get:function(){return this._camera},set:function(a){this.setCamera(a)}},enabled:{get:function(){return this._enabled},set:function(a){this.setEnabled(a)}},move:{get:function(){return this._move},set:function(a){this.setMove(a)}},look:{get:function(){return this._look},set:function(a){this.setLook(a)}},mouseLook:{get:function(){return this._mouseLook},set:function(a){this.setMouseLook(a)}},headlightOn:{get:function(){return this._headlightOn},set:function(a){this.setHeadlightOn(a)}}})};
goog.inherits(glam.PointerLockControllerScript,glam.Script);glam.PointerLockControllerScript.prototype.realize=function(){this.headlight=this._object.getComponent(glam.DirectionalLight);this.headlight.intensity=this._headlightOn?1:0};
glam.PointerLockControllerScript.prototype.createControls=function(a){a=new glam.PointerLockControls(a.object,glam.Graphics.instance.container);a.mouseLook=this._mouseLook;a.movementSpeed=this._move?this.moveSpeed:0;a.lookSpeed=this._look?this.lookSpeed:0;a.turnSpeed=this._turn?this.turnSpeed:0;a.tiltSpeed=this._tilt?this.tiltSpeed:0;this.clock=new THREE.Clock;return a};
glam.PointerLockControllerScript.prototype.update=function(){this.saveCamera();this.controls.update(this.clock.getDelta());var a=this.testCollision();a&&a.object&&(this.restoreCamera(),this.dispatchEvent("collide",a));this.testTerrain()&&this.restoreCamera();this._headlightOn&&this.headlight.direction.copy(this._camera.position).negate()};glam.PointerLockControllerScript.prototype.setEnabled=function(a){this._enabled=a;this.controls.enabled=a};
glam.PointerLockControllerScript.prototype.setMove=function(a){this._move=a;this.controls.movementSpeed=a?this.moveSpeed:0};glam.PointerLockControllerScript.prototype.setLook=function(a){this._look=a;this.controls.lookSpeed=a?1:0};glam.PointerLockControllerScript.prototype.setMouseLook=function(a){this._mouseLook=a;this.controls.mouseLook=a};
glam.PointerLockControllerScript.prototype.setCamera=function(a){this._camera=a;this.controls=this.createControls(a);this.controls.movementSpeed=this.moveSpeed;this.controls.lookSpeed=this._look?0.1:0};glam.PointerLockControllerScript.prototype.saveCamera=function(){this.savedCameraPos.copy(this._camera.position)};glam.PointerLockControllerScript.prototype.restoreCamera=function(){this._camera.position.copy(this.savedCameraPos)};
glam.PointerLockControllerScript.prototype.testCollision=function(){this.movementVector.copy(this._camera.position).sub(this.savedCameraPos);if(this.movementVector.length()){var a=glam.Graphics.instance.objectFromRay(null,this.savedCameraPos,this.movementVector,1,2);a&&a.object&&this.savedCameraPos.distanceTo(a.hitPointWorld);return a}return null};glam.PointerLockControllerScript.prototype.testTerrain=function(){return!1};
glam.PointerLockControllerScript.prototype.setHeadlightOn=function(a){this._headlightOn=a;this.headlight&&(this.headlight.intensity=a?1:0)};glam.DOMElement={};glam.DOMElement.init=function(a){a.glam={};a.glam.setAttributeHandlers=[];a.glam.onSetAttribute=function(b,c){var d,e=a.glam.setAttributeHandlers.length;for(d=0;d<e;d++){var f=a.glam.setAttributeHandlers[d];f&&f(b,c)}}};
glam.DOMElement.getStyle=function(a){var b=new glam.DOMClassList(a);a.glam.classList=b;var c=new glam.DOMStyle(a);if(a.id){var d=glam.DOM.getStyle("#"+a.id);c.addProperties(d)}(d=a.getAttribute("class"))||(d=a["class"]);if(d){var e=d.split(" "),f;for(f in e){var g=e[f];g&&(d=glam.DOM.getStyle("."+g),c.addProperties(d),b.add(g))}}(d=a.getAttribute("style"))&&c.addPropertiesFromString(d);return a.glam.style=c};glam.DOMParser={addDocument:function(a){(new (void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:window.MutationObserver)(function(b){b.forEach(function(b){if("childList"==b.type){var d,e=b.addedNodes.length;for(d=0;d<e;d++){var f=b.addedNodes[d],g=glam.DOM.viewers[a.id];g.addNode(f)}e=b.removedNodes.length;for(d=0;d<e;d++)f=b.removedNodes[d],g=glam.DOM.viewers[a.id],g.removeNode(f)}else"attributes"==b.type&&(d=b.target.glam?b.target.glam.onSetAttribute:null)&&(e=b.attributeName,
b=b.target.getAttribute(e),d(e,b))})})).observe(a,{attributes:!0,childList:!0,characterData:!0,subtree:!0})},addStyle:function(a){for(var b in a)glam.DOM.addStyle(b,a[b])},getStyle:function(a){return glam.DOM.getStyle(a)},parseDocument:function(){new DOMParser;var a,b,c=document.getElementsByTagName("glam");b=c.length;for(a=0;a<b;a++){var d=c[a];d.id||(d.id="#glamDocument"+glam.DOM.documentIndex++);glam.DOMParser.addDocument(d);glam.DOM.documents[d.id]=d;d.style.display="none";glam.DOMParser.addEventHandlers(d)}c=
document.head.getElementsByTagName("style");b=c.length;for(a=0;a<b;a++)c[a].childNodes.length&&glam.CSSParser.parsecss(c[a].childNodes[0].data,function(a){glam.DOMParser.addStyle(a)})},addEventHandlers:function(a){a.addEventListener("mouseover",function(a){a.preventDefault();a.stopPropagation()});a.addEventListener("mouseout",function(a){a.preventDefault();a.stopPropagation()});a.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation()});a.addEventListener("mouseup",function(a){a.preventDefault();
a.stopPropagation()});a.addEventListener("mousemove",function(a){a.preventDefault();a.stopPropagation()});a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation()})}};glam.SphereElement={};glam.SphereElement.DEFAULT_RADIUS=2;glam.SphereElement.DEFAULT_WIDTH_SEGMENTS=32;glam.SphereElement.DEFAULT_HEIGHT_SEGMENTS=32;glam.SphereElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.SphereElement)};
glam.SphereElement.getAttributes=function(a,b,c){var d=a.getAttribute("radius")||glam.SphereElement.DEFAULT_RADIUS,e=a.getAttribute("width-segments")||glam.SphereElement.DEFAULT_WIDTH_SEGMENTS;a=a.getAttribute("height-segments")||glam.SphereElement.DEFAULT_HEIGHT_SEGMENTS;if(b){b.radius&&(d=b.radius);if(b.widthSegments||b["width-segments"])e=b.widthSegments||b["width-segments"];if(b.heightSegments||b["height-segments"])a=b.heightSegments||b["height-segments"]}d=parseFloat(d);e=parseInt(e);a=parseInt(a);
c.radius=d;c.widthSegments=e;c.heightSegments=a};glam.SphereElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.SphereGeometry(c.radius,c.widthSegments,c.heightSegments),material:b})};glam.Prefabs.RiftController=function(a){a=a||{};var b=new glam.Object(a),c=new glam.RiftControllerScript(a);b.addComponent(c);a=new glam.DirectionalLight({intensity:a.headlight?1:0});b.addComponent(a);return b};
glam.RiftControllerScript=function(a){glam.Script.call(this,a);this._enabled=void 0!==a.enabled?a.enabled:!0;this.riftControls=null;this._headlightOn=a.headlight;this.cameraDir=new THREE.Vector3;Object.defineProperties(this,{camera:{get:function(){return this._camera},set:function(a){this.setCamera(a)}},enabled:{get:function(){return this._enabled},set:function(a){this.setEnabled(a)}}})};goog.inherits(glam.RiftControllerScript,glam.Script);
glam.RiftControllerScript.prototype.realize=function(){this.headlight=this._object.getComponent(glam.DirectionalLight);this.headlight.intensity=this._headlightOn?1:0};glam.RiftControllerScript.prototype.update=function(){this._enabled&&this.riftControls&&this.riftControls.update();this._headlightOn&&(this.cameraDir.set(0,0,-1),this.cameraDir.transformDirection(this.camera.object.matrixWorld),this.headlight.direction.copy(this.cameraDir))};
glam.RiftControllerScript.prototype.setEnabled=function(a){this._enabled=a};glam.RiftControllerScript.prototype.setCamera=function(a){this._camera=a;this.riftControls=this.createControls(a)};glam.RiftControllerScript.prototype.createControls=function(a){return new THREE.VRControls(a.object,function(a){a&&console.log("Error creating VR controller: ",a)})};glam.ImportElement={};glam.ImportElement.create=function(a,b){var c=a.getAttribute("src"),d=new glam.Object;if(c){var e=new glam.Loader,f=function(a){glam.ImportElement.onLoadComplete(d,a,c);e.removeEventListener("loaded",f)};e.addEventListener("loaded",f);e.loadScene(c)}return d};glam.ImportElement.onLoadComplete=function(a,b,c){a.addChild(b.scene)};glam.EffectElement={};glam.EffectElement.DEFAULT_BLOOM_STRENGTH=1;glam.EffectElement.DEFAULT_FILM_GRAYSCALE=0;glam.EffectElement.DEFAULT_FILM_SCANLINECOUNT=512;glam.EffectElement.DEFAULT_FILM_INTENSITY=0.5;glam.EffectElement.DEFAULT_RGBSHIFT_AMOUNT=0.0015;glam.EffectElement.DEFAULT_DOTSCREEN_SCALE=1;
glam.EffectElement.create=function(a,b,c){c=null;switch(a.getAttribute("type")){case "Bloom":c=glam.EffectElement.DEFAULT_BLOOM_STRENGTH;var d=a.getAttribute("strength");void 0!=d&&(c=parseFloat(d));c=new glam.Effect(new THREE.BloomPass(c));break;case "FXAA":c=new glam.Effect(THREE.FXAAShader);c.pass.uniforms.resolution.value.set(1/glam.Graphics.instance.renderer.domElement.offsetWidth,1/glam.Graphics.instance.renderer.domElement.offsetHeight);break;case "Film":c=new glam.Effect(THREE.FilmShader);
c.pass.uniforms.grayscale.value=glam.EffectElement.DEFAULT_FILM_GRAYSCALE;c.pass.uniforms.sCount.value=glam.EffectElement.DEFAULT_FILM_SCANLINECOUNT;c.pass.uniforms.nIntensity.value=glam.EffectElement.DEFAULT_FILM_INTENSITY;break;case "RGBShift":c=new glam.Effect(THREE.RGBShiftShader);c.pass.uniforms.amount.value=glam.EffectElement.DEFAULT_RGBSHIFT_AMOUNT;break;case "DotScreen":c=new glam.Effect(THREE.DotScreenShader);c.pass.uniforms.scale.value=glam.EffectElement.DEFAULT_DOTSCREEN_SCALE;break;case "DotScreenRGB":c=
new glam.Effect(THREE.DotScreenRGBShader),c.pass.uniforms.scale.value=glam.EffectElement.DEFAULT_DOTSCREEN_SCALE}c&&(glam.EffectElement.parseAttributes(a,c,b),glam.Graphics.instance.addEffect(c));return null};
glam.EffectElement.parseAttributes=function(a,b,c){void 0!=a.getAttribute("disabled")&&(b.pass.enabled=!1);b=b.pass.uniforms;for(var d in b){var e=a.getAttribute(d);if(e){var f=null;if(c=b[d]){switch(c.type){case "t":e=glam.DOMMaterial.parseUrl(e);f=THREE.ImageUtils.loadTexture(e);f.wrapS=f.wrapT=THREE.Repeat;break;case "f":f=parseFloat(e);break;case "i":f=parseInt(e)}f&&(c.value=f)}}}};glam.TextElement={};glam.TextElement.DEFAULT_FONT_SIZE=1;glam.TextElement.DEFAULT_FONT_DEPTH=0.2;glam.TextElement.DEFAULT_FONT_BEVEL="none";glam.TextElement.DEFAULT_BEVEL_SIZE=0.01;glam.TextElement.DEFAULT_BEVEL_THICKNESS=0.02;glam.TextElement.DEFAULT_FONT_FAMILY="helvetica";glam.TextElement.DEFAULT_FONT_WEIGHT="normal";glam.TextElement.DEFAULT_FONT_STYLE="normal";glam.TextElement.BEVEL_EPSILON=1E-4;glam.TextElement.DEFAULT_VALUE="";
glam.TextElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.TextElement)};
glam.TextElement.getAttributes=function(a,b,c){var d=a.getAttribute("fontFamily")||glam.TextElement.DEFAULT_FONT_FAMILY,e=a.getAttribute("fontWeight")||glam.TextElement.DEFAULT_FONT_WEIGHT,f=a.getAttribute("fontStyle")||glam.TextElement.DEFAULT_FONT_STYLE,g=a.getAttribute("fontSize")||glam.TextElement.DEFAULT_FONT_SIZE,k=a.getAttribute("fontDepth")||glam.TextElement.DEFAULT_FONT_DEPTH,h=a.getAttribute("fontBevel")||glam.TextElement.DEFAULT_FONT_BEVEL,m=a.getAttribute("bevelSize")||glam.TextElement.DEFAULT_BEVEL_SIZE,
l=a.getAttribute("bevelThickness")||glam.TextElement.DEFAULT_BEVEL_THICKNESS;b&&(b["font-family"]&&(d=b["font-family"]),b["font-weight"]&&(e=b["font-weight"]),b["font-style"]&&(f=b["font-style"]),b["font-size"]&&(g=b["font-size"]),b["font-depth"]&&(k=b["font-depth"]),b["font-bevel"]&&(h=b["font-bevel"]),b["bevel-size"]&&(m=b["bevel-size"]),b["bevel-thickness"]&&(l=b["bevel-thickness"]));d=d.toLowerCase();switch(d){case "optima":d="optimer";break;default:d="helvetiker"}THREE.FontUtils.faces[d]||(d=
"helvetiker");e=e.toLowerCase();"bold"!=e&&(e="normal");f.toLowerCase();f="normal";g=parseFloat(g);k=parseFloat(k);m=parseFloat(m);l=parseFloat(l);b="bevel"==h.toLowerCase()?!0:!1;k||(b=!1);b||(l=m=glam.TextElement.BEVEL_EPSILON,b=!0);h=a.getAttribute("value")||glam.TextElement.DEFAULT_VALUE;h||(h=a.textContent);c.value=h;c.fontSize=g;c.fontDepth=k;c.bevelSize=m;c.bevelThickness=l;c.bevelEnabled=b;c.fontFamily=d;c.fontWeight=e;c.fontStyle=f};
glam.TextElement.createVisual=function(a,b,c){if(!c.value)return null;a=new THREE.TextGeometry(c.value,{font:c.fontFamily,weight:c.fontWeight,style:c.fontStyle,size:c.fontSize,height:c.fontDepth,curveSegments:4,bevelThickness:c.bevelThickness,bevelSize:c.bevelSize,bevelEnabled:c.bevelEnabled,material:0,extrudeMaterial:1});a.computeBoundingBox();a.computeVertexNormals();c=b.clone();c.shading=THREE.FlatShading;b=b.clone();b.shading=THREE.SmoothShading;b=new THREE.MeshFaceMaterial([c,b]);b=new glam.Visual({geometry:a,
material:b});a.center();return b};glam.CylinderElement={};glam.CylinderElement.DEFAULT_RADIUS=2;glam.CylinderElement.DEFAULT_HEIGHT=2;glam.CylinderElement.create=function(a,b){return glam.VisualElement.create(a,b,glam.CylinderElement)};glam.CylinderElement.getAttributes=function(a,b,c){var d=a.getAttribute("radius")||glam.CylinderElement.DEFAULT_RADIUS;a=a.getAttribute("height")||glam.CylinderElement.DEFAULT_HEIGHT;b&&(b.radius&&(d=b.radius),b.height&&(a=b.height));d=parseFloat(d);a=parseFloat(a);c.radius=d;c.height=a};
glam.CylinderElement.createVisual=function(a,b,c){return new glam.Visual({geometry:new THREE.CylinderGeometry(c.radius,c.radius,c.height,32),material:b})};glam.ParticlesElement={};glam.ParticlesElement.create=function(a,b){var c=glam.DOMMaterial.parseStyle(b),d={};glam.ParticlesElement.getAttributes(a,b,d);d.map=c.map;d.texture=c.map;d.color=c.color;c=glam.ParticlesElement.parse(a);d.geometry=c.geometry;d=glam.ParticleSystem(d);glam.ParticlesElement.addEmitters(c.emitters,d);c=d.getComponent(glam.Visual);a.geometry=c.geometry;a.material=c.material;d.getComponent(glam.ParticleSystemScript).active=!0;return d};
glam.ParticlesElement.getAttributes=function(a,b,c){b=a.getAttribute("maxAge")||glam.ParticlesElement.DEFAULT_MAX_AGE;a=parseFloat(a.getAttribute("size"));c.maxAge=parseFloat(b);c.size=a};
glam.ParticlesElement.parse=function(a){var b={geometry:null,emitters:[]},c=a.getElementsByTagName("emitter");if(c){var d,e=c.length;for(d=0;d<e;d++){var f={},g=c[d];g&&(glam.ParticlesElement.parseEmitter(g,f),f=new glam.ParticleEmitter(f),b.emitters.push(f))}}if(a=a.getElementsByTagName("vertices"))if(a=a[0])c=new THREE.Geometry,glam.DOMTypes.parseVector3Array(a,c.vertices),b.geometry=c;return b};
glam.ParticlesElement.parseEmitter=function(a,b){var c=parseFloat(a.getAttribute("size")),d=parseFloat(a.getAttribute("sizeEnd")),e=parseInt(a.getAttribute("particlesPerSecond")),f=parseFloat(a.getAttribute("opacityStart")),g=parseFloat(a.getAttribute("opacityMiddle")),k=parseFloat(a.getAttribute("opacityEnd")),h,m,l;if(l=a.getAttribute("colorStart"))h=(new THREE.Color).setStyle(l);if(l=a.getAttribute("colorEnd"))m=(new THREE.Color).setStyle(l);l=parseFloat(a.getAttribute("vx"))||0;var s=parseFloat(a.getAttribute("vy"))||
0,p=parseFloat(a.getAttribute("vz"))||0,u=parseFloat(a.getAttribute("ax"))||0,w=parseFloat(a.getAttribute("ay"))||0,y=parseFloat(a.getAttribute("az"))||0,t=parseFloat(a.getAttribute("psx"))||0,n=parseFloat(a.getAttribute("psy"))||0,q=parseFloat(a.getAttribute("psz"))||0,x=parseFloat(a.getAttribute("asx"))||0,r=parseFloat(a.getAttribute("asy"))||0,B=parseFloat(a.getAttribute("asz"))||0;l=new THREE.Vector3(l,s,p);u=new THREE.Vector3(u,w,y);t=new THREE.Vector3(t,n,q);x=new THREE.Vector3(x,r,B);(r=a.getAttribute("velocity"))&&
glam.DOMTypes.parseVector3(r,l);(r=a.getAttribute("acceleration"))&&glam.DOMTypes.parseVector3(r,u);(r=a.getAttribute("positionSpread"))&&glam.DOMTypes.parseVector3(r,t);(r=a.getAttribute("accelerationSpread"))&&glam.DOMTypes.parseVector3(r,x);r=THREE.NoBlending;switch((a.getAttribute("blending")||"").toLowerCase()){case "normal":r=THREE.NormalBlending;break;case "additive":r=THREE.AdditiveBlending;break;case "subtractive":r=THREE.SubtractiveBlending;break;case "multiply":r=THREE.MultiplyBlending;
break;case "custom":r=THREE.CustomBlending}b.size=c;b.sizeEnd=d;void 0!==h&&(b.colorStart=h);void 0!==m&&(b.colorEnd=m);b.particlesPerSecond=e;b.opacityStart=f;b.opacityMiddle=g;b.opacityEnd=k;b.velocity=l;b.acceleration=u;b.positionSpread=t;b.accelerationSpread=x;b.blending=r};glam.ParticlesElement.addEmitters=function(a,b){var c,d=a.length;for(c=0;c<d;c++)b.addComponent(a[c])};glam.ParticlesElement.DEFAULT_MAX_AGE=1;glam.BackgroundElement={};glam.BackgroundElement.DEFAULT_BACKGROUND_TYPE="box";
glam.BackgroundElement.create=function(a,b){var c=a.getAttribute("background-type")||glam.BackgroundElement.DEFAULT_BACKGROUND_TYPE,c=a.getAttribute("type")||c;if(b){b["background-type"]&&(c=b["background-type"]);var d=glam.DOMMaterial.parseStyle(b)}var e;"box"==c?(e=glam.Prefabs.Skybox(),e.getComponent(glam.SkyboxScript).texture=d.envMap):"sphere"==c&&(e=glam.Prefabs.Skysphere(),e.getComponent(glam.SkysphereScript).texture=d.envMap);glam.BackgroundElement.addHandlers(a,b,e);glam.Application.instance.addObject(e);
return null};glam.BackgroundElement.addHandlers=function(a,b,c){a.glam.setAttributeHandlers.push(function(b,e){glam.BackgroundElement.onSetAttribute(c,a,b,e)});b.setPropertyHandlers.push(function(b,e){glam.BackgroundElement.onSetAttribute(c,a,b,e)})};glam.BackgroundElement.onSetAttribute=function(a,b,c,d){switch(c){case "sphere-image":case "sphereImage":if(a=a.getComponent(glam.SkysphereScript))d=THREE.ImageUtils.loadTexture(d),a.texture=d}};glam.ControllerElement={};
glam.ControllerElement.create=function(a,b,c){b=!0;null!==a.getAttribute("noheadlight")&&(b=!1,c.controllerScript.headlightOn=!1);var d=a.getAttribute("type");if(null!==d)if(d=d.toLowerCase(),"fps"==d){parseFloat(a.getAttribute("x"));parseFloat(a.getAttribute("y"));parseFloat(a.getAttribute("z"));a=glam.Prefabs.FirstPersonController({active:!0,headlight:b});b=a.getComponent(glam.FirstPersonControllerScript);c.addObject(a);var d=new glam.Object,e=new glam.PerspectiveCamera;d.addComponent(e);c.addObject(d);
b.camera=e;e.active=!0}else"rift"==d?(a=glam.Prefabs.RiftController({active:!0,headlight:b,mouseLook:!1,useVRJS:!0}),b=a.getComponent(glam.RiftControllerScript),c.addObject(a),d=new glam.Object,e=new glam.PerspectiveCamera,d.addComponent(e),c.addObject(d),b.camera=e,e.active=!0,c.controllerScript&&(c.controllerScript.enabled=!1),c.controller=a,c.controllerScript=b):"deviceorientation"==d&&(a=glam.Prefabs.DeviceOrientationController({active:!0,headlight:b,mouseLook:!1,useVRJS:!0}),b=a.getComponent(glam.DeviceOrientationControllerScript),
c.addObject(a),d=new glam.Object,e=new glam.PerspectiveCamera,d.addComponent(e),c.addObject(d),b.camera=e,e.active=!0,c.controllerScript&&(c.controllerScript.enabled=!1),c.controller=a,c.controllerScript=b);return null};glam.DOMTypes={};
glam.DOMTypes.types={box:{cls:glam.BoxElement,transform:!0,animation:!0,input:!0,visual:!0},cone:{cls:glam.ConeElement,transform:!0,animation:!0,input:!0,visual:!0},cylinder:{cls:glam.CylinderElement,transform:!0,animation:!0,input:!0,visual:!0},sphere:{cls:glam.SphereElement,transform:!0,animation:!0,input:!0,visual:!0},rect:{cls:glam.RectElement,transform:!0,animation:!0,input:!0,visual:!0},circle:{cls:glam.CircleElement,transform:!0,animation:!0,input:!0,visual:!0},arc:{cls:glam.ArcElement,transform:!0,
animation:!0,input:!0,visual:!0},group:{cls:glam.GroupElement,transform:!0,animation:!0,input:!0},animation:{cls:glam.AnimationElement},background:{cls:glam.BackgroundElement},"import":{cls:glam.ImportElement,transform:!0,animation:!0},camera:{cls:glam.CameraElement,transform:!0,animation:!0},controller:{cls:glam.ControllerElement},text:{cls:glam.TextElement,transform:!0,animation:!0,input:!0,visual:!0},mesh:{cls:glam.MeshElement,transform:!0,animation:!0,input:!0,visual:!0},line:{cls:glam.LineElement,
transform:!0,animation:!0,visual:!0},light:{cls:glam.LightElement,transform:!0,animation:!0},particles:{cls:glam.ParticlesElement,transform:!0,animation:!0},effect:{cls:glam.EffectElement}};glam.DOMTypes.parseVector3Array=function(a,b){var c=a.textContent.match(/\S+/g);if(c){var d,e=c.length;if(!(3>e))for(d=0;d<e;d+=3){var f=parseFloat(c[d]),g=parseFloat(c[d+1]),k=parseFloat(c[d+2]),f=new THREE.Vector3(f,g,k);b.push(f)}}};
glam.DOMTypes.parseVector3=function(a,b){var c=a.match(/\S+/g);if(c&&!(3>c.length)){var d=parseFloat(c[0]),e=parseFloat(c[1]),c=parseFloat(c[2]);b.set(d,e,c)}};glam.DOMTypes.parseVector2Array=function(a,b){var c=a.textContent.match(/\S+/g);if(c){var d,e=c.length;if(!(2>e))for(d=0;d<e;d+=2){var f=parseFloat(c[d]),g=parseFloat(c[d+1]),f=new THREE.Vector2(f,g);b.push(f)}}};
glam.DOMTypes.parseColor3Array=function(a,b){var c=a.textContent.match(/\S+/g);if(c){var d,e=c.length;if(!(3>e))for(d=0;d<e;d+=3){var f=parseFloat(c[d]),g=parseFloat(c[d+1]),k=parseFloat(c[d+2]),f=new THREE.Color(f,g,k);b.push(f)}}};glam.DOMTypes.parseColor3=function(a,b){var c=a.match(/\S+/g);if(c&&!(3>c.length)){var d=parseFloat(c[0]),e=parseFloat(c[1]),c=parseFloat(c[2]);b.setRGB(d,e,c)}};
glam.DOMTypes.parseFaceArray=function(a,b){var c=a.textContent.match(/\S+/g);if(c){var d,e=c.length;if(!(1>e))for(d=0;d<e;d+=3){var f=parseInt(c[d]),g=parseInt(c[d+1]),k=parseInt(c[d+2]),f=new THREE.Face3(f,g,k);b.push(f)}}};glam.DOMTypes.parseUVArray=function(a,b){var c=a.textContent.match(/\S+/g);if(c){var d,e=c.length;if(!(6>e))for(d=0;d<e;d+=6){for(var f=[],g=0;3>g;g++){var k=parseFloat(c[d+2*g]),h=parseFloat(c[d+2*g+1]),k=new THREE.Vector2(k,h);f.push(k)}b.push(f)}}};glam.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*l.autoRotateSpeed}function d(a){!1!==l.enabled&&!1!==l.userRotate&&(a.preventDefault(),0===a.button||l.oneButton&&2===a.button?(A=z.ROTATE,p.set(a.clientX,a.clientY)):1===a.button&&l.userZoom?(A=z.ZOOM,y.set(a.clientX,a.clientY)):2===a.button&&l.userPan&&(A=z.PAN),l.domElement.addEventListener("mousemove",e,!1),l.domElement.addEventListener("mouseup",k,!1),l.domElement.addEventListener("touchmove",f,!1),l.domElement.addEventListener("touchend",
h,!1))}function e(a){!1!==l.enabled&&(a.preventDefault(),A===z.ROTATE?(u.set(a.clientX,a.clientY),w.subVectors(u,p),l.rotateLeft(2*Math.PI*w.x/s*l.userRotateSpeed),l.rotateUp(2*Math.PI*w.y/s*l.userRotateSpeed),p.copy(u)):A===z.ZOOM?(t.set(a.clientX,a.clientY),n.subVectors(t,y),0<n.y?l.zoomIn():l.zoomOut(),y.copy(t)):A===z.PAN&&l.pan(new THREE.Vector3(-(a.movementX||a.mozMovementX||a.webkitMovementX||0),a.movementY||a.mozMovementY||a.webkitMovementY||0,0)))}function f(a){if(!1!==l.enabled)if(1<a.changedTouches.length){for(var b=
null,c=null,d=0;d<a.changedTouches.length;d++)a.changedTouches[d].identifier==l.touchId0?b=a.changedTouches[d]:a.changedTouches[d].identifier==l.touchId1&&(c=a.changedTouches[d]);b&&(c&&l.userZoom)&&(a=g(b,c),b=a-l.touchDistance,0<b?l.zoomIn():0>b&&l.zoomOut(),l.touchDistance=a)}else l.userRotate&&e({type:"mousemove",view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:a.changedTouches[0].screenX,screenY:a.changedTouches[0].screenY,clientX:a.changedTouches[0].clientX,clientY:a.changedTouches[0].clientY,
pageX:a.changedTouches[0].pageX,pageY:a.changedTouches[0].pageY,button:0,preventDefault:function(){}})}function g(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return Math.sqrt(c*c+d*d)}function k(a){document.removeEventListener("mousemove",e,!1);document.removeEventListener("mouseup",k,!1);l.domElement.removeEventListener("touchmove",f,!1);l.domElement.removeEventListener("touchend",h,!1);A=z.NONE}function h(a){1<a.changedTouches.length||k({type:"mouseup",view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,
detail:a.detail,screenX:a.changedTouches[0].screenX,screenY:a.changedTouches[0].screenY,clientX:a.changedTouches[0].clientX,clientY:a.changedTouches[0].clientY,pageX:a.changedTouches[0].pageX,pageY:a.changedTouches[0].pageY,button:0,preventDefault:function(){}})}function m(a){a.preventDefault();if(!1!==l.enabled&&!1!==l.userZoom){var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail);0<b?l.zoomIn():l.zoomOut()}}this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.center=new THREE.Vector3;
this.userZoom=!0;this.userZoomSpeed=1;this.userRotate=!0;this.userRotateSpeed=1;this.userPan=!0;this.userPanSpeed=2;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minDistance=0;this.maxDistance=Infinity;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.usekeys=this.oneButton=!1;var l=this,s=1800,p=new THREE.Vector2,u=new THREE.Vector2,w=new THREE.Vector2,y=new THREE.Vector2,t=new THREE.Vector2,n=new THREE.Vector2,q=0,x=0,r=1,B=new THREE.Vector3,z={NONE:-1,
ROTATE:0,ZOOM:1,PAN:2},A=z.NONE,C={type:"change"};this.rotateLeft=function(a){void 0===a&&(a=c());x-=a};this.rotateRight=function(a){void 0===a&&(a=c());x+=a};this.rotateUp=function(a){void 0===a&&(a=c());q-=a};this.rotateDown=function(a){void 0===a&&(a=c());q+=a};this.zoomIn=function(a){void 0===a&&(a=Math.pow(1/0.95,l.userZoomSpeed));r/=a};this.zoomOut=function(a){void 0===a&&(a=Math.pow(1/0.95,l.userZoomSpeed));r*=a};this.pan=function(a){a.transformDirection(this.object.matrix);a.multiplyScalar(l.userPanSpeed);
this.object.position.add(a);this.center.add(a)};this.update=function(){var a=this.object.position,b=a.clone().sub(this.center),d=Math.atan2(b.x,b.z),e=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y);this.autoRotate&&this.rotateLeft(c());var d=d+x,e=e+q,e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),f=b.length()*r,f=Math.max(this.minDistance,Math.min(this.maxDistance,f));b.x=f*Math.sin(e)*Math.sin(d);b.y=f*Math.cos(e);b.z=f*Math.sin(e)*Math.cos(d);
a.copy(this.center).add(b);this.object.lookAt(this.center);q=x=0;r=1;0<B.distanceTo(this.object.position)&&(this.dispatchEvent(C),B.copy(this.object.position))};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",d,!1);this.domElement.addEventListener("touchstart",function(a){1<a.touches.length?(l.touchDistance=g(a.touches[0],a.touches[1]),l.touchId0=a.touches[0].identifier,l.touchId1=a.touches[1].identifier):d({type:"mousedown",
view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:a.touches[0].screenX,screenY:a.touches[0].screenY,clientX:a.touches[0].clientX,clientY:a.touches[0].clientY,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,button:0,preventDefault:function(){}})},!1);this.domElement.addEventListener("mousewheel",m,!1);this.domElement.addEventListener("DOMMouseScroll",m,!1);this.domElement.addEventListener("keydown",function(a){if(l.usekeys&&!1!==l.enabled&&!1!==l.userPan)switch(a.keyCode){case l.keys.UP:l.pan(new THREE.Vector3(0,
1,0));break;case l.keys.BOTTOM:l.pan(new THREE.Vector3(0,-1,0));break;case l.keys.LEFT:l.pan(new THREE.Vector3(-1,0,0));break;case l.keys.RIGHT:l.pan(new THREE.Vector3(1,0,0))}},!1)};glam.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);glam.CameraManager={};glam.CameraManager.addCamera=function(a){glam.CameraManager.cameraList.push(a)};glam.CameraManager.removeCamera=function(a){a=glam.CameraManager.cameraList.indexOf(a);-1!=a&&glam.CameraManager.cameraList.splice(a,1)};glam.CameraManager.setActiveCamera=function(a){glam.CameraManager.activeCamera&&glam.CameraManager.activeCamera!=a&&(glam.CameraManager.activeCamera.active=!1);glam.CameraManager.activeCamera=a;glam.Graphics.instance.setCamera(a.object)};
glam.CameraManager.handleWindowResize=function(a,b){var c=glam.CameraManager.cameraList;if(0==c.length)return!1;var d,e=c.length;for(d=0;d<e;d++)c[d].aspect=a/b;return!0};glam.CameraManager.cameraList=[];glam.CameraManager.activeCamera=null;glam.Viewer=function(a){glam.Application.call(this,a);this.lastFPSUpdateTime=0;this.renderStats={fps:0};this.sceneStats={meshCount:0,faceCount:0,boundingBox:new THREE.Box3};this.renderStatsUpdateInterval=void 0!==a.renderStatsUpdateInterval?a.renderStatsUpdateInterval:1E3;this.loopAnimations=void 0!==a.loopAnimations?a.loopAnimations:!1;this.headlightOn=void 0!==a.headlight?a.headlight:!0;this.headlightIntensity=a.headlightIntensity||glam.Viewer.DEFAULT_HEADLIGHT_INTENSITY;this.riftController=void 0!==
a.riftController?a.riftController:!1;this.firstPerson=void 0!==a.firstPerson?a.firstPerson:!1;this.showGrid=void 0!==a.showGrid?a.showGrid:!1;this.createBoundingBoxes=void 0!==a.createBoundingBoxes?a.createBoundingBoxes:!1;this.showBoundingBoxes=void 0!==a.showBoundingBoxes?a.showBoundingBoxes:!1;this.allowPan=void 0!==a.allowPan?a.allowPan:!0;this.allowZoom=void 0!==a.allowZoom?a.allowZoom:!0;this.oneButton=void 0!==a.oneButton?a.oneButton:!1;this.gridSize=a.gridSize||glam.Viewer.DEFAULT_GRID_SIZE;
this.gridStepSize=a.gridStepSize||glam.Viewer.DEFAULT_GRID_STEP_SIZE;this.flipY=void 0!==a.flipY?a.flipY:!1;this.highlightDecoration=this.highlightedObject=null;this.initScene();glam.Graphics.instance.enableShadows(!0)};goog.inherits(glam.Viewer,glam.Application);
glam.Viewer.prototype.initScene=function(){this.sceneRoot=new glam.Object;this.addObject(this.sceneRoot);this.flipY&&(this.sceneRoot.transform.rotation.x=-Math.PI/2);this.gridRoot=new glam.Object;this.addObject(this.gridRoot);this.gridPicker=this.grid=null;this.createGrid();this.firstPerson?(this.controller=glam.Prefabs.FirstPersonController({active:!0,headlight:!0,turn:!this.riftController,look:!this.riftController}),this.controllerScript=this.controller.getComponent(glam.FirstPersonControllerScript)):
(this.controller=glam.Prefabs.ModelController({active:!0,headlight:!0,allowPan:this.allowPan,allowZoom:this.allowZoom,oneButton:this.oneButton}),this.controllerScript=this.controller.getComponent(glam.ModelControllerScript));this.addObject(this.controller);var a=new glam.Object;this.defaultCamera=new glam.PerspectiveCamera({active:!0,position:glam.Viewer.DEFAULT_CAMERA_POSITION});a.addComponent(this.defaultCamera);a.name="[default]";this.addObject(a);this.controllerScript.camera=this.defaultCamera;
if(this.riftController){var a=glam.Prefabs.RiftController({active:!0,headlight:!1,mouseLook:!1,useVRJS:!0}),b=a.getComponent(glam.RiftControllerScript);b.camera=this.defaultCamera;b.moveSpeed=6;this.riftControllerScript=b;this.addObject(a)}a=new glam.Object;this.ambientLight=new glam.AmbientLight({color:16777215,intensity:this.ambientOn?1:0});this.addObject(a);this.scenes=[];this.keyFrameAnimators=[];this.keyFrameAnimatorNames=[];this.cameras=[];this.cameraNames=[];this.lights=[];this.lightNames=
[];this.lightIntensities=[];this.lightColors=[]};glam.Viewer.prototype.runloop=function(){var a=this.renderStatsUpdateInterval;glam.Application.prototype.runloop.call(this);if(glam.Graphics.instance.frameRate){var b=Date.now();b-this.lastFPSUpdateTime>a&&(this.renderStats.fps=glam.Graphics.instance.frameRate,this.dispatchEvent("renderstats",this.renderStats),this.lastFPSUpdateTime=b)}};
glam.Viewer.prototype.replaceScene=function(a){var b,c=this.sceneRoot._children.length,d=[];for(b=0;b<c;b++)d.push(this.sceneRoot._children[b]);for(b=0;b<c;b++)this.sceneRoot.removeChild(d[b]);this.sceneRoot.removeComponent(this.sceneRoot.findNode(glam.Decoration));this.scenes=[a.scene];this.sceneRoot.addChild(a.scene);glam.SceneUtils.computeBoundingBox(a.scene);if(this.keyFrameAnimators){c=this.keyFrameAnimators.length;for(b=0;b<c;b++)this.sceneRoot.removeComponent(this.keyFrameAnimators[b]);this.keyFrameAnimators=
[];this.keyFrameAnimatorNames=[]}if(a.keyFrameAnimators)for(c=a.keyFrameAnimators.length,b=0;b<c;b++)this.sceneRoot.addComponent(a.keyFrameAnimators[b]),this.keyFrameAnimators.push(a.keyFrameAnimators[b]),this.keyFrameAnimatorNames.push(a.keyFrameAnimators[b].animationData[0].name);this.cameras=[];this.cameraNames=[];this.cameras.push(this.defaultCamera);this.camera=this.defaultCamera;this.cameraNames.push("[default]");this.controllerScript.camera=this.defaultCamera;this.controllerScript.camera.active=
!0;if(a.cameras)for(c=a.cameras.length,b=0;b<c;b++)d=a.cameras[b],d.aspect=container.offsetWidth/container.offsetHeight,this.cameras.push(d),this.cameraNames.push(d._object.name);this.lights=[];this.lightNames=[];this.lightIntensities=[];this.lightColors=[];if(a.lights){c=a.lights.length;for(b=0;b<c;b++)d=a.lights[b],d instanceof THREE.SpotLight&&(d.castShadow=!0,d.shadowCameraNear=1,d.shadowCameraFar=glam.Light.DEFAULT_RANGE,d.shadowCameraFov=90,d.shadowBias=1E-4,d.shadowDarkness=0.3,d.shadowMapWidth=
2048,d.shadowMapHeight=2048,d.target.position.set(0,0,0)),this.lights.push(a.lights[b]),this.lightNames.push(a.lights[b]._object.name),this.lightIntensities.push(a.lights[b].intensity),this.lightColors.push(a.lights[b].color.clone());this.controllerScript.headlight.intensity=c?0:this.headlightIntensity;this.headlightOn=0>=c}else this.controllerScript.headlight.intensity=this.headlightIntensity,this.headlightOn=!0;this.initHighlight();this.fitToScene();this.calcSceneStats()};
glam.Viewer.prototype.addToScene=function(a){this.sceneRoot.addChild(a.scene);this.cameras.length||(this.cameras=[],this.cameraNames=[],this.cameras.push(this.defaultCamera),this.camera=this.defaultCamera,this.cameraNames.push("[default]"),this.controllerScript.camera=this.defaultCamera,this.controllerScript.camera.active=!0);if(a.keyFrameAnimators){var b,c=a.keyFrameAnimators.length;for(b=0;b<c;b++)this.sceneRoot.addComponent(a.keyFrameAnimators[b]),this.keyFrameAnimators.push(a.keyFrameAnimators[b]),
this.keyFrameAnimatorNames.push(a.keyFrameAnimators[b].animationData[0].name)}if(a.cameras)for(c=a.cameras.length,b=0;b<c;b++){var d=a.cameras[b];d.aspect=container.offsetWidth/container.offsetHeight;this.cameras.push(d);this.cameraNames.push(d._object.name)}if(a.lights)for(c=a.lights.length,b=0;b<c;b++)d=a.lights[b],d instanceof THREE.SpotLight&&(d.castShadow=!0,d.shadowCameraNear=1,d.shadowCameraFar=glam.Light.DEFAULT_RANGE,d.shadowCameraFov=90,d.shadowBias=1E-4,d.shadowDarkness=0.3,d.shadowMapWidth=
2048,d.shadowMapHeight=2048,d.target.position.set(0,0,0)),this.lights.push(a.lights[b]),this.lightNames.push(a.lights[b]._object.name),this.lightIntensities.push(a.lights[b].intensity),this.lightColors.push(a.lights[b].color.clone());else this.lights.length||(this.controllerScript.headlight.intensity=this.headlightIntensity,this.headlightOn=!0);this.scenes.push(a.scene);this.initHighlight();this.fitToScene();this.calcSceneStats()};
glam.Viewer.prototype.createDefaultCamera=function(){var a=this.controllerScript.viewpoint.camera.object;a.updateMatrixWorld();var b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3;a.matrixWorld.decompose(b,c,d);(new THREE.Euler).setFromQuaternion(c);a=new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far);return new glam.PerspectiveCamera({object:a})};
glam.Viewer.prototype.copyCameraValues=function(a,b){var c=a.object;c.updateMatrixWorld();var d=new THREE.Vector3,e=new THREE.Quaternion,f=new THREE.Vector3;c.matrixWorld.decompose(d,e,f);c=(new THREE.Euler).setFromQuaternion(e);b.position.copy(d);b.rotation.copy(c);b.fov=a.fov;b.aspect=a.aspect;b.near=a.near;b.far=a.far};
glam.Viewer.prototype.useCamera=function(a){var b=a;"string"==typeof a&&this.cameraNames&&(b=this.cameraNames.indexOf(a));0<=b&&(this.cameras&&this.cameras[b])&&(this.cameras[b].active=!0,this.controllerScript.enabled=0==b)};glam.Viewer.prototype.addCamera=function(a,b){this.cameras.push(a);this.cameraNames.push(b)};glam.Viewer.prototype.getCamera=function(a){var b=a;"string"==typeof a&&this.cameraNames&&(b=this.cameraNames.indexOf(a));return 0<=b&&this.cameras&&this.cameras[b]?this.cameras[b]:null};
glam.Viewer.prototype.toggleLight=function(a){if(this.lights&&this.lights[a]){var b=this.lights[a];b instanceof glam.AmbientLight?(b=b.color,0!=b.r||0!=b.g||0!=b.b?b.setRGB(0,0,0):b.copy(this.lightColors[a])):b.intensity=b.intensity?0:this.lightIntensities[a]}};
glam.Viewer.prototype.playAnimation=function(a,b,c){void 0===b&&(b=this.loopAnimations);this.keyFrameAnimators&&this.keyFrameAnimators[a]&&(this.keyFrameAnimators[a].loop=b,this.keyFrameAnimators[a].direction=c?glam.KeyFrameAnimator.REVERSE_DIRECTION:glam.KeyFrameAnimator.FORWARD_DIRECTION,b||this.keyFrameAnimators[a].stop(),this.keyFrameAnimators[a].start())};glam.Viewer.prototype.stopAnimation=function(a){this.keyFrameAnimators&&this.keyFrameAnimators[a]&&this.keyFrameAnimators[a].stop()};
glam.Viewer.prototype.playAllAnimations=function(a,b){void 0===a&&(a=this.loopAnimations);if(this.keyFrameAnimators){var c,d=this.keyFrameAnimators.length;for(c=0;c<d;c++)this.keyFrameAnimators[c].stop(),a&&(this.keyFrameAnimators[c].loop=!0),this.keyFrameAnimators[c].direction=b?glam.KeyFrameAnimator.REVERSE_DIRECTION:glam.KeyFrameAnimator.FORWARD_DIRECTION,this.keyFrameAnimators[c].start()}};
glam.Viewer.prototype.stopAllAnimations=function(){if(this.keyFrameAnimators){var a,b=this.keyFrameAnimators.length;for(a=0;a<b;a++)this.keyFrameAnimators[a].stop()}};glam.Viewer.prototype.setLoopAnimations=function(a){this.loopAnimations=a};glam.Viewer.prototype.setHeadlightOn=function(a){this.controllerScript.headlight.intensity=this.headlightIntensity?this.headlightIntensity:0;this.headlightOn=a};
glam.Viewer.prototype.setHeadlightIntensity=function(a){this.controllerScript.headlight.intensity=a};glam.Viewer.prototype.setGridOn=function(a){this.grid&&(this.grid.visible=a)};glam.Viewer.prototype.setBoundingBoxesOn=function(a){this.showBoundingBoxes=a;var b=this;this.sceneRoot.map(glam.Decoration,function(a){b.highlightedObject&&a==b.highlightDecoration||(a.visible=b.showBoundingBoxes)})};
glam.Viewer.prototype.setAmbientLightOn=function(a){this.ambientLight.intensity=a?1:0;this.ambientLightOn=a};glam.Viewer.prototype.setFlipY=function(a){(this.flipY=a)?(this.sceneRoot.transform.rotation.x=-Math.PI/2,this.fitToScene()):this.sceneRoot.transform.rotation.x=0};glam.Viewer.prototype.initHighlight=function(){this.highlightedObject&&this.highlightedObject.removeComponent(this.highlightDecoration);this.highlightedObject=null};
glam.Viewer.prototype.highlightObject=function(a){this.highlightedObject&&this.highlightParent.removeComponent(this.highlightDecoration);a?(this.highlightDecoration=glam.Helpers.BoundingBoxDecoration({object:a,color:11184640}),a instanceof glam.Object?(a._parent.addComponent(this.highlightDecoration),this.highlightedObject=a,this.highlightParent=a._parent):a instanceof glam.Visual&&(a._object.addComponent(this.highlightDecoration),this.highlightParent=this.highlightedObject=a._object)):this.highlightParent=
this.highlightedObject=null};
glam.Viewer.prototype.createGrid=function(){this.gridRoot&&(this.grid&&this.gridRoot.removeComponent(this.grid),this.gridPicker&&this.gridRoot.removeComponent(this.gridPicker));for(var a=this.gridStepSize,b=this.gridSize,c=new THREE.Geometry,d=0;d<=2*(b/a);d++)c.vertices.push(new THREE.Vector3(-b,-0.04,d*a-b)),c.vertices.push(new THREE.Vector3(b,-0.04,d*a-b)),c.vertices.push(new THREE.Vector3(d*a-b,-0.04,-b)),c.vertices.push(new THREE.Vector3(d*a-b,-0.04,b));a=new THREE.LineBasicMaterial({color:glam.Viewer.GRID_COLOR,opacity:glam.Viewer.GRID_OPACITY});
c=new THREE.Line(c,a,THREE.LinePieces);c.visible=this.showGrid;this.grid=new glam.Visual({object:c});this.gridRoot.addComponent(this.grid);this.gridPicker=new glam.Picker;var e=this;this.gridPicker.addEventListener("mouseup",function(a){e.highlightObject(null)});this.gridRoot.addComponent(this.gridPicker)};
glam.Viewer.prototype.fitToScene=function(){this.boundingBox=glam.SceneUtils.computeBoundingBox(this.sceneRoot);this.controllerScript.controls.userPanSpeed=1;1>this.boundingBox.max.z?(this.controllerScript.camera.near=0.01,this.controllerScript.controls.userPanSpeed=0.01):1E4<this.boundingBox.max.z?this.controllerScript.camera.far=2*this.boundingBox.max.z*Math.sqrt(2):1E3<this.boundingBox.max.z&&(this.controllerScript.camera.far=2E4);var a=this.boundingBox.max.clone().add(this.boundingBox.min).multiplyScalar(0.5);
this.controllerScript.center=a;1==this.scenes.length&&(a=new THREE.Vector3(0,this.boundingBox.max.y,2*this.boundingBox.max.z),this.controllerScript.camera.position.copy(a),this.controllerScript.camera.position.z*=2,this.cameras[0].position.copy(this.controllerScript.camera.position));if(this.createBoundingBoxes){var b=this;this.sceneRoot.map(glam.Object,function(a){if(a._parent){var d=glam.Helpers.BoundingBoxDecoration({object:a,color:65280});a._parent.addComponent(d);d.visible=b.showBoundingBoxes}})}this.sceneRadius=
this.boundingBox.max.clone().sub(this.boundingBox.min).length();this.gridSize=a=Math.pow(10,Math.ceil(Math.log(this.sceneRadius)/Math.LN10));this.gridStepSize=a/100;this.createGrid()};
glam.Viewer.prototype.calcSceneStats=function(){this.faceCount=this.meshCount=0;var a=this.sceneRoot.findNodes(glam.Visual),b,c=a.length;for(b=0;b<c;b++){var d=a[b].geometry;this.faceCount+=d.faces?d.faces.length:d.attributes.index.array.length/3;this.meshCount++}this.sceneStats.meshCount=this.meshCount;this.sceneStats.faceCount=this.faceCount;this.sceneStats.boundingBox=this.boundingBox;this.dispatchEvent("scenestats",this.sceneStats)};
glam.Viewer.prototype.setController=function(a){this.boundingBox||(this.boundingBox=glam.SceneUtils.computeBoundingBox(this.sceneRoot));var b;b=isFinite(this.boundingBox.max.x)?this.boundingBox.max.clone().add(this.boundingBox.min).multiplyScalar(0.5):new THREE.Vector3;switch(a){case "FPS":b.y=0}this.controllerScript.center=b};glam.Viewer.DEFAULT_CAMERA_POSITION=new THREE.Vector3(0,0,10);glam.Viewer.DEFAULT_GRID_SIZE=100;glam.Viewer.DEFAULT_GRID_STEP_SIZE=1;glam.Viewer.GRID_COLOR=2105376;
glam.Viewer.GRID_OPACITY=0.2;glam.Viewer.DEFAULT_HEADLIGHT_INTENSITY=1;glam.OculusRiftControls=function(a){var b=this,c=!1,d=!1,e=!1,f=!1,g=!1,k=!1,h=new THREE.Vector3;this.moveSpeed=0.03;this.jumpSpeed=2;var m=new THREE.Quaternion,l=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,0,1),p=function(a){switch(a.keyCode){case 38:case 87:c=!0;break;case 37:case 65:e=!0;break;case 40:case 83:d=!0;break;case 39:case 68:f=!0;break;case 32:!0===k&&(h.y+=this.jumpSpeed),k=!1}}.bind(this);document.addEventListener("mousemove",function(c){if(!1!==b.enabled){var d=c.movementX||c.mozMovementX||
c.webkitMovementX||0;c=c.movementY||c.mozMovementY||c.webkitMovementY||0;console.log(d,c);m.setFromAxisAngle(s,0.002*d);a.quaternion.multiplySelf(m);m.setFromAxisAngle(l,0.002*c);a.quaternion.multiplySelf(m)}},!1);document.addEventListener("keydown",p,!1);document.addEventListener("keyup",function(a){switch(a.keyCode){case 38:case 87:c=!1;break;case 37:case 65:e=!1;break;case 40:case 83:d=!1;break;case 39:case 68:f=!1}},!1);this.enabled=!1;this.getObject=function(){return a};this.isOnObject=function(a){k=
g=a};this.update=function(b,l){b*=0.1;h.x+=0.08*-h.x*b;h.z+=0.08*-h.z*b;h.y-=0.1*b;c&&(h.z-=this.moveSpeed*b);d&&(h.z+=this.moveSpeed*b);e&&(h.x-=this.moveSpeed*b);f&&(h.x+=this.moveSpeed*b);!0===g&&(h.y=Math.max(0,h.y));var m=new THREE.Quaternion;new THREE.Euler;l&&(m.set(l.hmd.rotation[0],l.hmd.rotation[1],l.hmd.rotation[2],l.hmd.rotation[3]),0==m.x&&0==m.y&&0==m.z&&0==m.w||a.quaternion.copy(m));10>a.position.y&&(h.y=0,k=!0)}};glam.PickManager={};
glam.PickManager.handleMouseMove=function(a){if(glam.PickManager.clickedObject){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onMouseMove)b[c].onMouseMove(a)}else{b=glam.PickManager.overObject;glam.PickManager.overObject=glam.PickManager.objectFromMouse(a);if(glam.PickManager.overObject!=b){if(b)for(glam.Graphics.instance.setCursor(null),a.type="mouseout",b=b.pickers,d=b.length,c=0;c<d;c++)if(b[c].enabled&&b[c].onMouseOut)b[c].onMouseOut(a);if(glam.PickManager.overObject)for(a.type=
"mouseover",b=glam.PickManager.overObject.pickers,d=b.length,c=0;c<d;c++)if(b[c].enabled&&b[c].overCursor&&glam.Graphics.instance.setCursor(b[c].overCursor),b[c].enabled&&b[c].onMouseOver)b[c].onMouseOver(a)}if(glam.PickManager.overObject)for(b=glam.PickManager.overObject.pickers,d=b.length,c=0;c<d;c++)b[c].enabled&&(b[c].moveWithoutCapture&&b[c].onMouseMove)&&(a.type="mousemove",b[c].onMouseMove(a))}};
glam.PickManager.handleMouseDown=function(a){glam.PickManager.clickedObject=glam.PickManager.objectFromMouse(a);if(glam.PickManager.clickedObject){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onMouseDown)b[c].onMouseDown(a)}};
glam.PickManager.handleMouseUp=function(a){if(glam.PickManager.clickedObject){var b=glam.PickManager.objectFromMouse(a),c=glam.PickManager.clickedObject.pickers,d,e=c.length;for(d=0;d<e;d++)c[d].enabled&&c[d].onMouseUp&&(c[d].onMouseUp(a),b==glam.PickManager.clickedObject&&(a.type="click",c[d].onMouseClick(a)))}glam.PickManager.clickedObject=null};glam.PickManager.handleMouseClick=function(a){};
glam.PickManager.handleMouseDoubleClick=function(a){glam.PickManager.clickedObject=glam.PickManager.objectFromMouse(a);if(glam.PickManager.clickedObject){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onMouseDoubleClick)b[c].onMouseDoubleClick(a)}glam.PickManager.clickedObject=null};
glam.PickManager.handleMouseScroll=function(a){if(glam.PickManager.overObject){var b=glam.PickManager.overObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onMouseScroll)b[c].onMouseScroll(a)}glam.PickManager.clickedObject=null};
glam.PickManager.handleTouchStart=function(a){if(0<a.touches.length&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a.pageX=a.touches[0].pageX,a.pageY=a.touches[0].pageY,a.elementX=a.touches[0].elementX,a.elementY=a.touches[0].elementY,glam.PickManager.clickedObject=glam.PickManager.objectFromMouse(a),glam.PickManager.clickedObject)){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&
b[c].onTouchStart)b[c].onTouchStart(a)}};glam.PickManager.handleTouchMove=function(a){if(0<a.touches.length&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a.pageX=a.touches[0].pageX,a.pageY=a.touches[0].pageY,a.elementX=a.touches[0].elementX,a.elementY=a.touches[0].elementY,glam.PickManager.clickedObject)){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onTouchMove)b[c].onTouchMove(a)}};
glam.PickManager.handleTouchEnd=function(a){if(0<a.changedTouches.length){a.screenX=a.changedTouches[0].screenX;a.screenY=a.changedTouches[0].screenY;a.clientX=a.changedTouches[0].clientX;a.clientY=a.changedTouches[0].clientY;a.pageX=a.changedTouches[0].pageX;a.pageY=a.changedTouches[0].pageY;a.elementX=a.changedTouches[0].elementX;a.elementY=a.changedTouches[0].elementY;if(glam.PickManager.clickedObject){var b=glam.PickManager.clickedObject.pickers,c,d=b.length;for(c=0;c<d;c++)if(b[c].enabled&&b[c].onTouchEnd)b[c].onTouchEnd(a)}glam.PickManager.clickedObject=
null}};glam.PickManager.objectFromMouse=function(a){var b=glam.Graphics.instance.objectFromMouse(a);if(b.object){a.face=b.face;a.normal=b.normal;a.point=b.point;a.object=b.object;if(b.object._object.pickers){var c=b.object._object.pickers,d,e=c.length;for(d=0;d<e;d++)if(c[d].enabled)return b.object._object}return glam.PickManager.findObjectPicker(a,b.hitPointWorld,b.object.object)}return null};
glam.PickManager.findObjectPicker=function(a,b,c){for(;c;){if(c.data&&c.data._object.pickers){var d=c.data._object.pickers,e,f=d.length;for(e=0;e<f;e++)if(d[e].enabled)return d=new THREE.Matrix4,d.getInverse(c.matrixWorld),a.point=b.clone(),a.point.applyMatrix4(d),c.data._object}c=c.parent}return null};glam.PickManager.clickedObject=null;glam.PickManager.overObject=null;glam.AmbientLight=function(a){a=a||{};glam.Light.call(this,a);this.object=a.object?a.object:new THREE.AmbientLight(a.color)};goog.inherits(glam.AmbientLight,glam.Light);glam.AmbientLight.prototype.realize=function(){glam.Light.prototype.realize.call(this)};glam.RotateBehavior=function(a){a=a||{};this.duration=void 0!==a.duration?a.duration:1;this.velocity=void 0!==a.velocity?a.velocity:Math.PI/2/this.duration;this.angle=this.startAngle=0;glam.Behavior.call(this,a)};goog.inherits(glam.RotateBehavior,glam.Behavior);glam.RotateBehavior.prototype.start=function(){this.angle=0;this._object.transform.rotation.y%=2*Math.PI;this.startAngle=this._object.transform.rotation.y;glam.Behavior.prototype.start.call(this)};
glam.RotateBehavior.prototype.evaluate=function(a){var b=2*Math.PI;this.angle=this.velocity*a;this.angle>=b&&(this.angle=this.once?b:this.angle%b);this._object.transform.rotation.y=this.startAngle+this.angle;this.once&&this.angle>=b&&this.stop()};glam.Prefabs.Skysphere=function(a){a=a||{};var b=new glam.Object({layer:glam.Graphics.instance.backgroundLayer}),c=new THREE.MeshBasicMaterial({color:16777215}),d=new THREE.SphereGeometry(500,32,32);d.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1));c=new glam.Visual({geometry:d,material:c});b.addComponent(c);a=new glam.SkysphereScript(a);b.addComponent(a);b.realize();return b};
glam.SkysphereScript=function(a){glam.Script.call(this,a);this.maincampos=new THREE.Vector3;this.maincamrot=new THREE.Quaternion;this.maincamscale=new THREE.Vector3;Object.defineProperties(this,{texture:{get:function(){return this.material.map},set:function(a){this.material.map=a}}})};goog.inherits(glam.SkysphereScript,glam.Script);
glam.SkysphereScript.prototype.realize=function(){this.material=this._object.getComponent(glam.Visual).material;this.camera=glam.Graphics.instance.backgroundLayer.camera;this.camera.far=2E4;this.camera.position.set(0,0,0)};glam.SkysphereScript.prototype.update=function(){var a=glam.Graphics.instance.camera;a.updateMatrixWorld();a.matrixWorld.decompose(this.maincampos,this.maincamrot,this.maincamscale);this.camera.quaternion.copy(this.maincamrot)};glam.System={log:function(){var a=["[glam] "].concat([].slice.call(arguments));console.log.apply(console,a)},warn:function(){var a=["[glam] "].concat([].slice.call(arguments));console.warn.apply(console,a)},error:function(){var a=["[glam] "].concat([].slice.call(arguments));console.error.apply(console,a)},ajax:function(a){var b=a.dataType,c=a.success,d=a.error,e=new XMLHttpRequest;e.open(a.type,a.url,!0);e.responseType=b;e.addEventListener("load",function(a){c(e.response)},!1);e.addEventListener("error",
function(a){d(e.status)},!1);e.send(null)}};glam.PointLight=function(a){a=a||{};glam.Light.call(this,a);this.positionVec=new THREE.Vector3;this.object=a.object?a.object:new THREE.PointLight(a.color,a.intensity,void 0!==a.distance?a.distance:glam.PointLight.DEFAULT_DISTANCE);Object.defineProperties(this,{distance:{get:function(){return this.object.distance},set:function(a){this.object.distance=a}}})};goog.inherits(glam.PointLight,glam.Light);glam.PointLight.prototype.realize=function(){glam.Light.prototype.realize.call(this)};
glam.PointLight.prototype.update=function(){this.object&&(this.positionVec.set(0,0,0),this.positionVec.applyMatrix4(this.object.parent.matrixWorld),this.position.copy(this.positionVec));glam.Light.prototype.update.call(this)};glam.PointLight.DEFAULT_DISTANCE=0;glam.Effect=function(a){glam.EventDispatcher.call(this);this.isShaderEffect=!1;a.render&&"function"==typeof a.render?this.pass=a:(this.pass=new THREE.ShaderPass(a),this.isShaderEffect=!0)};goog.inherits(glam.Effect,glam.EventDispatcher);glam.Effect.prototype.update=function(){};glam.PlaneDragger=function(a){a=a||{};glam.Picker.call(this,a);this.normal=a.normal||new THREE.Vector3(0,0,1);this.position=a.position||new THREE.Vector3;this.color=170};goog.inherits(glam.PlaneDragger,glam.Picker);
glam.PlaneDragger.prototype.realize=function(){glam.Picker.prototype.realize.call(this);this.dragObject=null;this.dragOffset=new THREE.Vector3;this.dragHitPoint=new THREE.Vector3;this.dragStartPoint=new THREE.Vector3;this.dragPlane=this.createDragPlane();this.dragPlane.visible=glam.PlaneDragger.SHOW_DRAG_PLANE;this.dragPlane.ignorePick=!0;this.dragPlane.ignoreBounds=!0;this._object._parent.transform.object.add(this.dragPlane)};
glam.PlaneDragger.prototype.createDragPlane=function(){var a=this.normal,b=this.position,c=(new THREE.Vector3(0,a.z,-a.y)).normalize().multiplyScalar(2E3);c.lengthSq()||(c=(new THREE.Vector3(-a.z,a.x,0)).normalize().multiplyScalar(2E3));var d=c.clone().cross(a).normalize().multiplyScalar(2E3),e=b.clone().sub(c).sub(d),f=b.clone().add(c).sub(d),g=b.clone().add(c).add(d),c=b.clone().sub(c).add(d),b=new THREE.Geometry;b.vertices.push(e,f,g,c);e=new THREE.Face3(0,2,1);e.normal.copy(a);e.vertexNormals.push(a.clone(),
a.clone(),a.clone(),a.clone());b.faces.push(e);e=new THREE.Face3(0,3,2);e.normal.copy(a);e.vertexNormals.push(a.clone(),a.clone(),a.clone(),a.clone());b.faces.push(e);b.computeFaceNormals();a=new THREE.MeshBasicMaterial({color:this.color,transparent:!0,side:THREE.DoubleSide,opacity:0.1});return new THREE.Mesh(b,a)};glam.PlaneDragger.prototype.update=function(){};glam.PlaneDragger.prototype.onMouseMove=function(a){glam.Picker.prototype.onMouseMove.call(this,a);this.handleMouseMove(a)};
glam.PlaneDragger.prototype.handleMouseMove=function(a){if(a=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,this.dragPlane))this.dragHitPoint.copy(a.point).sub(this.dragOffset),this.dragHitPoint.add(this.dragStartPoint),this.dispatchEvent("drag",{type:"drag",object:this.dragObject,offset:this.dragHitPoint})};glam.PlaneDragger.prototype.onMouseDown=function(a){glam.Picker.prototype.onMouseDown.call(this,a);this.handleMouseDown(a)};
glam.PlaneDragger.prototype.handleMouseDown=function(a){var b=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,this.dragPlane);b&&(this.dragOffset.copy(b.point),this.dragStartPoint.copy(a.object.position),this.dragHitPoint.copy(b.point).sub(this.dragOffset),this.dragHitPoint.add(this.dragStartPoint),this.dragObject=a.object,this.dispatchEvent("dragstart",{type:"dragstart",object:this.dragObject,offset:this.dragHitPoint}))};
glam.PlaneDragger.prototype.onMouseUp=function(a){glam.Picker.prototype.onMouseUp.call(this,a);this.handleMouseUp(a)};glam.PlaneDragger.prototype.handleMouseUp=function(a){};glam.PlaneDragger.prototype.onTouchStart=function(a){glam.Picker.prototype.onTouchStart.call(this,a);this.handleMouseDown(a)};glam.PlaneDragger.prototype.onTouchMove=function(a){glam.Picker.prototype.onTouchMove.call(this,a);this.handleMouseMove(a)};
glam.PlaneDragger.prototype.onTouchEnd=function(a){glam.Picker.prototype.onTouchEnd.call(this,a);this.handleMouseUp(a)};glam.PlaneDragger.SHOW_DRAG_PLANE=!1;glam.PlaneDragger.SHOW_DRAG_NORMAL=!1;glam.SceneVisual=function(a){a=a||{};glam.Visual.call(this,a);this.object=a.scene};goog.inherits(glam.SceneVisual,glam.Visual);glam.SceneVisual.prototype.realize=function(){glam.Visual.prototype.realize.call(this);this.addToScene()};glam.Helpers={};glam.Helpers.BoundingBoxDecoration=function(a){a=a||{};if(!a.object)return glam.warn("glam.Helpers.BoundingBoxDecoration requires an object"),null;var b=void 0!==a.color?a.color:8947848;a=glam.SceneUtils.computeBoundingBox(a.object);var c=a.max.x-a.min.x,d=a.max.y-a.min.y,e=a.max.z-a.min.z,f=new THREE.BoxHelper;f.material.color.setHex(b);f.scale.set(c/2,d/2,e/2);b=new glam.Decoration({object:f});a=a.max.clone().add(a.min).multiplyScalar(0.5);b.position.add(a);return b};
glam.Helpers.VectorDecoration=function(a){a=a||{};var b=a.start||new THREE.Vector3,c=a.end||new THREE.Vector3(0,1,0),d=void 0!==a.color?a.color:8947848;a=new THREE.Geometry;a.vertices.push(b,c);b=new THREE.LineBasicMaterial({color:d});b=new THREE.Line(a,b);return new glam.Decoration({object:b})};
glam.Helpers.PlaneDecoration=function(a){a=a||{};if(!a.normal&&!a.triangle)return glam.warn("glam.Helpers.PlaneDecoration requires either a normal or three coplanar points"),null;var b=a.normal;if(!b)return glam.warn("glam.Helpers.PlaneDecoration creating plane from coplanar points not implemented yet"),null;var c=a.position||new THREE.Vector3,d=a.size||1;a=void 0!==a.color?a.color:8947848;var e=(new THREE.Vector3(0,b.z,-b.y)).normalize().multiplyScalar(d),f=e.clone().cross(b).normalize().multiplyScalar(d),
d=c.clone().sub(e).sub(f),g=c.clone().add(e).sub(f),k=c.clone().add(e).add(f),e=c.clone().sub(e).add(f),c=new THREE.Geometry;c.vertices.push(d,g,k,e);d=new THREE.Face3(0,1,2);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone(),b.clone());c.faces.push(d);d=new THREE.Face3(0,2,3);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone(),b.clone());c.faces.push(d);c.computeFaceNormals();c.computeCentroids();b=new THREE.MeshBasicMaterial({color:a,transparent:!0,side:THREE.DoubleSide,
opacity:0.1});b=new THREE.Mesh(c,b);return new glam.Decoration({object:b})};glam.SceneUtils={};
glam.SceneUtils.computeBoundingBox=function(a){var b=function(a){if(a instanceof THREE.Mesh&&!a.ignoreBounds){var d=a.geometry;return d?(d.boundingBox||d.computeBoundingBox(),d=d.boundingBox.clone(),a.updateMatrix(),d.applyMatrix4(a.matrix),d):new THREE.Box3(new THREE.Vector3,new THREE.Vector3)}for(var e=a.children.length,f=new THREE.Box3,d=0;d<e;d++){var g=b(a.children[d]);g.min.x<f.min.x&&(f.min.x=g.min.x);g.max.x>f.max.x&&(f.max.x=g.max.x);g.min.y<f.min.y&&(f.min.y=g.min.y);g.max.y>f.max.y&&(f.max.y=
g.max.y);g.min.z<f.min.z&&(f.min.z=g.min.z);g.max.z>f.max.z&&(f.max.z=g.max.z)}isFinite(f.min.x)&&(a.updateMatrix(),f.applyMatrix4(a.matrix));return f};return a instanceof glam.Object?b(a.transform.object):a instanceof glam.Visual?b(a.object):new THREE.Box3(new THREE.Vector3,new THREE.Vector3)};glam.Loader=function(){glam.EventDispatcher.call(this)};goog.inherits(glam.Loader,glam.EventDispatcher);glam.Loader.prototype.loadModel=function(a,b){var c=a.split("."),d=c.length,e="";d&&(e=c[d-1]);if(e&&e.length){var f;switch(e.toUpperCase()){case "JS":f=THREE.JSONLoader}if(f){var g=this;(new f).load(a,function(c,d){g.handleModelLoaded(a,b,c,d)})}}};
glam.Loader.prototype.handleModelLoaded=function(a,b,c,d){a=new THREE.MeshFaceMaterial(d);a=new THREE.Mesh(c,a);c=new glam.Object;a=new glam.Visual({object:a});c.addComponent(a);this.dispatchEvent("loaded",{scene:c,cameras:[],lights:[],keyFrameAnimators:[],userData:b})};
glam.Loader.prototype.loadScene=function(a,b){var c=a.split("."),d=c.length,e="";d&&(e=c[d-1]);if(e&&e.length){var f;switch(e.toUpperCase()){case "DAE":f=THREE.ColladaLoader;break;case "JS":return this.loadModel(a,b);case "JSON":f=THREE.glTFLoader}if(f){var g=this;(new f).load(a,function(c){g.handleSceneLoaded(a,c,b)},function(b){g.handleSceneProgress(a,b)})}}};
glam.Loader.prototype.traverseCallback=function(a,b){a instanceof THREE.Camera&&(b.cameras||(b.cameras=[]),b.cameras.push(a));a instanceof THREE.Light&&(b.lights||(b.lights=[]),b.lights.push(a))};
glam.Loader.prototype.handleSceneLoaded=function(a,b,c){var d={},e=!1;b.scene&&(e=this.convertScene(b.scene),d.scene=e,d.cameras=e.findNodes(glam.Camera),d.lights=e.findNodes(glam.Light),d.url=a,d.userData=c,e=!0);if(b.animations)for(d.keyFrameAnimators=[],c=b.animations.length,a=0;a<c;a++){var f=[];f.push(b.animations[a]);d.keyFrameAnimators.push(new glam.KeyFrameAnimator({animations:f}))}e&&this.dispatchEvent("loaded",d)};
glam.Loader.prototype.handleSceneProgress=function(a,b){this.dispatchEvent("progress",b)};
glam.Loader.prototype.convertScene=function(a){function b(a){if(a instanceof THREE.Mesh){a.matrixAutoUpdate=!0;a.geometry.dynamic=!0;var d=new glam.Visual({object:a});d.name=a.name;return d}if(a instanceof THREE.Camera){if(a instanceof THREE.PerspectiveCamera)return new glam.PerspectiveCamera({object:a})}else if(a instanceof THREE.Light){if(a instanceof THREE.AmbientLight)return new glam.AmbientLight({object:a});if(a instanceof THREE.DirectionalLight)return new glam.DirectionalLight({object:a});if(a instanceof
THREE.PointLight)return new glam.PointLight({object:a});if(a instanceof THREE.SpotLight)return new glam.SpotLight({object:a})}else if(a.children){d=new glam.Object({autoCreateTransform:!1});d.addComponent(new glam.Transform({object:a}));d.name=a.name;a.matrixAutoUpdate=!0;var e,f=a.children.length;for(e=0;e<f;e++){var g=b(a.children[e]);g instanceof glam.Object?d.addChild(g):g instanceof glam.Component&&d.addComponent(g)}}return d}a.updateMatrixWorld();return b(a)};glam.Prefabs.ModelController=function(a){a=a||{};var b=new glam.Object(a),c=new glam.ModelControllerScript(a);b.addComponent(c);a=new glam.DirectionalLight({intensity:a.headlight?1:0});b.addComponent(a);return b};
glam.ModelControllerScript=function(a){glam.Script.call(this,a);this.radius=a.radius||glam.ModelControllerScript.default_radius;this.minRadius=a.minRadius||glam.ModelControllerScript.default_min_radius;this.minAngle=void 0!==a.minAngle?a.minAngle:glam.ModelControllerScript.default_min_angle;this.maxAngle=void 0!==a.maxAngle?a.maxAngle:glam.ModelControllerScript.default_max_angle;this.minDistance=void 0!==a.minDistance?a.minDistance:glam.ModelControllerScript.default_min_distance;this.maxDistance=
void 0!==a.maxDistance?a.maxDistance:glam.ModelControllerScript.default_max_distance;this.allowPan=void 0!==a.allowPan?a.allowPan:!0;this.allowZoom=void 0!==a.allowZoom?a.allowZoom:!0;this.allowRotate=void 0!==a.allowRotate?a.allowRotate:!0;this.oneButton=void 0!==a.oneButton?a.oneButton:!0;this._enabled=void 0!==a.enabled?a.enabled:!0;this._headlightOn=a.headlight;this.cameras=[];this.controlsList=[];Object.defineProperties(this,{camera:{get:function(){return this._camera},set:function(a){this.setCamera(a)}},
center:{get:function(){return this.controls.center},set:function(a){this.controls.center.copy(a)}},enabled:{get:function(){return this._enabled},set:function(a){this.setEnabled(a)}},headlightOn:{get:function(){return this._headlightOn},set:function(a){this.setHeadlightOn(a)}}})};goog.inherits(glam.ModelControllerScript,glam.Script);glam.ModelControllerScript.prototype.realize=function(){this.headlight=this._object.getComponent(glam.DirectionalLight);this.headlight.intensity=this._headlightOn?1:0};
glam.ModelControllerScript.prototype.createControls=function(a){a=new glam.OrbitControls(a.object,glam.Graphics.instance.container);a.userMinY=this.minY;a.userMinZoom=this.minZoom;a.userMaxZoom=this.maxZoom;a.minPolarAngle=this.minAngle;a.maxPolarAngle=this.maxAngle;a.minDistance=this.minDistance;a.maxDistance=this.maxDistance;a.oneButton=this.oneButton;a.userPan=this.allowPan;a.userZoom=this.allowZoom;a.userRotate=this.allowRotate;a.enabled=this._enabled;return a};
glam.ModelControllerScript.prototype.update=function(){this.controls.update();this._headlightOn&&this.headlight.direction.copy(this._camera.position).negate()};glam.ModelControllerScript.prototype.setCamera=function(a){this._camera=a;this._camera.position.set(0,this.radius/2,this.radius);this.controls=this.createControls(a)};glam.ModelControllerScript.prototype.setHeadlightOn=function(a){this._headlightOn=a;this.headlight&&(this.headlight.intensity=a?1:0)};
glam.ModelControllerScript.prototype.setEnabled=function(a){this._enabled=a;this.controls.enabled=a};glam.ModelControllerScript.default_radius=10;glam.ModelControllerScript.default_min_radius=1;glam.ModelControllerScript.default_min_angle=0;glam.ModelControllerScript.default_max_angle=Math.PI;glam.ModelControllerScript.default_min_distance=0;glam.ModelControllerScript.default_max_distance=Infinity;glam.ModelControllerScript.MAX_X_ROTATION=0;glam.ModelControllerScript.MIN_X_ROTATION=-Math.PI/2;
glam.ModelControllerScript.MAX_Y_ROTATION=2*Math.PI;glam.ModelControllerScript.MIN_Y_ROTATION=2*-Math.PI;glam.Prefabs.DeviceOrientationController=function(a){a=a||{};var b=new glam.Object(a),c=new glam.DeviceOrientationControllerScript(a);b.addComponent(c);a=new glam.DirectionalLight({intensity:a.headlight?1:0});b.addComponent(a);return b};
glam.DeviceOrientationControllerScript=function(a){glam.Script.call(this,a);this._enabled=void 0!==a.enabled?a.enabled:!0;this._headlightOn=a.headlight;this.roll=void 0!==a.roll?a.roll:!0;Object.defineProperties(this,{camera:{get:function(){return this._camera},set:function(a){this.setCamera(a)}},enabled:{get:function(){return this._enabled},set:function(a){this.setEnabled(a)}},headlightOn:{get:function(){return this._headlightOn},set:function(a){this.setHeadlightOn(a)}}})};
goog.inherits(glam.DeviceOrientationControllerScript,glam.Script);glam.DeviceOrientationControllerScript.prototype.realize=function(){this.headlight=this._object.getComponent(glam.DirectionalLight);this.headlight.intensity=this._headlightOn?1:0};glam.DeviceOrientationControllerScript.prototype.createControls=function(a){a=new glam.DeviceOrientationControlsCB(a.object);this._enabled&&a.connect();a.roll=this.roll;return a};
glam.DeviceOrientationControllerScript.prototype.update=function(){this._enabled&&this.controls.update();this._headlightOn&&this.headlight.direction.copy(this._camera.position).negate()};glam.DeviceOrientationControllerScript.prototype.setEnabled=function(a){(this._enabled=a)?this.controls.connect():this.controls.disconnect()};glam.DeviceOrientationControllerScript.prototype.setHeadlightOn=function(a){this._headlightOn=a;this.headlight&&(this.headlight.intensity=a?1:0)};
glam.DeviceOrientationControllerScript.prototype.setCamera=function(a){this._camera=a;this.controls=this.createControls(a)};glam.FirstPersonControls=function(a,b){function c(a,b){return function(){b.apply(a,arguments)}}this.object=a;this.target=new THREE.Vector3(0,0,0);this.domElement=void 0!==b?b:document;this.lookSpeed=this.movementSpeed=1;this.tiltSpeed=this.turnSpeed=5;this.touchScreenY=this.touchScreenX=this.lastMouseY=this.lastMouseX=this.mouseY=this.mouseX=this.tiltAngle=this.turnAngle=0;this.moveTouchId=this.lookTouchId=-1;this.theta=this.phi=this.lon=this.lat=0;this.mouseLook=this.mouseDragOn=this.tiltDown=this.tiltUp=
this.turnLeft=this.turnRight=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.viewHalfY=this.viewHalfX=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)};this.onMouseDown=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,
this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY);this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY;this.mouseDragOn=!0};this.onMouseUp=function(a){this.mouseDragOn=!1};this.onMouseMove=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-
this.viewHalfY)};this.onTouchStart=function(a){a.preventDefault();0<a.touches.length&&(-1==this.lookTouchId?(this.lookTouchId=a.touches[0].identifier,this.onMouseDown({type:"mousedown",view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:a.touches[0].screenX,screenY:a.touches[0].screenY,clientX:a.touches[0].clientX,clientY:a.touches[0].clientY,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,button:0,preventDefault:a.preventDefault})):(this.touchScreenX=a.touches[1].screenX,
this.touchScreenY=a.touches[1].screenY,this.moveTouchId=a.touches[1].identifier))};this.onTouchMove=function(a){a.preventDefault();for(var b=null,c=null,d=a.changedTouches.length,h=0;h<d;h++)a.changedTouches[h].identifier==this.lookTouchId&&(b=a.changedTouches[h]),a.changedTouches[h].identifier==this.moveTouchId&&(c=a.changedTouches[h]);if(b)this.onMouseMove({type:"mousemove",view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:b.screenX,screenY:b.screenY,clientX:b.clientX,
clientY:b.clientY,pageX:b.pageX,pageY:b.pageY,button:0,preventDefault:a.preventDefault});c&&(a=c.screenX-this.touchScreenX,b=c.screenY-this.touchScreenY,this.touchScreenX=c.screenX,this.touchScreenY=c.screenY,0<a&&(this.moveRight=!0),0>a&&(this.moveLeft=!0),0<b&&(this.moveBackward=!0),0>b&&(this.moveForward=!0))};this.onTouchEnd=function(a){a.preventDefault();for(var b=null,c=null,d=a.changedTouches.length,h=0;h<d;h++)a.changedTouches[h].identifier==this.lookTouchId&&(b=a.changedTouches[h]),a.changedTouches[h].identifier==
this.moveTouchId&&(c=a.changedTouches[h]);b&&(this.onMouseUp({type:"mouseup",view:a.view,bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:b.screenX,screenY:b.screenY,clientX:b.clientX,clientY:b.clientY,pageX:b.pageX,pageY:b.pageY,button:0,preventDefault:a.preventDefault}),this.lookTouchId=-1);c&&(this.touchScreenX=c.screenX,this.touchScreenY=c.screenY,this.moveForward=this.moveBackward=this.moveLeft=this.moveRight=!1,this.moveTouchId=-1)};this.onGamepadButtonsChanged=function(a){};
this.onGamepadAxesChanged=function(a){a=a.changedAxes;var b,c=a.length;for(b=0;b<c;b++){var d=a[b];d.axis==glam.Gamepad.AXIS_LEFT_V?-0.2>d.value?(this.moveForward=!0,this.moveBackward=!1):(this.moveBackward=0.2<d.value?!0:!1,this.moveForward=!1):d.axis==glam.Gamepad.AXIS_LEFT_H?0.5<d.value?(this.moveRight=!0,this.moveLeft=!1):(this.moveLeft=-0.5>d.value?!0:!1,this.moveRight=!1):d.axis==glam.Gamepad.AXIS_RIGHT_V?-0.2>d.value?(this.tiltUp=!0,this.tiltDown=!1):(this.tiltDown=0.2<d.value?!0:!1,this.tiltUp=
!1):d.axis==glam.Gamepad.AXIS_RIGHT_H&&(0.5<d.value?(this.turnLeft=!0,this.turnRight=!1):-0.5>d.value?(this.turnRight=!0,this.turnLeft=!1):this.turnRight=this.turnLeft=!1)}};this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}};this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=
!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(a){if(!1!==this.enabled){this.startY=this.object.position.y;a*=this.movementSpeed;this.moveForward&&this.object.translateZ(-a);this.moveBackward&&this.object.translateZ(a);this.moveLeft&&this.object.translateX(-a);this.moveRight&&this.object.translateX(a);this.object.position.y=this.startY;if((this.mouseDragOn||
this.mouseLook)&&this.lookSpeed){a=this.lastMouseX-this.mouseX;Math.abs(a);a=900*(a/this.viewHalfX);this.lon+=a*this.lookSpeed;a=this.lastMouseY-this.mouseY;Math.abs(a);a=900*(a/this.viewHalfY);this.lat+=a*this.lookSpeed;this.theta=THREE.Math.degToRad(this.lon);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(this.lat);a=this.target;var b=this.object.position;a.x=b.x-Math.sin(this.theta);a.y=b.y+Math.sin(this.phi);a.z=b.z-Math.cos(this.theta);this.object.lookAt(a);this.lastMouseX=
this.mouseX;this.lastMouseY=this.mouseY}if(this.turnRight||this.turnLeft||this.tiltUp||this.tiltDown)a=0,this.turnRight?a=1:this.turnLeft&&(a=-1),this.lon+=a*this.turnSpeed,a=0,this.tiltUp?a=1:this.tiltDown&&(a=-1),this.lat+=a*this.tiltSpeed,this.theta=THREE.Math.degToRad(this.lon),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(this.lat),a=this.target,b=this.object.position,this.turnSpeed&&(a.x=b.x-Math.sin(this.theta)),this.tiltSpeed&&(a.y=b.y+Math.sin(this.phi),a.z=b.z-
Math.cos(this.theta)),(this.turnSpeed||this.tiltSpeed)&&this.object.lookAt(a)}};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),!0);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),!1);this.domElement.addEventListener("touchstart",c(this,this.onTouchStart),!1);this.domElement.addEventListener("touchmove",
c(this,this.onTouchMove),!1);this.domElement.addEventListener("touchend",c(this,this.onTouchEnd),!1);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),!1);this.domElement.addEventListener("resize",c(this,this.handleResize),!1);var d=glam.Gamepad.instance;d&&(d.addEventListener("buttonsChanged",c(this,this.onGamepadButtonsChanged),!1),d.addEventListener("axesChanged",c(this,this.onGamepadAxesChanged),!1));this.handleResize()};glam.DOMInput={};glam.DOMInput.add=function(a,b){function c(b,c){b.addEventListener(c,function(b){var d=new CustomEvent(c,{detail:{},bubbles:!0,cancelable:!0}),e;for(e in b)void 0===d[e]&&(d[e]=b[e]);a.dispatchEvent(d)})}var d=new glam.Picker,e="click mouseover mouseout mousedown mouseup mousemove touchstart touchend".split(" "),f;for(f in e)c(d,e[f]);b.addComponent(d);d=new glam.ViewPicker;b.addComponent(d);c(d,"viewover");c(d,"viewout")};glam.DOMStyle=function(a){this.docelt=a;this._properties={};this.setPropertyHandlers=[];this.defineStandardProperties()};glam.DOMStyle.prototype={};glam.DOMStyle.prototype.addProperties=function(a){for(var b in a)this.addProperty(b,a[b])};glam.DOMStyle.prototype.addProperty=function(a,b){this.defineProperty(a,b);this._properties[a]=b};
glam.DOMStyle.prototype.addPropertiesFromString=function(a){a=a.split(";");var b={},c,d=a.length;for(c=0;c<d;c++){var e=a[c].split(":"),f=e[0];(f=f.replace(/ /g,""))&&(b[f]=e[1])}this.addProperties(b)};glam.DOMStyle.prototype.onPropertyChanged=function(a,b){var c,d=this.setPropertyHandlers.length;for(c=0;c<d;c++){var e=this.setPropertyHandlers[c];e&&e(a,b)}};
glam.DOMStyle.prototype.defineProperty=function(a,b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,get:function(){return this._properties[a]},set:function(b){this._properties[a]=b;this.onPropertyChanged(a,b)}})};glam.DOMStyle.prototype.defineStandardProperties=function(){var a=glam.DOMStyle._standardProperties,b;for(b in a)this.defineProperty(b,a[b])};
glam.DOMStyle._standardProperties={angle:"","backface-visibility":"visible","background-type":"","bevel-size":"","bevel-thickness":"",color:"","diffuse-color":"",diffuseColor:"","specular-color":"",specularColor:"","dash-size":"",depth:"",distance:"","end-angle":"","cube-image-back":"","cube-image-bottom":"","cube-image-front":"","cube-image-left":"","cube-image-right":"","cube-image-top":"","sphere-image":"",sphereImage:"","font-bevel":"","font-depth":"","font-family":"","font-size":"","font-style":"",
"font-weight":"","gap-size":"",height:"","line-width":"",image:"","normal-image":"","bump-image":"","specular-image":"",opacity:"",radius:"","radius-segments":"","width-segments":"","height-segments":"",reflectivity:"","refraction-ratio":"","render-mode":"",rx:"",ry:"",rz:"",shader:"phong","fragment-shader":"","vertex-shader":"","shader-uniforms":"","start-angle":"",sx:"",sy:"",sz:"","vertex-colors":"","vertex-normals":"",width:"",x:"",y:"",z:""};glam.Timer=function(a){glam.Component.call(this);a=a||{};this.currentTime=glam.Time.instance.currentTime;this.running=!1;this.duration=a.duration?a.duration:0;this.loop=void 0!==a.loop?a.loop:!1;this.lastFraction=0};goog.inherits(glam.Timer,glam.Component);
glam.Timer.prototype.update=function(){if(this.running){var a=glam.Time.instance.currentTime;a-this.currentTime&&this.dispatchEvent("time",a);if(this.duration){var b=a%this.duration/this.duration;this.dispatchEvent("fraction",b);b<this.lastFraction&&(this.dispatchEvent("cycleTime"),this.loop||this.stop());this.lastFraction=b}this.currentTime=a}};glam.Timer.prototype.start=function(){this.running=!0;this.currentTime=glam.Time.instance.currentTime};
glam.Timer.prototype.stop=function(){this.running=!1};glam.Prefabs.HUD=function(a){a=a||{};var b=new glam.Object;a=new glam.HUDScript(a);b.addComponent(a);return b};glam.HUDScript=function(a){glam.Script.call(this,a);this.zDistance=void 0!==a.zDistance?a.zDistance:glam.HUDScript.DEFAULT_Z_DISTANCE;this.position=new THREE.Vector3(0,0,-this.zDistance);this.savedPosition=this.position.clone();this.scale=new THREE.Vector3;this.quaternion=new THREE.Quaternion};goog.inherits(glam.HUDScript,glam.Script);glam.HUDScript.prototype.realize=function(){};
glam.HUDScript.EPSILON=0.001;glam.HUDScript.prototype.update=function(){var a=glam.Graphics.instance.camera;a.updateMatrixWorld();a.matrixWorld.decompose(this.position,this.quaternion,this.scale);this._object.transform.quaternion.copy(this.quaternion);this._object.transform.position.copy(this.position);this._object.transform.translateZ(-this.zDistance);this.savedPosition.distanceTo(this.position)>glam.HUDScript.EPSILON&&console.log("Position changed:",this.position);this.savedPosition.copy(this.position)};
glam.HUDScript.DEFAULT_Z_DISTANCE=1;glam.DOMTransform={};
glam.DOMTransform.parse=function(a,b,c){var d={};d.x=parseFloat(a.getAttribute("x"))||0;d.y=parseFloat(a.getAttribute("y"))||0;d.z=parseFloat(a.getAttribute("z"))||0;d.rx=glam.DOMTransform.parseRotation(a.getAttribute("rx"))||0;d.ry=glam.DOMTransform.parseRotation(a.getAttribute("ry"))||0;d.rz=glam.DOMTransform.parseRotation(a.getAttribute("rz"))||0;d.sx=parseFloat(a.getAttribute("sx"))||1;d.sy=parseFloat(a.getAttribute("sy"))||1;d.sz=parseFloat(a.getAttribute("sz"))||1;var e=a.getAttribute("transform")||
a.getAttribute("-webkit-transform")||a.getAttribute("-moz-transform")||a.getAttribute("-ms-transform")||a.getAttribute("-opera-transform");e&&glam.DOMTransform.parseTransform(e,d);b&&glam.DOMTransform.parseStyle(b,d);c.transform.position.set(d.x,d.y,d.z);c.transform.rotation.set(d.rx,d.ry,d.rz);c.transform.scale.set(d.sx,d.sy,d.sz);a.glam.setAttributeHandlers.push(function(b,d){glam.DOMTransform.onSetAttribute(c,a,b,d)});b.setPropertyHandlers.push(function(b,d){glam.DOMTransform.onSetAttribute(c,
a,b,d)})};
glam.DOMTransform.parseStyle=function(a,b){if(a){a.x&&(b.x=parseFloat(a.x));a.y&&(b.y=parseFloat(a.y));a.z&&(b.z=parseFloat(a.z));a.rx&&(b.rx=glam.DOMTransform.parseRotation(a.rx));a.ry&&(b.ry=glam.DOMTransform.parseRotation(a.ry));a.rz&&(b.rz=glam.DOMTransform.parseRotation(a.rz));a.sx&&(b.sx=parseFloat(a.sx));a.sy&&(b.sy=parseFloat(a.sy));a.sz&&(b.sz=parseFloat(a.sz));var c=a.transform||a["-webkit-transform"]||a["-moz-transform"]||a["-ms-transform"]||a["-opera-transform"];c&&glam.DOMTransform.parseTransform(c,b)}};
glam.DOMTransform.parseRotation=function(a){if(!a)return null;a=a.toLowerCase();var b=a.indexOf("deg");if(-1!=b&&(b=a.split("deg"),b.length))return a=parseFloat(b[0]),THREE.Math.degToRad(a);b=a.indexOf("rad");return-1!=b&&(b=a.split("rad"),b.length)?parseFloat(b[0]):parseFloat(a)};
glam.DOMTransform.parseTransform=function(a,b){var c=a.split(" "),d,e=c.length;for(d=0;d<e;d++){var f=c[d],g=f.split("(")[0],f=/\(([^)]+)\)/.exec(f)[1];switch(g){case "translateX":b.x=parseFloat(f);break;case "translateY":b.y=parseFloat(f);break;case "translateZ":b.z=parseFloat(f);break;case "rotateX":b.rx=glam.DOMTransform.parseRotation(f);break;case "rotateY":b.ry=glam.DOMTransform.parseRotation(f);break;case "rotateZ":b.rz=glam.DOMTransform.parseRotation(f);break;case "scaleX":b.sx=parseFloat(f);
break;case "scaleY":b.sy=parseFloat(f);break;case "scaleZ":b.sz=parseFloat(f)}}};
glam.DOMTransform.onSetAttribute=function(a,b,c,d){b=parseFloat(d);switch(c){case "x":a.transform.position.x=b;break;case "y":a.transform.position.y=b;break;case "z":a.transform.position.z=b;break;case "rx":a.transform.rotation.x=b;break;case "ry":a.transform.rotation.y=b;break;case "rz":a.transform.rotation.z=b;break;case "sx":a.transform.scale.x=b;break;case "sy":a.transform.scale.y=b;break;case "sz":a.transform.scale.z=b}};glam.CylinderDragger=function(a){a=a||{};glam.Picker.call(this,a);this.normal=a.normal||new THREE.Vector3(0,1,0);this.position=a.position||new THREE.Vector3;this.color=11141120};goog.inherits(glam.CylinderDragger,glam.Picker);
glam.CylinderDragger.prototype.realize=function(){glam.Picker.prototype.realize.call(this);this.dragObject=null;this.dragOffset=new THREE.Euler;this.currentOffset=new THREE.Euler;this.dragHitPoint=new THREE.Vector3;this.dragStartPoint=new THREE.Vector3;this.dragPlane=this.createDragPlane();this.dragPlane.visible=glam.CylinderDragger.SHOW_DRAG_PLANE;this.dragPlane.ignorePick=!0;this.dragPlane.ignoreBounds=!0;this._object.transform.object.add(this.dragPlane)};
glam.CylinderDragger.prototype.createDragPlane=function(){var a=this.normal,b=this.position,c=(new THREE.Vector3(0,a.z,-a.y)).normalize().multiplyScalar(2E3);c.lengthSq()||(c=(new THREE.Vector3(-a.z,a.x,0)).normalize().multiplyScalar(2E3));var d=c.clone().cross(a).normalize().multiplyScalar(2E3),e=b.clone().sub(c).sub(d),f=b.clone().add(c).sub(d),g=b.clone().add(c).add(d),c=b.clone().sub(c).add(d),b=new THREE.Geometry;b.vertices.push(e,f,g,c);e=new THREE.Face3(0,2,1);e.normal.copy(a);e.vertexNormals.push(a.clone(),
a.clone(),a.clone(),a.clone());b.faces.push(e);e=new THREE.Face3(0,3,2);e.normal.copy(a);e.vertexNormals.push(a.clone(),a.clone(),a.clone(),a.clone());b.faces.push(e);b.computeFaceNormals();a=new THREE.MeshBasicMaterial({color:this.color,transparent:!0,side:THREE.DoubleSide,opacity:0.1});return new THREE.Mesh(b,a)};glam.CylinderDragger.prototype.update=function(){};glam.CylinderDragger.prototype.onMouseDown=function(a){glam.Picker.prototype.onMouseDown.call(this,a);this.handleMouseDown(a)};
glam.CylinderDragger.prototype.handleMouseDown=function(a){if(this.dragPlane){var b=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,this.dragPlane);b&&(this.dragStartPoint.copy(b.point).normalize(),this.dragObject=a.object,this.dispatchEvent("dragstart",{type:"dragstart",offset:b.point}))}glam.CylinderDragger.SHOW_DRAG_NORMAL&&(this.arrowDecoration&&this._object.removeComponent(this.arrowDecoration),a=new THREE.ArrowHelper(this.normal,new THREE.Vector3,500,65280,5,5),a=new glam.Decoration({object:a}),
this._object.addComponent(a),this.arrowDecoration=a)};glam.CylinderDragger.prototype.onMouseMove=function(a){glam.Picker.prototype.onMouseMove.call(this,a);this.handleMouseMove(a)};
glam.CylinderDragger.prototype.handleMouseMove=function(a){if(a=glam.Graphics.instance.getObjectIntersection(a.elementX,a.elementY,this.dragPlane)){var b=a.point.clone().normalize();a=Math.acos(b.dot(this.dragStartPoint));b=b.clone().cross(this.dragStartPoint);0<this.normal.dot(b)&&(a=-a);this.currentOffset.set(this.dragOffset.x+this.normal.x*a,this.dragOffset.y+this.normal.y*a,this.dragOffset.z+this.normal.z*a);this.dispatchEvent("drag",{type:"drag",offset:this.currentOffset})}};
glam.CylinderDragger.prototype.onMouseUp=function(a){glam.Picker.prototype.onMouseUp.call(this,a);this.handleMouseUp(a)};glam.CylinderDragger.prototype.handleMouseUp=function(a){this.arrowDecoration&&this._object.removeComponent(this.arrowDecoration)};glam.CylinderDragger.prototype.onTouchStart=function(a){glam.Picker.prototype.onTouchStart.call(this,a);this.handleMouseDown(a)};glam.CylinderDragger.prototype.onTouchMove=function(a){glam.Picker.prototype.onTouchMove.call(this,a);this.handleMouseMove(a)};
glam.CylinderDragger.prototype.onTouchEnd=function(a){glam.Picker.prototype.onTouchEnd.call(this,a);this.handleMouseUp(a)};glam.CylinderDragger.SHOW_DRAG_PLANE=!1;glam.CylinderDragger.SHOW_DRAG_NORMAL=!1;glam.Modules=function(){};var CLOSURE_NO_DEPS=!0;glam.loadUrl=function(a,b,c){c=c||{};c.container=b;var d=new glam.Viewer(c);b=new glam.Loader;b.addEventListener("loaded",function(a){var b=e,b=(Date.now()-b)/1E3;glam.System.log("glam.loadUrl, scene loaded in ",b," seconds.");d.replaceScene(a);1<d.cameras.length&&d.useCamera(1);c.headlight&&d.setHeadlightOn(!0)});b.addEventListener("progress",function(a){glam.System.log("glam.loadUrl, ",100*(a.loaded/a.total)," % loaded.")});var e=Date.now();b.loadScene(a);d.run();return{viewer:d}};glam.ready=function(){glam.DOM.ready()};
glam.setFullScreen=function(a){return glam.Graphics.instance.setFullScreen(a)};
